(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[788],{5042:function(){},1579:function(e,t,a){Promise.resolve().then(a.bind(a,9943))},9943:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return e4}});var r=a(7437),s=a(2265),l=a(9625),n=a(4717);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.round(e*a)/a}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.ceil(e*a)/a}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.floor(e*a)/a}function d(e,t){try{let a=e;for(let[e,r]of Object.entries(t).sort((e,t)=>{let[a]=e,[r]=t;return r.length-a.length})){let t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=RegExp("(?<![a-zA-Z0-9._])".concat(t,"(?![a-zA-Z0-9._])"),"g");a=a.replace(s,String(r))}a=(a=function e(t,a){let r=t;for(let{pattern:t,fn:s}of[{pattern:/ROUND\s*\(/gi,fn:i},{pattern:/ROUNDUP\s*\(/gi,fn:o},{pattern:/ROUNDDOWN\s*\(/gi,fn:c}]){let l;for(t.lastIndex=0;null!==(l=t.exec(r));){let i;let o=l.index,c=l.index+l[0].length,d=1,u=c;for(let e=c;e<r.length&&d>0;e++)if("("===r[e]&&d++,")"===r[e]&&d--,0===d){u=e;break}let m=r.substring(c,u),x=[],h="",p=0;for(let e of m)"("===e&&p++,")"===e&&p--,","===e&&0===p?(x.push(h.trim()),h=""):h+=e;x.push(h.trim());try{let t=x[0];for(let[e,r]of Object.entries(a).sort((e,t)=>{let[a]=e,[r]=t;return r.length-a.length})){let a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=RegExp("(?<![a-zA-Z0-9._])".concat(a,"(?![a-zA-Z0-9._])"),"g");t=t.replace(s,String(r))}t=e(t,a),i=(0,n.ku)(t.replace(/ln\(/g,"log("))}catch(e){t.lastIndex=u+1;continue}let g=0;if(x.length>1)try{let e=x[1];for(let[t,r]of Object.entries(a).sort((e,t)=>{let[a]=e,[r]=t;return r.length-a.length})){let a=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=RegExp("(?<![a-zA-Z0-9._])".concat(a,"(?![a-zA-Z0-9._])"),"g");e=e.replace(s,String(r))}g=(0,n.ku)(e)}catch(e){g=0}let b=s(i,g);r=r.substring(0,o)+String(b)+r.substring(u+1),t.lastIndex=0}}return r}(a,t)).replace(/ln\(/g,"log(");let r=(0,n.ku)(a);if("number"!=typeof r||isNaN(r))throw Error("Formula evaluation resulted in non-numeric value: ".concat(r));return r}catch(a){throw console.error("Formula evaluation error:",{formula:e,variables:t,error:a instanceof Error?a.message:String(a)}),Error("Failed to evaluate formula: ".concat(e))}}function u(e){return Math.round(Math.round(1e10*e)/1e10)}function m(e){return Math.ceil(e)}function x(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.reduce((e,t)=>(function(e,t){let a={};for(let r in e)a[r]=(e[r]||0)+(t[r]||0);for(let e in t)e in a||(a[e]=t[e]||0);return a})(e,t),{})}function h(e){let t={};for(let a in e)void 0!==e[a]&&(t[a]=e[a]);return t}let p=["SSS","SS","S","A","B","C","D","E","F"];function g(e,t,a,r){let s=r.Weapon.Rank[t];if(!s||!s.Bonus)return e;let l=e-(s.Bonus[a]||0);return"AttackP"===a?Math.floor(l):l}function b(e){return void 0===e||""===e?0:"number"==typeof e?e:parseFloat(e)||0}function f(e){let t={},a={},r=[];for(let s of e){let e=s.解法段階;if("初期値"===e)t.HP=b(s.体力),t.Power=b(s.力),t.Magic=b(s.魔力),t.Mind=b(s.精神),t.Agility=b(s.素早さ),t.Dex=b(s.器用さ),t.CritDamage=b(s.撃力),t.Defense=b(s.守備力);else if("職業補正(%)"===e)a.HP=b(s.体力),a.Power=b(s.力),a.Magic=b(s.魔力),a.Mind=b(s.精神),a.Agility=b(s.素早さ),a.Dex=b(s.器用さ),a.CritDamage=b(s.撃力),a.Defense=b(s.守備力);else if(e.match(/^[A-C]-\d+$/)){let[t,a]=e.split("-"),l=parseInt(a);r.push({branch:t,tier:l,requiredSP:b(s.必要SP),skillName:s.解法スキル名,stats:{体力:b(s.体力),力:b(s.力),魔力:b(s.魔力),精神:b(s.精神),素早さ:b(s.素早さ),器用さ:b(s.器用さ),撃力:b(s.撃力),守備力:b(s.守備力)}})}}return{initialStats:t,jobCorrection:a,spNodes:r}}function v(e,t,a){let r=0;for(let s=1;s<=50;s++){let l="".concat(e,"-").concat(s),n=a.find(e=>e.解法段階===l);if(!n)break;if(("string"==typeof n.必要SP?parseFloat(n.必要SP)||0:n.必要SP||0)<=t)r=s;else break}return r>0?"".concat(e,"-").concat(r):"".concat(e,"-0")}function y(e,t){let a={A:{力:0,体力:0,魔力:0,精神:0,素早さ:0,器用さ:0,撃力:0,守備力:0},B:{力:0,体力:0,魔力:0,精神:0,素早さ:0,器用さ:0,撃力:0,守備力:0},C:{力:0,体力:0,魔力:0,精神:0,素早さ:0,器用さ:0,撃力:0,守備力:0}};return["A","B","C"].forEach(r=>{let s=e[r]||0;for(let e=1;e<=50;e++){let l="".concat(r,"-").concat(e),n=t.find(e=>e.解法段階===l);if(!n)break;if(("string"==typeof n.必要SP?parseFloat(n.必要SP)||0:n.必要SP||0)<=s)a[r].力+=b(n.力),a[r].体力+=b(n.体力),a[r].魔力+=b(n.魔力),a[r].精神+=b(n.精神),a[r].素早さ+=b(n.素早さ),a[r].器用さ+=b(n.器用さ),a[r].撃力+=b(n.撃力),a[r].守備力+=b(n.守備力);else break}}),a}let j={ノービス:"Novice",ファイター:"Fighter",アコライト:"Acolyte",アーチャー:"Archer",メイジ:"Mage",クレリック:"Cleric",ハンター:"Hunter",レンジャー:"Ranger",ウィザード:"Wizard",ナイト:"Knight",ウォーリアー:"Warrior",スペルリファクター:"SpellRefactor",ガーディアン:"Guardian",プリースト:"Priest",ステラシャフト:"StellaShaft"},N={剣:["Sword"],大剣:["GreatSword"],短剣:["Dagger"],斧:["Axe"],槍:["Spear"],弓:["Bow"],杖:["Wand","Grimoire","Staff"]},k={布:"Cloth",革:"Leather",金属:"Metal"};function w(e){return j[e]||e}let D="da_calc_build_presets",S=e=>{var t,a,r,s,l,n,i,o;let c={HP:"HP",Power:"ATK",Magic:"MATK",Defense:"DEF",Mind:"MDEF",Dex:"DEX",Agility:"AGI",CritDamage:"HIT"},d=e=>{let t=C();for(let[a,r]of Object.entries(e)){let e=c[a];e&&r&&(t[e]=Math.floor(r))}return t},u=d(e.final);void 0!==e.critRate&&(u.CRI=Math.floor(e.critRate));let m=d((null===(t=e.breakdown)||void 0===t?void 0:t.jobInitial)||{}),x=d((null===(a=e.breakdown)||void 0===a?void 0:a.equipment)||{}),h=d((null===(r=e.breakdown)||void 0===r?void 0:r.runestone)||{});for(let e of Object.keys(h))x[e]=(x[e]||0)+(h[e]||0);let p=d((null===(s=e.breakdown)||void 0===s?void 0:s.jobSP)||{}),g=d({...(null===(l=e.breakdown)||void 0===l?void 0:l.food)||{},...(null===(n=e.breakdown)||void 0===n?void 0:n.userOption)||{},...(null===(i=e.ring)||void 0===i?void 0:i.delta)||{}}),b=C();if((null===(o=e.bonusPercent)||void 0===o?void 0:o.total)&&e.base)for(let[t,a]of Object.entries(e.bonusPercent.total)){let r=c[t];if(r&&a){let s=Math.floor((e.base[t]||0)*a/100);b[r]=s}}return{base:m,fromEquipment:x,fromSkills:p,fromBuffs:g,fromPercent:b,total:u}},C=()=>({HP:0,MP:0,ATK:0,DEF:0,MATK:0,MDEF:0,AGI:0,DEX:0,LUK:0,CRI:0,HIT:0,FLEE:0}),P=()=>({base:C(),fromEquipment:C(),fromSkills:C(),fromBuffs:C(),fromPercent:C(),total:C()}),M=()=>({id:"default",name:"新規ビルド",job:null,level:100,equipment:{},spAllocation:{},buffs:[]}),E=(0,l.Ue)((e,t)=>({currentBuild:M(),calculatedStats:P(),weaponStats:null,availableJobs:[],availableEquipment:[],availableBuffs:[],availableFoods:[],availableEmblems:[],availableRunestones:[],gameData:{},userOption:{manualStats:{},percentBonus:{}},ringOption:{enabled:!1,ringType:"none"},selectedFood:null,foodEnabled:!1,weaponSkillEnabled:!1,selectedSkillId:null,skillLevel:1,customHits:void 0,enemyStats:{defense:0,attackResistance:0,elementResistance:0},selectedEmblem:null,selectedRunestones:[],presets:[],setJob:a=>{var r,s,l;let n=t(),i=100;if(a&&(null===(s=n.gameData)||void 0===s?void 0:null===(r=s.jobConst)||void 0===r?void 0:r.JobDefinition)){let e=w(a.id);i=(null===(l=n.gameData.jobConst.JobDefinition[e])||void 0===l?void 0:l.MaxLevel)||100}let o=i;e(e=>({currentBuild:{...e.currentBuild,job:a,level:o,spAllocation:{}}})),t().recalculateStats()},setLevel:a=>{var r,s,l;let n=t(),i=100;if(n.currentBuild.job&&(null===(s=n.gameData)||void 0===s?void 0:null===(r=s.jobConst)||void 0===r?void 0:r.JobDefinition)){let e=w(n.currentBuild.job.id);i=(null===(l=n.gameData.jobConst.JobDefinition[e])||void 0===l?void 0:l.MaxLevel)||100}e(e=>({currentBuild:{...e.currentBuild,level:Math.max(1,Math.min(i,a))}})),t().recalculateStats()},setEquipment:(a,r)=>{e(e=>({currentBuild:{...e.currentBuild,equipment:{...e.currentBuild.equipment,[a]:r}}})),t().recalculateStats()},setSPAllocation:a=>{e(e=>({currentBuild:{...e.currentBuild,spAllocation:a}})),t().recalculateStats()},toggleBuff:a=>{e(e=>({currentBuild:{...e.currentBuild,buffs:e.currentBuild.buffs.map(e=>e.id===a?{...e,isActive:!e.isActive}:e)}})),t().recalculateStats()},resetBuild:()=>{e({currentBuild:M(),calculatedStats:P(),weaponStats:null})},loadBuild:a=>{e({currentBuild:a}),t().recalculateStats()},setUserOption:a=>{e({userOption:a}),t().recalculateStats()},setRingOption:a=>{e({ringOption:a}),t().recalculateStats()},setFood:a=>{e({selectedFood:a}),t().recalculateStats()},toggleFood:a=>{e({foodEnabled:a}),t().recalculateStats()},toggleWeaponSkill:a=>{e({weaponSkillEnabled:a}),t().recalculateStats()},setSelectedSkillId:t=>{e({selectedSkillId:t})},setSkillLevel:t=>{e({skillLevel:t})},setCustomHits:t=>{e({customHits:t})},setEnemyStats:t=>{e({enemyStats:t})},setAvailableJobs:t=>e({availableJobs:t}),setAvailableEquipment:t=>e({availableEquipment:t}),setAvailableBuffs:t=>e({availableBuffs:t}),setAvailableFoods:t=>e({availableFoods:t}),setAvailableEmblems:t=>e({availableEmblems:t}),setAvailableRunestones:t=>e({availableRunestones:t}),setEmblem:a=>{e({selectedEmblem:a}),t().recalculateStats()},setRunestones:a=>{e({selectedRunestones:a}),t().recalculateStats()},setGameData:t=>e({gameData:t}),recalculateStats:()=>{let{currentBuild:a,userOption:r,ringOption:s,selectedFood:l,foodEnabled:n,gameData:i,weaponSkillEnabled:o,selectedEmblem:c,selectedRunestones:b}=t();if(!i.eqConst||!i.jobConst){console.warn("計算に必要なゲームデータが不足しています");return}if(!a.job){e({calculatedStats:P(),weaponStats:null});return}try{var v,j,N,k,D,C,M,E,A,R,F,L,B,O,T,I;let t=null,o=0,q=a.equipment.weapon;if(q&&(null===(v=q.sourceData)||void 0===v?void 0:v.type)==="weapon"){let e=q.sourceData.data,a=q.rank||"SSS",r=q.enhancementLevel||0,s=q.smithingCounts||{},l={attackPower:s["攻撃力"]||0,critRate:s["会心率"]||0,critDamage:s["会心ダメージ"]||0},n=q.alchemyEnabled||!1,c=function(e,t,a,r,s,l,n){var i,o,c,x,h,b,f,v,y,j,N,k,w,D,S,C,P,M,E,A,R,F,L,B,O,T,I,q,H,W;let J,K,U,V;let _="number"==typeof r?{attackPower:r,critRate:r,critDamage:r}:r,z=_.attackPower||0,X=_.critRate||0,G=_.critDamage||0,$=function(e,t,a){let r=p.indexOf(e);if(-1===r&&(r=0),a){let e=p.indexOf(a);-1!==e&&r<e&&(r=e)}if(t){let e=p.indexOf(t);-1!==e&&r>e&&(r=e)}return p[r]}(t,e.最低ランク,e.最高ランク);$!==t&&console.warn("Rank ".concat(t," clamped to ").concat($," for weapon ").concat(e.アイテム名)),t=$;let Y=null!==(y=null===(i=l.Weapon.Reinforcement)||void 0===i?void 0:i.MAX)&&void 0!==y?y:80;if(a<0||a>Y)throw Error("Reinforcement must be between 0 and ".concat(Y));let Z=e["攻撃力（初期値）"],Q=e["会心率（初期値）"],ee=e["会心ダメージ（初期値）"],et=e["ct(初期値)"];e.最低ランク&&"F"!==e.最低ランク&&(Z=g(Z,e.最低ランク,"AttackP",l),Q=g(Q,e.最低ランク,"CritR",l),ee=g(ee,e.最低ランク,"CritD",l),et=g(et,e.最低ランク,"CoolT",l));let ea=l.Weapon.Rank[t];if(!ea)throw Error("Rank data not found for ".concat(t));let er=ea.Bonus||{},es=s&&ea.Alchemy||{},el=null==n?void 0:null===(o=n.EquipmentStatusFormula)||void 0===o?void 0:o.Weapon;if(el){let t={"Initial.AttackP":Z,"Initial.CritR":Q,"Initial.CritD":ee,"Initial.CoolT":et,"Rank.Bonus.AttackP":er.AttackP||0,"Rank.Bonus.CritR":er.CritR||0,"Rank.Bonus.CritD":er.CritD||0,"Rank.Bonus.CoolT":er.CoolT||0,"Rank.Alchemy.AttackP":es.AttackP||0,"Rank.Alchemy.CritR":es.CritR||0,"Rank.Alchemy.CritD":es.CritD||0,"Reinforcement.AttackP":(null===(j=l.Weapon.Reinforcement)||void 0===j?void 0:j.AttackP)||2,"Reinforcement.CritR":(null===(N=l.Weapon.Reinforcement)||void 0===N?void 0:N.CritR)||0,"Reinforcement.CritD":(null===(k=l.Weapon.Reinforcement)||void 0===k?void 0:k.CritD)||1,ReinforcementLevel:a,"Forge.AttackP":(null===(w=l.Weapon.Forge)||void 0===w?void 0:w.Other)||1,"Forge.CritR":(null===(D=l.Weapon.Forge)||void 0===D?void 0:D.Other)||1,"Forge.CritD":(null===(S=l.Weapon.Forge)||void 0===S?void 0:S.Other)||1,ForgeAttackP:z,ForgeCritR:X,ForgeCritD:G,AvailableLv:e.使用可能Lv,Denominator:(null===(C=l.Weapon.Reinforcement)||void 0===C?void 0:C.Denominator)||320};try{if(el.AttackP){let e=d(el.AttackP,t);J=u(e)}else J=m(Z+e.使用可能Lv*((er.AttackP||0)/t.Denominator))+(es.AttackP||0)+t["Reinforcement.AttackP"]*a+t["Forge.AttackP"]*z;K=el.CritR?d(el.CritR,t):Q+(er.CritR||0)+(es.CritR||0)+t["Reinforcement.CritR"]*a+t["Forge.CritR"]*X,U=el.CritD?d(el.CritD,t):ee+(er.CritD||0)+(es.CritD||0)+t["Reinforcement.CritD"]*a+t["Forge.CritD"]*G,V=el.CoolT?d(el.CoolT,t):et+(er.CoolT||0)}catch(r){console.warn("Failed to evaluate weapon formulas, using default calculation",r);let t=(null===(P=l.Weapon.Reinforcement)||void 0===P?void 0:P.Denominator)||320;J=m(Z+e.使用可能Lv*((er.AttackP||0)/t))+(es.AttackP||0)+((null===(M=l.Weapon.Reinforcement)||void 0===M?void 0:M.AttackP)||2)*a+((null===(E=l.Weapon.Forge)||void 0===E?void 0:E.Other)||1)*z,K=Q+(er.CritR||0)+(es.CritR||0)+((null===(A=l.Weapon.Reinforcement)||void 0===A?void 0:A.CritR)||0)*a+((null===(R=l.Weapon.Forge)||void 0===R?void 0:R.Other)||1)*X,U=ee+(er.CritD||0)+(es.CritD||0)+((null===(F=l.Weapon.Reinforcement)||void 0===F?void 0:F.CritD)||1)*a+((null===(L=l.Weapon.Forge)||void 0===L?void 0:L.Other)||1)*G,V=et+(er.CoolT||0)}}else{let t=(null===(B=l.Weapon.Reinforcement)||void 0===B?void 0:B.Denominator)||320;J=m(Z+e.使用可能Lv*((er.AttackP||0)/t))+(es.AttackP||0)+((null===(O=l.Weapon.Reinforcement)||void 0===O?void 0:O.AttackP)||2)*a+((null===(T=l.Weapon.Forge)||void 0===T?void 0:T.Other)||1)*z,K=Q+(er.CritR||0)+(es.CritR||0)+((null===(I=l.Weapon.Reinforcement)||void 0===I?void 0:I.CritR)||0)*a+((null===(q=l.Weapon.Forge)||void 0===q?void 0:q.Other)||1)*X,U=ee+(er.CritD||0)+(es.CritD||0)+((null===(H=l.Weapon.Reinforcement)||void 0===H?void 0:H.CritD)||1)*a+((null===(W=l.Weapon.Forge)||void 0===W?void 0:W.Other)||1)*G,V=et+(er.CoolT||0)}let en=e["ダメージ補正（初期値）"];return{initial:{attackPower:Z,critRate:Q,critDamage:ee,coolTime:et,damageCorrection:en},rankBonus:{attackPower:er.AttackP||0,critRate:er.CritR||0,critDamage:er.CritD||0,coolTime:er.CoolT||0},reinforcement:{attackPower:((null===(c=l.Weapon.Reinforcement)||void 0===c?void 0:c.AttackP)||2)*a,critRate:((null===(x=l.Weapon.Reinforcement)||void 0===x?void 0:x.CritR)||0)*a,critDamage:((null===(h=l.Weapon.Reinforcement)||void 0===h?void 0:h.CritD)||1)*a},forge:{attackPower:((null===(b=l.Weapon.Forge)||void 0===b?void 0:b.Other)||1)*z,critRate:((null===(f=l.Weapon.Forge)||void 0===f?void 0:f.Other)||1)*X,critDamage:((null===(v=l.Weapon.Forge)||void 0===v?void 0:v.Other)||1)*G},alchemy:s?{attackPower:es.AttackP||0,critRate:es.CritR||0,critDamage:es.CritD||0}:{},final:{attackPower:J,critRate:K,critDamage:U,coolTime:V,damageCorrection:en},attackPower:J,critRate:K,critDamage:U,coolTime:V,damageCorrection:en}}(e,a,r,l,n,i.eqConst,i.userStatusCalc);o=(t={attackPower:c.attackPower||0,critRate:c.critRate||0,critDamage:c.critDamage||0,damageCorrection:c.damageCorrection||0,coolTime:c.coolTime||0,weaponType:e.武器種}).critRate}let H={};for(let[e,t]of Object.entries(a.equipment))if(t&&t.sourceData){let a=t.rank||"SSS",r=t.enhancementLevel||0,s=e=>({power:"Power",magic:"Magic",hp:"HP",mind:"Mind",speed:"Agility",dexterity:"Dex",critDamage:"CritDamage",defense:"Defense",HP:"HP",Power:"Power",Magic:"Magic",Mind:"Mind",CritDamage:"CritDamage",Speed:"Agility",ATK:"Power",MATK:"Magic",DEF:"Defense",MDEF:"Mind",DEX:"Dex",AGI:"Agility",HIT:"CritDamage"})[e]||e;if("weapon"===e);else if(["head","body","leg"].includes(e)&&"armor"===t.sourceData.type)try{let e=t.sourceData.data,s=t.smithingCounts||{},l=null===(N=i.eqConst)||void 0===N?void 0:N.Armor,n=(null==l?void 0:null===(k=l.Rank)||void 0===k?void 0:k[a])||0,o=e.使用可能Lv||1,c=null!==(A=null==l?void 0:null===(D=l.Forge)||void 0===D?void 0:D.Defence)&&void 0!==A?A:1,d=null!==(R=null==l?void 0:null===(C=l.Forge)||void 0===C?void 0:C.Other)&&void 0!==R?R:2,u=null!==(F=null==l?void 0:null===(M=l.Reinforcement)||void 0===M?void 0:M.Defence)&&void 0!==F?F:2,m=null!==(L=null==l?void 0:null===(E=l.Reinforcement)||void 0===E?void 0:E.Other)&&void 0!==L?L:2;for(let t of[{csvKey:"守備力（初期値）",outputKey:"Defense",smithingParam:"守備力",forgeMultiplier:c,reinforceMultiplier:u},{csvKey:"体力（初期値）",outputKey:"HP",smithingParam:"体力",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"力（初期値）",outputKey:"Power",smithingParam:"力",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"魔力（初期値）",outputKey:"Magic",smithingParam:"魔力",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"精神（初期値）",outputKey:"Mind",smithingParam:"精神",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"素早さ（初期値）",outputKey:"Agility",smithingParam:"素早さ",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"器用（初期値）",outputKey:"Dex",smithingParam:"器用",forgeMultiplier:d,reinforceMultiplier:m},{csvKey:"撃力（初期値）",outputKey:"CritDamage",smithingParam:"撃力",forgeMultiplier:d,reinforceMultiplier:m}]){let a=e[t.csvKey]||0;if(0===a)continue;let l=(s[t.smithingParam]||0)*t.forgeMultiplier,i=r*t.reinforceMultiplier,c=a+l,d=Math.round(c*(1+n/o*Math.pow(c,.2)))+i;H[t.outputKey]=(H[t.outputKey]||0)+d}let x=t.exStats;if(x){let t={power:"Power",magic:"Magic",hp:"HP",mind:"Mind",speed:"Agility",dex:"Dex",critDamage:"CritDamage",defense:"Defense"},r=null===(O=i.eqConst)||void 0===O?void 0:null===(B=O.Equipment_EX)||void 0===B?void 0:B.Rank,s=t=>{let s=e.使用可能Lv||1,l=0;return"dex"===t&&(null==r?void 0:r.CritR)?l=r.CritR[a]||0:("critDamage"===t||"speed"===t)&&(null==r?void 0:r.Speed_CritD)?l=r.Speed_CritD[a]||0:(null==r?void 0:r.Other)&&(l=r.Other[a]||0),Math.round(s*l+1)};if(x.ex1){let e=t[x.ex1];e&&(H[e]=(H[e]||0)+s(x.ex1))}if(x.ex2){let e=t[x.ex2];e&&(H[e]=(H[e]||0)+s(x.ex2))}}}catch(a){for(let r of(console.warn("防具計算エラー (".concat(e,"):"),a),t.baseStats))if(!r.isPercent){let e=s(r.stat);H[e]=(H[e]||0)+r.value}}else if(["accessory1","accessory2"].includes(e)&&"accessory"===t.sourceData.type)try{let e=t.sourceData.data,r=function(e,t,a){var r,s,l,n;if(!function(e,t,a){let r=p.indexOf(e);if(-1===r)return!1;if(t){let e=p.indexOf(t);if(-1!==e&&r>e)return!1}if(a){let e=p.indexOf(a);if(-1!==e&&r<e)return!1}return!0}(t,e.最低ランク,e.最高ランク))throw Error("Invalid rank ".concat(t," for accessory ").concat(e.アイテム名));let i=(null===(s=a.Accessory)||void 0===s?void 0:null===(r=s.Rank)||void 0===r?void 0:r[t])||0,o={initial:{},rankBonus:{},reinforcement:{},forge:{},alchemy:{},final:{}};for(let t of[{key:"HP",csvKey:"体力（初期値）"},{key:"Power",csvKey:"力（初期値）"},{key:"Magic",csvKey:"魔力（初期値）"},{key:"Mind",csvKey:"精神（初期値）"},{key:"CritDamage",csvKey:"撃力（初期値）"},{key:"Speed",csvKey:"素早さ（初期値）"}]){let r;let s=e[t.csvKey]||0;if(0!==s){if(0===i)r=s;else{let t=null!==(n=null===(l=a.Accessory)||void 0===l?void 0:l.ScalingDivisor)&&void 0!==n?n:550;r=Math.ceil(s+e.使用可能Lv*i/t)}o.initial[t.key]=s,o.rankBonus[t.key]=r-s,o.final[t.key]=r}}return o}(e,a,i.eqConst);if(r.final){for(let[e,t]of Object.entries(r.final))if(t&&"number"==typeof t){let a=s(e);H[a]=(H[a]||0)+t}}let l=t.exStats;if(l){let t={power:"Power",magic:"Magic",hp:"HP",mind:"Mind",speed:"Agility",dex:"Dex",critDamage:"CritDamage"},r=null===(I=i.eqConst)||void 0===I?void 0:null===(T=I.Equipment_EX)||void 0===T?void 0:T.Rank,s=t=>{let s=e.使用可能Lv||1,l=0;return"dex"===t&&(null==r?void 0:r.CritR)?l=r.CritR[a]||0:("critDamage"===t||"speed"===t)&&(null==r?void 0:r.Speed_CritD)?l=r.Speed_CritD[a]||0:(null==r?void 0:r.Other)&&(l=r.Other[a]||0),Math.round(s*l+1)};if(l.ex1){let e=t[l.ex1];e&&(H[e]=(H[e]||0)+s(l.ex1))}if(l.ex2){let e=t[l.ex2];e&&(H[e]=(H[e]||0)+s(l.ex2))}}}catch(a){for(let r of(console.warn("アクセサリー計算エラー (".concat(e,"):"),a),t.baseStats))if(!r.isPercent){let e=s(r.stat);H[e]=(H[e]||0)+r.value}}else for(let e of t.baseStats)if(!e.isPercent){let t=s(e.stat);H[t]=(H[t]||0)+e.value}}let W=null===(j=i.jobSPData)||void 0===j?void 0:j.get(a.job.id),J=w(a.job.name||a.job.id),K=function(e,t,a,r,s){let l;if(t<1||t>999)throw Error("レベルは1-999の範囲である必要があります: ".concat(t));try{l=function(e,t,a){if(!a||!a.JobDefinition)throw console.error("JobConstDataが不正です:",a),Error("JobConstDataが未定義またはJobDefinitionが存在しません");let r=a.JobDefinition[e];if(!r)throw console.error('職業 "'.concat(e,'" が見つかりません。利用可能な職業:'),Object.keys(a.JobDefinition)),Error('職業 "'.concat(e,'" が見つかりません'));if(t<1)throw Error("レベルは1以上である必要があります: ".concat(t));return{HP:(r.HP||0)+1*t-1,Power:(r.STR||0)+2*t-2,Magic:(r.INT||0)+2*t-2,Mind:(r.MND||0)+1*t-1,Agility:r.AGI||0,Dex:r.DEX||0,Defense:0,CritDamage:0}}(e,t,r)}catch(e){console.error("基礎ステータス計算エラー:",e),l={HP:1*t-1,Power:2*t-2,Magic:2*t-2,Mind:1*t-1,Agility:10,Dex:10,Defense:0,CritDamage:0}}if(s&&s.length>0){let e=f(s);void 0!==e.initialStats.HP&&0!==e.initialStats.HP&&(l.HP=e.initialStats.HP+1*t-1),void 0!==e.initialStats.Power&&0!==e.initialStats.Power&&(l.Power=e.initialStats.Power+2*t-2),void 0!==e.initialStats.Magic&&0!==e.initialStats.Magic&&(l.Magic=e.initialStats.Magic+2*t-2),void 0!==e.initialStats.Mind&&0!==e.initialStats.Mind&&(l.Mind=e.initialStats.Mind+1*t-1),void 0!==e.initialStats.Agility&&0!==e.initialStats.Agility&&(l.Agility=e.initialStats.Agility),void 0!==e.initialStats.Dex&&0!==e.initialStats.Dex&&(l.Dex=e.initialStats.Dex),void 0!==e.initialStats.CritDamage&&0!==e.initialStats.CritDamage&&(l.CritDamage=e.initialStats.CritDamage),void 0!==e.initialStats.Defense&&0!==e.initialStats.Defense&&(l.Defense=e.initialStats.Defense);let r=function(e,t,a){let r=[],s={A:0,B:0,C:0},l={A:0,B:0,C:0};for(let a of e){let{branch:e,tier:n}=a;n>1&&s[e]<n-1&&r.push("".concat(e,"-").concat(n,"を取得するには").concat(e,"-").concat(n-1,"を先に取得する必要があります"));let i=t.spNodes.find(t=>t.branch===e&&t.tier===n);if(!i){r.push("".concat(e,"-").concat(n,"はSPツリーに存在しません"));continue}i.requiredSP>l[e]+a.spCost&&r.push("".concat(e,"-").concat(n,"を取得するには").concat(i.requiredSP,"SP必要ですが、").concat(l[e]+a.spCost,"SPしかありません")),l[e]+=a.spCost,s[e]=Math.max(s[e],n)}let n=l.A+l.B+l.C;return n>a&&r.push("SPが上限を超えています: 使用SP=".concat(n,", 最大SP=").concat(a)),{valid:0===r.length,errors:r.length>0?r:void 0}}(a,e,function(e){if(e<1)throw Error("レベルは1以上である必要があります: ".concat(e));return 2*e}(t));if(!r.valid){var n;throw Error("SP割り振りエラー: ".concat(null===(n=r.errors)||void 0===n?void 0:n.join(", ")))}let i=function(e,t){let a={};for(let r of e){let{branch:e,tier:s}=r,l=t.spNodes.find(t=>t.branch===e&&t.tier===s);if(l)for(let[e,t]of Object.entries(l.stats))t&&(a[e]=(a[e]||0)+t)}return a}(a,e),o={体力:"HP",力:"Power",魔力:"Magic",精神:"Mind",素早さ:"Agility",器用さ:"Dex",撃力:"CritDamage",守備力:"Defense"};for(let[e,t]of Object.entries(i)){let a=o[e];a&&t&&(l[a]=(l[a]||0)+t)}}return l}(J,a.level,[],i.jobConst,W),U={},V={};if(W&&W.length>0){let e=f(W);if(e.jobCorrection){let t=e.jobCorrection;void 0!==t.HP&&(V.HP=t.HP),void 0!==t.Power&&(V.Power=t.Power),void 0!==t.Magic&&(V.Magic=t.Magic),void 0!==t.Mind&&(V.Mind=t.Mind),void 0!==t.Agility&&(V.Agility=t.Agility),void 0!==t.Dex&&(V.Dex=t.Dex),void 0!==t.CritDamage&&(V.CritDamage=t.CritDamage),void 0!==t.Defense&&(V.Defense=t.Defense)}if(a.spAllocation){let e={A:a.spAllocation.A||0,B:a.spAllocation.B||0,C:a.spAllocation.C||0},t=y(e,W),r={体力:"HP",力:"Power",魔力:"Magic",精神:"Mind",素早さ:"Agility",器用さ:"Dex",撃力:"CritDamage",守備力:"Defense"};["A","B","C"].forEach(e=>{let a=t[e];Object.entries(a).forEach(e=>{let[t,a]=e,s=r[t];s&&a&&(U[s]=(U[s]||0)+a)})})}}let _={equipmentTotal:H,jobStats:{initial:K,sp:U,bonusPercent:V},food:n&&l?l.effects.reduce((e,t)=>{let a="";switch(t.stat){case"HP":a="HP";break;case"ATK":a="Power";break;case"MATK":a="Magic";break;case"DEF":a="Defense";break;case"MDEF":a="Mind";break;case"DEX":a="Dex";break;case"AGI":a="Agility";break;case"HIT":a="CritDamage";break;default:a=t.stat}return t.isPercent||(e[a]=(e[a]||0)+t.value),e},{}):{},userOption:Object.entries(r.manualStats||{}).reduce((e,t)=>{let[a,r]=t,s="";switch(a){case"HP":s="HP";break;case"ATK":s="Power";break;case"MATK":s="Magic";break;case"DEF":s="Defense";break;case"MDEF":s="Mind";break;case"DEX":s="Dex";break;case"AGI":s="Agility";break;case"HIT":s="CritDamage";break;default:s=a}return r&&(e[s]=r),e},{}),ring:s.enabled&&"none"!==s.ringType?{enabled:!0,ringType:s.ringType,equipmentTotal:H}:void 0,weaponCritRate:o,userPercentBonus:Object.entries(r.percentBonus||{}).reduce((e,t)=>{let[a,r]=t,s="";switch(a){case"HP":s="HP";break;case"ATK":s="Power";break;case"MATK":s="Magic";break;case"DEF":s="Defense";break;case"MDEF":s="Mind";break;case"DEX":s="Dex";break;case"AGI":s="Agility";break;case"HIT":s="CritDamage";break;default:s=a}return r&&(e[s]=r),e},{}),recursiveEnabled:!1,emblemBonusPercent:c?{Power:c["力（%不要）"]||0,Magic:c["魔力（%不要）"]||0,HP:c["体力（%不要）"]||0,Mind:c["精神（%不要）"]||0,Agility:c["素早さ（%不要）"]||0,Dex:c["器用（%不要）"]||0,CritDamage:c["撃力（%不要）"]||0,Defense:c["守備力（%不要）"]||0}:{},runestoneBonus:b.reduce((e,t)=>(t.力&&(e.Power=(e.Power||0)+t.力),t.魔力&&(e.Magic=(e.Magic||0)+t.魔力),t.体力&&(e.HP=(e.HP||0)+t.体力),t.精神&&(e.Mind=(e.Mind||0)+t.精神),t.素早さ&&(e.Agility=(e.Agility||0)+t.素早さ),t.器用&&(e.Dex=(e.Dex||0)+t.器用),t.撃力&&(e.CritDamage=(e.CritDamage||0)+t.撃力),t.守備力&&(e.Defense=(e.Defense||0)+t.守備力),e),{})},z=function(e,t){try{var a,r,s;let l;if(!e.jobStats)return{success:!1,error:{code:"INVALID_INPUT",message:"職業ステータスが指定されていません"}};let n=e.equipmentTotal||{},i=e.jobStats.initial||{},o=e.jobStats.sp||{},c=e.food||{},m=e.userOption||{},p=e.jobStats.bonusPercent||{},g=e.emblemBonusPercent||{},b=e.runestoneBonus||{},f=e.jobLevel||1,v=void 0,y=function(e,t,a,r,s,l){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,i=arguments.length>7?arguments[7]:void 0;if(i){let o={};for(let c of Array.from(new Set([...Object.keys(e),...Object.keys(t),...Object.keys(a),...Object.keys(r),...Object.keys(s),...Object.keys(l)]))){let m={["SumEquipment.".concat(c)]:e[c]||0,["Job.Initial.".concat(c)]:t[c]||0,["Job.SP.".concat(c)]:a[c]||0,["Food.".concat(c)]:r[c]||0,["UserOption.".concat(c)]:s[c]||0,["Runestone.".concat(c)]:l[c]||0,JobLevel:n},x=i.replace(/<Stat>/g,c);try{o[c]=u(d(x,m))}catch(n){console.warn("Failed to evaluate formula for ".concat(c,", using default calculation"),n),o[c]=(e[c]||0)+(t[c]||0)+(a[c]||0)+(r[c]||0)+(s[c]||0)+(l[c]||0)}}return o}return x(e,t,a,r,s,l)}(n,i,o,c,m,b,f,v),j=y;if(v&&v.includes("Bonus")){let e={},t=new Set([...Object.keys(n),...Object.keys(i),...Object.keys(o),...Object.keys(c),...Object.keys(m),...Object.keys(b),...Object.keys(p),...Object.keys(g)]);for(let a of Array.from(t)){let t={["SumEquipment.".concat(a)]:n[a]||0,["Job.Initial.".concat(a)]:i[a]||0,["Job.SP.".concat(a)]:o[a]||0,["Food.".concat(a)]:c[a]||0,["UserOption.".concat(a)]:m[a]||0,["Runestone.".concat(a)]:b[a]||0,["Job.Bonus.".concat(a)]:p[a]||0,["Emblem.Bonus.".concat(a)]:g[a]||0,JobLevel:f},r=v.replace(/<Stat>/g,a);try{e[a]=u(d(r,t))}catch(s){console.warn("Failed to evaluate full formula for ".concat(a,", using fallback"),s);let t=(n[a]||0)+(i[a]||0)+(o[a]||0)+(c[a]||0)+(m[a]||0)+(b[a]||0),r=1+((p[a]||0)+(g[a]||0))/100;e[a]=u(t*r)}}j=e}else j=function(e,t,a){let r={};for(let s of Array.from(new Set([...Object.keys(e),...Object.keys(t),...Object.keys(a)]))){let l=e[s]||0,n=t[s]||0,i=1+(n+(a[s]||0))/100;r[s]=u(l*i)}return r}(y,p,g);let N=j;if(e.userPercentBonus){let t=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;if(!Object.values(t).some(e=>e&&0!==e))return{final:h(e),iterations:0,delta:{}};let s=h(e),l=0;if(!a){let a={};for(let e of Array.from(new Set([...Object.keys(s),...Object.keys(t)]))){let r=s[e]||0,l=t[e]||0;a[e]=u(r*(1+l/100))}let r={};for(let t in a){let s=e[t]||0,l=a[t]||0;r[t]=l-s}return{final:a,iterations:1,delta:r}}for(let e=0;e<r;e++){l++;let e={},a=new Set([...Object.keys(s),...Object.keys(t)]),r=0;for(let l of Array.from(a)){let a=s[l]||0,n=u(a*(1+(t[l]||0)/100));e[l]=n;let i=Math.abs(n-a);i>r&&(r=i)}if(s=e,r<1)break}let n={};for(let t in s){let a=e[t]||0,r=s[t]||0;n[t]=r-a}return{final:s,iterations:l,delta:n}}(j,e.userPercentBonus,e.recursiveEnabled||!1);N=t.final,t.iterations,t.delta}let k=N;if((null===(a=e.ring)||void 0===a?void 0:a.enabled)&&(null===(r=e.ring)||void 0===r?void 0:r.ringType)&&(null===(s=e.ring)||void 0===s?void 0:s.equipmentTotal)){let a=function(e,t,a){var r,s,l,n;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o=arguments.length>4?arguments[4]:void 0,c="power"===t?"Power":"magic"===t?"Magic":"Agility",d=e[c]||0;if(d<=0)return{final:h(e),iterations:0,delta:{}};let m=h(e),x=0,p=null!==(l=null==o?void 0:null===(r=o.RingConvergence)||void 0===r?void 0:r.BaseValue)&&void 0!==l?l:40,g=null!==(n=null==o?void 0:null===(s=o.RingConvergence)||void 0===s?void 0:s.Multiplier)&&void 0!==n?n:.1,b=d+p+d*g;x++;for(let e=0;e<i;e++){let e=d+p+u(b*g);if(x++,e===Math.floor(b)){b=e;break}b=e}let f=Math.floor(b);m[c]=f;let v={};return v[c]=f-d,{final:m,iterations:x,delta:v}}(N,e.ring.ringType,e.ring.equipmentTotal,100,t);k=a.final,l={iterations:a.iterations,delta:a.delta}}let w=e.weaponCritRate||0,D=k.UserCritRate||k.CritRate||k.DEX||k.Dex||k.dex||k.器用さ||0,S={breakdown:{equipment:n,jobInitial:i,jobSP:o,food:c,userOption:m,runestone:b},base:y,bonusPercent:{job:p,emblem:g,total:x(p,g)},ring:l,final:k,critRate:w+.3*D};return{success:!0,data:S}}catch(e){return{success:!1,error:{code:"CALCULATION_ERROR",message:e instanceof Error?e.message:"ステータス計算中にエラーが発生しました",context:{error:e}}}}}(_);if(z.success&&z.data){let a=S(z.data);e({calculatedStats:a,weaponStats:t})}else console.error("ステータス計算エラー: result.success is false"),e({calculatedStats:P(),weaponStats:null})}catch(t){console.error("計算中にエラーが発生しました:",t),console.error("エラーの詳細:",{error:t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t,currentBuild:a,gameData:{hasEqConst:!!i.eqConst,hasJobConst:!!i.jobConst,hasJobSPData:!!i.jobSPData}}),e({calculatedStats:P(),weaponStats:null})}},savePreset:a=>{var r,s;let l=t(),n=Date.now(),i={id:"preset_".concat(n,"_").concat(Math.random().toString(36).substr(2,9)),name:a,createdAt:n,updatedAt:n,build:JSON.parse(JSON.stringify(l.currentBuild)),userOption:JSON.parse(JSON.stringify(l.userOption)),ringOption:JSON.parse(JSON.stringify(l.ringOption)),selectedFoodId:(null===(r=l.selectedFood)||void 0===r?void 0:r.id)||null,foodEnabled:l.foodEnabled,weaponSkillEnabled:l.weaponSkillEnabled,selectedEmblemName:(null===(s=l.selectedEmblem)||void 0===s?void 0:s.name)||null,selectedRunestoneNames:l.selectedRunestones.map(e=>e.name)},o=[...l.presets,i];e({presets:o});try{localStorage.setItem(D,JSON.stringify(o))}catch(e){console.error("プリセットの保存に失敗しました:",e)}},loadPreset:a=>{let r=t(),s=r.presets.find(e=>e.id===a);if(!s){console.warn("プリセット(".concat(a,")が見つかりません"));return}if(e({currentBuild:JSON.parse(JSON.stringify(s.build)),userOption:JSON.parse(JSON.stringify(s.userOption)),ringOption:JSON.parse(JSON.stringify(s.ringOption)),foodEnabled:s.foodEnabled,weaponSkillEnabled:s.weaponSkillEnabled}),s.selectedFoodId){let t=r.availableFoods.find(e=>e.id===s.selectedFoodId);t&&e({selectedFood:t})}else e({selectedFood:null});if(s.selectedEmblemName){let t=r.availableEmblems.find(e=>e.name===s.selectedEmblemName);t&&e({selectedEmblem:t})}else e({selectedEmblem:null});e({selectedRunestones:s.selectedRunestoneNames.map(e=>r.availableRunestones.find(t=>t.name===e)).filter(e=>void 0!==e)}),t().recalculateStats()},deletePreset:a=>{let r=t().presets.filter(e=>e.id!==a);e({presets:r});try{localStorage.setItem(D,JSON.stringify(r))}catch(e){console.error("プリセットの削除に失敗しました:",e)}},updatePreset:(a,r)=>{var s,l;let n=t(),i=n.presets.findIndex(e=>e.id===a);if(-1===i){console.warn("プリセット(".concat(a,")が見つかりません"));return}let o=Date.now(),c={...n.presets[i],name:r||n.presets[i].name,updatedAt:o,build:JSON.parse(JSON.stringify(n.currentBuild)),userOption:JSON.parse(JSON.stringify(n.userOption)),ringOption:JSON.parse(JSON.stringify(n.ringOption)),selectedFoodId:(null===(s=n.selectedFood)||void 0===s?void 0:s.id)||null,foodEnabled:n.foodEnabled,weaponSkillEnabled:n.weaponSkillEnabled,selectedEmblemName:(null===(l=n.selectedEmblem)||void 0===l?void 0:l.name)||null,selectedRunestoneNames:n.selectedRunestones.map(e=>e.name)},d=[...n.presets];d[i]=c,e({presets:d});try{localStorage.setItem(D,JSON.stringify(d))}catch(e){console.error("プリセットの更新に失敗しました:",e)}},loadPresetsFromStorage:()=>{try{let t=localStorage.getItem(D);if(t){let a=JSON.parse(t);e({presets:a})}}catch(e){console.error("プリセットの読み込みに失敗しました:",e)}}}));var A=a(6635);class R extends Error{constructor(e,t,a){super(e),this.fileName=t,this.originalError=a,this.name="DataLoadError"}}class F extends R{constructor(e,t){super("Failed to parse YAML file: ".concat(e),e,t),this.name="YamlParseError"}}class L extends R{constructor(e,t,a){super(t?"Failed to parse CSV file: ".concat(e," at line ").concat(t):"Failed to parse CSV file: ".concat(e),e,a),this.line=t,this.name="CsvParseError"}}class B extends R{constructor(e){super("File not found: ".concat(e),e),this.name="FileNotFoundError"}}class O{static addError(e){this.errors.push(e),console.error("[".concat(e.name,"] ").concat(e.message),e.originalError)}static getErrors(){return[...this.errors]}static clearErrors(){this.errors=[]}static hasErrors(){return this.errors.length>0}static getErrorSummary(){if(0===this.errors.length)return"No errors";let e=this.errors.map(e=>"- ".concat(e.name,": ").concat(e.message)).join("\n");return"Data loading errors (".concat(this.errors.length,"):\n").concat(e)}}function T(e,t,a){return e().catch(e=>(a&&console.warn(a,e),t))}O.errors=[];let I={"<AgilityFactor>":"UserAgility","<Level>":"SkillLevel","<JobLevel>":"JobLevel","<ReinforcementLevel>":"ReinforcementLevel","<ForgeCount>":"ForgeCount","<ForgeCritRAmount>":"ForgeCritR","<ForgeCritDAmount>":"ForgeCritD","<ForgeAttackPAmount>":"ForgeAttackP","<Stat>":"StatName"};async function q(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.split("/").pop()||e;try{let r;let s=await fetch(e);if(!s.ok){if(404===s.status){let e=new B(a);throw O.addError(e),e}throw Error("Failed to load ".concat(e,": ").concat(s.statusText))}let l=await s.text();try{r=A.zD(l),t&&(r=function e(t){if("string"==typeof t)return function(e){if("string"!=typeof e)return e;let t=e;for(let[e,a]of Object.entries(I))t=t.replace(RegExp(e.replace(/[<>]/g,"\\$&"),"g"),a);return t}(t);if(Array.isArray(t))return t.map(t=>e(t));if("object"==typeof t&&null!==t){let a={};for(let[r,s]of Object.entries(t))a[r]=e(s);return a}return t}(r))}catch(t){let e=new F(a,t instanceof Error?t:void 0);throw O.addError(e),e}return r}catch(r){if(r instanceof B||r instanceof F)throw r;console.error("Error loading YAML file ".concat(e,":"),r);let t=new F(a,r instanceof Error?r:void 0);throw O.addError(t),t}}async function H(){return q("/data/formula/EqConst.yaml")}async function W(){return q("/data/formula/JobConst.yaml")}async function J(){return q("/data/formula/WeaponCalc.yaml",!0)}async function K(){return q("/data/formula/UserStatusCalc.yaml",!0)}async function U(){return{}}async function V(){return q("/data/formula/WeaponSkillCalc.yaml",!0)}async function _(){let e="/data/formula/SkillCalc",[t,a,r,s,l]=await Promise.all([T(()=>q("".concat(e,"/SkillBook.yaml"),!0),{},"Warning: Failed to load SkillBook.yaml"),T(()=>q("".concat(e,"/SkillSpecialJob.yaml"),!0),{},"Warning: Failed to load SkillSpecialJob.yaml"),T(()=>q("".concat(e,"/SkillFirstJob.yaml"),!0),{},"Warning: Failed to load SkillFirstJob.yaml"),T(()=>q("".concat(e,"/SkillSecondJob.yaml"),!0),{},"Warning: Failed to load SkillSecondJob.yaml"),T(()=>q("".concat(e,"/SkillThirdJob.yaml"),!0),{},"Warning: Failed to load SkillThirdJob.yaml")]);return{skillBook:t||{},specialJob:a||{},firstJob:r||{},secondJob:s||{},thirdJob:l||{}}}function z(e){return e.Heal?"heal":e.Buff&&Object.keys(e.Buff).length>0?"buff":e.Debuff&&Object.keys(e.Debuff).length>0?"debuff":e.Damage?"damage":"utility"}async function X(){let[e,t,a,r,s,l]=await Promise.all([T(()=>H(),{},"Warning: Failed to load EqConst.yaml"),T(()=>W(),{},"Warning: Failed to load JobConst.yaml"),T(()=>J(),{},"Warning: Failed to load WeaponCalc.yaml"),T(()=>K(),{},"Warning: Failed to load UserStatusCalc.yaml"),T(()=>U(),{},"Info: SkillCalc.yaml not found (migrated to SkillCalc folder)"),T(()=>V(),{},"Warning: Failed to load WeaponSkillCalc.yaml")]);return{eqConst:e,jobConst:t,weaponCalc:a,userStatusCalc:r,skillCalc:s,weaponSkillCalc:l}}async function G(e){let t=e.split("/").pop()||e;try{let a=await fetch(e);if(!a.ok){if(404===a.status){let e=new B(t);throw O.addError(e),e}throw Error("Failed to load ".concat(e,": ").concat(a.statusText))}let r=await a.text();return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";try{let r=e.trim().split("\n");if(0===r.length)return[];let s=r[0].replace(/^\uFEFF/,"");r[0]=s;let l=r[0].split(",").map(e=>e.trim()),n=[];for(let e=1;e<r.length;e++)try{let t=r[e].split(","),s={};for(let e=0;e<l.length;e++){var a;let r=l[e],n=(null===(a=t[e])||void 0===a?void 0:a.trim())||"";""===n||isNaN(Number(n))?"TRUE"===n||"FALSE"===n?s[r]="TRUE"===n:s[r]=n:s[r]=Number(n)}n.push(s)}catch(a){console.warn("Failed to parse CSV row ".concat(e+1," in ").concat(t,":"),a)}return n}catch(a){let e=new L(t,void 0,a instanceof Error?a:void 0);throw O.addError(e),e}}(r,t)}catch(r){if(r instanceof B||r instanceof L)throw r;console.error("Error loading CSV file ".concat(e,":"),r);let a=new L(t,void 0,r instanceof Error?r:void 0);throw O.addError(a),a}}function $(e){return({SSS:8,SS:7,S:6,A:5,B:4,C:3,D:2,E:1,F:0})[e]||0}async function Y(e){return(await G("/data/csv/Equipment/DA_EqCalc_Data - 武器.csv")).filter(e=>e.アイテム名&&""!==e.アイテム名.toString().trim()).map(e=>(function(e,t){if(!e.最低ランク||""===e.最低ランク||"F"===e.最低ランク)return e;let a=$(e.最低ランク)-$("F");if(a<=0)return e;let r={...e};return r["攻撃力（初期値）"]&&(r["攻撃力（初期値）"]=r["攻撃力（初期値）"]-10*a),r["会心率（初期値）"]&&(r["会心率（初期値）"]=r["会心率（初期値）"]-1*a),r["会心ダメージ（初期値）"]&&(r["会心ダメージ（初期値）"]=r["会心ダメージ（初期値）"]-2*a),r})(e,0))}async function Z(){return(await G("/data/csv/Equipment/DA_EqCalc_Data - 防具.csv")).filter(e=>{let t=e["アイテム名(種類でOK)"]||e["アイテム名"];return t&&""!==t.toString().trim()}).map(e=>({アイテム名:e["アイテム名(種類でOK)"]||e["アイテム名"],使用可能Lv:e["使用可能Lv"],部位を選択:e["部位を選択"],タイプを選択:e["タイプを選択"],"力（初期値）":e["力（初期値）"],"魔力（初期値）":e["魔力（初期値）"],"体力（初期値）":e["体力（初期値）"],"精神（初期値）":e["精神（初期値）"],"素早さ（初期値）":e["素早さ（初期値）"],"器用（初期値）":e["器用（初期値）"],"撃力（初期値）":e["撃力（初期値）"],"守備力（初期値）":e["守備力（初期値）"]}))}async function Q(){return(await G("/data/csv/Equipment/DA_EqCalc_Data - アクセサリー .csv")).filter(e=>e["アイテム名"]&&""!==e["アイテム名"].toString().trim()).map(e=>({アイテム名:e["アイテム名"],使用可能Lv:e["使用可能Lv"],タイプを選択:e["タイプを選択"],"体力（初期値）":e["体力（初期値）"],"力（初期値）":e["力（初期値）"],"魔力（初期値）":e["魔力（初期値）"],"精神（初期値）":e["精神（初期値）"],"撃力（初期値）":e["撃力（初期値）"],"素早さ（初期値）":e["素早さ（初期値）"]}))}async function ee(){return(await G("/data/csv/Equipment/DA_EqCalc_Data - 紋章.csv")).map(e=>{let t=e["アイテム名"]||"";return{name:t,アイテム名:t,使用可能Lv:e["使用可能Lv"]||1,"力（%不要）":e["力（%不要）"]||void 0,"魔力（%不要）":e["魔力（%不要）"]||void 0,"体力（%不要）":e["体力（%不要）"]||void 0,"精神（%不要）":e["精神（%不要）"]||void 0,"素早さ（%不要）":e["素早さ（%不要）"]||void 0,"器用（%不要）":e["器用（%不要）"]||void 0,"撃力（%不要）":e["撃力（%不要）"]||void 0,"守備力（%不要）":e["守備力（%不要）"]||void 0}})}async function et(){return(await G("/data/csv/Equipment/DA_EqCalc_Data - ルーンストーン.csv")).map(e=>{let t=e["アイテム名（・<グレード>）は不要"]||"",a={name:t,"アイテム名（・<グレード>）は不要":t,グレード:e["グレード"],力:e["力"]||void 0,魔力:e["魔力"]||void 0,体力:e["体力"]||void 0,精神:e["精神"]||void 0,素早さ:e["素早さ"]||void 0,器用:e["器用"]||void 0,撃力:e["撃力"]||void 0,守備力:e["守備力"]||void 0};e["耐性１"]&&e["値(%除く)"]&&(a.耐性1={type:String(e["耐性１"]),value:Number(e["値(%除く)"])||0}),Object.keys(e).filter(e=>"値"===e||e.startsWith("値."));for(let t=2;t<=6;t++){let r=e["耐性".concat(2===t?"２":3===t?"３":4===t?"４":5===t?"５":"６")];if(r&&""!==String(r).trim()){let s=t-2,l=e[0===s?"値":"値.".concat(s)];void 0!==l&&""!==l&&(a["耐性".concat(t)]={type:String(r),value:Number(l)||0})}}return a})}async function ea(){return(await G("/data/csv/Equipment/DA_EqCalc_Data - 食べ物.csv")).map(e=>{let t={アイテム名:e["アイテム名"]||"",力:e["力"]||void 0,魔力:e["魔力"]||void 0,体力:e["体力"]||void 0,精神:e["精神"]||void 0,素早さ:e["素早さ"]||void 0,器用:e["器用"]||void 0,撃力:e["撃力"]||void 0,守備力:e["守備力"]||void 0};e["耐性１"]&&void 0!==e["値(%除く)"]&&(t.耐性1={type:String(e["耐性１"]),value:Number(e["値(%除く)"])||0});for(let a=2;a<=8;a++){let r=e["耐性".concat(2===a?"２":3===a?"３":4===a?"４":5===a?"５":6===a?"６":7===a?"7":"8")];if(r&&""!==String(r).trim()){let s=a-2,l=e[0===s?"値":"値.".concat(s)];void 0!==l&&""!==l&&(t["耐性".concat(a)]={type:String(r),value:Number(l)||0})}}return t})}async function er(e){return G("/data/csv/Job/".concat(e,".csv"))}async function es(e){let[t,a,r,s,l,n]=await Promise.all([Y(e),Z(),Q(),ee(),et(),ea()]);return{weapons:t,armors:a,accessories:r,emblems:s,runestones:l,foods:n}}async function el(){let e=new Map;return await Promise.all(["ガーディアン","ステラシャフト","スペルリファクター","プリースト","ウィザード","ウォーリアー","クレリック","ナイト","ハンター","レンジャー","ノービス"].map(async t=>{try{let a=await er(t);e.set(t,a)}catch(e){console.warn("Failed to load job data for ".concat(t,":"),e)}})),e}async function en(){try{O.clearErrors();let e=await T(()=>X(),{eqConst:{},jobConst:{},weaponCalc:{},userStatusCalc:{},skillCalc:{},weaponSkillCalc:{}},"Warning: Failed to load some YAML files, using default values"),[t,a]=await Promise.all([T(()=>es(e.eqConst),{weapons:[],armors:[],accessories:[],emblems:[],runestones:[],foods:[]},"Warning: Failed to load some equipment CSV files"),T(()=>el(),new Map,"Warning: Failed to load job CSV files")]),r={yaml:e,csv:{...t,jobs:a}};return r.yaml.eqConst&&0!==Object.keys(r.yaml.eqConst).length||console.warn("EqConst data is empty or missing"),r.yaml.weaponCalc&&0!==Object.keys(r.yaml.weaponCalc).length||console.warn("WeaponCalc data is empty or missing"),r.yaml.userStatusCalc&&0!==Object.keys(r.yaml.userStatusCalc).length||console.warn("UserStatusCalc data is empty or missing"),0===r.csv.weapons.length&&console.warn("No weapon data loaded"),0===r.csv.armors.length&&console.warn("No armor data loaded"),0===r.csv.jobs.size&&console.warn("No job data loaded"),O.hasErrors()&&(console.warn("Some data files failed to load:"),console.warn(O.getErrorSummary())),r}catch(e){return console.error("Failed to initialize game data:",e),{yaml:{eqConst:{},jobConst:{},weaponCalc:{},userStatusCalc:{},skillCalc:{},weaponSkillCalc:{}},csv:{weapons:[],armors:[],accessories:[],emblems:[],runestones:[],foods:[],jobs:new Map}}}}let ei=e=>{let{className:t}=e;return(0,r.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("polyline",{points:"6 9 12 15 18 9"})})},eo=e=>{let{options:t,value:a,onChange:l,placeholder:n="選択してください",disabled:i=!1,className:o="",label:c,showIcon:d=!0,onOpenChange:u}=e,[m,x]=(0,s.useState)(!1),h=(0,s.useCallback)(e=>{x(e),null==u||u(e)},[u]),[p,g]=(0,s.useState)(-1),b=(0,s.useRef)(null),f=(0,s.useRef)(null),v=t.find(e=>e.value===a),y=(0,s.useCallback)(e=>{var t;l&&l(e),h(!1),g(-1),null===(t=f.current)||void 0===t||t.focus()},[l]);(0,s.useEffect)(()=>{let e=e=>{b.current&&!b.current.contains(e.target)&&h(!1)};return m&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]),(0,s.useEffect)(()=>{let e=e=>{if(!m){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),h(!0));return}switch(e.key){case"Escape":var a;h(!1),null===(a=f.current)||void 0===a||a.focus();break;case"ArrowDown":e.preventDefault(),g(e=>e<t.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),g(e=>e>0?e-1:t.length-1);break;case"Enter":e.preventDefault(),p>=0&&t[p]&&y(t[p].value)}};return(m||document.activeElement===f.current)&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[m,p,t,y]);let j=e=>(0,r.jsxs)(r.Fragment,{children:[d&&e.icon&&(0,r.jsx)("span",{className:"mr-2 text-lg flex-shrink-0",children:(e.icon,e.icon)}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("span",{className:"block",children:e.label}),e.description&&(0,r.jsx)("span",{className:"text-xs text-gray-400 mt-0.5 block",children:e.description})]})]});return(0,r.jsxs)("div",{className:"relative ".concat(o),ref:b,children:[c&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:c}),(0,r.jsxs)("button",{ref:f,type:"button",onClick:()=>!i&&h(!m),disabled:i,className:"\n          w-full px-4 py-3 rounded-xl text-left\n          bg-glass-dark backdrop-blur-md\n          border border-white/20\n          transition-all duration-200\n          flex items-center justify-between\n          ".concat(i?"opacity-50 cursor-not-allowed":"hover:border-white/30 cursor-pointer","\n          ").concat(m?"border-rpg-accent/50 ring-2 ring-rpg-accent/20":"","\n          focus:outline-none focus:border-rpg-accent/50 focus:ring-2 focus:ring-rpg-accent/20\n        "),"aria-haspopup":"listbox","aria-expanded":m,"aria-label":c||"Select option",children:[(0,r.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:v?j(v):(0,r.jsx)("span",{className:"text-gray-400",children:n})}),(0,r.jsx)(ei,{className:"\n            w-5 h-5 text-gray-400 ml-2 flex-shrink-0\n            transition-transform duration-200\n            ".concat(m?"transform rotate-180":"","\n          ")})]}),m&&(0,r.jsx)("div",{className:"\n            absolute z-[99999] w-full mt-2\n            bg-gray-900 bg-opacity-95 backdrop-blur-xl\n            border border-white/30 rounded-xl\n            shadow-2xl shadow-black/50 overflow-hidden\n            animate-slideDown\n          ",role:"listbox",children:(0,r.jsx)("div",{className:"max-h-72 overflow-y-auto custom-scrollbar py-2",children:t.map((e,t)=>(0,r.jsx)("button",{type:"button",onClick:()=>y(e.value),onMouseEnter:()=>g(t),className:"\n                  w-full px-4 py-3 text-left\n                  flex items-center\n                  transition-all duration-150\n                  ".concat(a===e.value?"bg-rpg-accent/30 text-white":"text-gray-300 hover:bg-white/10 hover:text-white","\n                  ").concat(p===t?"bg-white/10":"","\n                "),role:"option","aria-selected":a===e.value,children:j(e)},e.value))})})]})};if("undefined"!=typeof document){let e=document.createElement("style");e.textContent="\n  @keyframes slideDown {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  .animate-slideDown {\n    animation: slideDown 0.2s ease-out;\n  }\n\n  .custom-scrollbar::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  .custom-scrollbar::-webkit-scrollbar-track {\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 3px;\n  }\n\n  .custom-scrollbar::-webkit-scrollbar-thumb {\n    background: rgba(255, 255, 255, 0.2);\n    border-radius: 3px;\n  }\n\n  .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n",document.head.appendChild(e)}let ec={ガーディアン:"\uD83D\uDEE1️",ステラシャフト:"⭐",スペルリファクター:"\uD83D\uDD2E",ノービス:"\uD83D\uDC64",プリースト:"✨",戦士:"⚔️",魔法使い:"\uD83E\uDDD9",弓使い:"\uD83C\uDFF9",盗賊:"\uD83D\uDDE1️",ファイター:"⚔️",アコライト:"\uD83D\uDD6F️",アーチャー:"\uD83C\uDFF9",メイジ:"\uD83D\uDD2E",クレリック:"✝️",ハンター:"\uD83C\uDFAF",レンジャー:"\uD83C\uDF32",ウィザード:"\uD83E\uDDD9‍♂️",ナイト:"\uD83D\uDDE1️",ウォリアー:"\uD83D\uDCAA"},ed={all:"すべて",Special:"特殊職",First:"1次職",Second:"2次職",Third:"3次職"},eu=["all","Special","First","Second","Third"],em=e=>{let{jobs:t,selectedJob:a,onChange:l,disabled:n=!1,className:i="",jobConst:o}=e,[c,d]=(0,s.useState)("all"),u=e=>{if(!(null==o?void 0:o.JobDefinition))return null;let t=w(e.id),a=o.JobDefinition[t];return(null==a?void 0:a.Grade)||null},m=(0,s.useMemo)(()=>"all"===c?t:t.filter(e=>u(e)===c),[t,c,o]),x=(0,s.useMemo)(()=>{let e={all:t.length,Special:0,First:0,Second:0,Third:0};return t.forEach(t=>{let a=u(t);a&&a in e&&e[a]++}),e},[t,o]),h=m.map(e=>{let t=u(e),a=t?ed[t]:"";return{value:e.id,label:e.name,icon:ec[e.name]||"\uD83D\uDC64",description:"".concat(a?"[".concat(a,"] "):"","Lv.").concat(e.maxLevel,"まで成長可能")}});return(0,r.jsxs)("div",{className:"".concat(i),children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"職業グレードで絞り込み"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:eu.map(e=>{let t=x[e],a=c===e;return(0,r.jsxs)("button",{onClick:()=>d(e),disabled:n||0===t,className:"\n                  px-3 py-1.5 rounded-lg text-sm font-medium transition-all\n                  ".concat(a?"bg-rpg-accent text-white shadow-lg shadow-rpg-accent/30":"bg-gray-700 text-gray-300 hover:bg-gray-600","\n                  ").concat(n||0===t?"opacity-50 cursor-not-allowed":"","\n                "),children:[ed[e],(0,r.jsxs)("span",{className:"ml-1.5 text-xs ".concat(a?"text-white/80":"text-gray-500"),children:["(",t,")"]})]},e)})})]}),(0,r.jsx)(eo,{options:h,value:(null==a?void 0:a.id)||"",onChange:e=>{""===e?l(null):l(t.find(t=>t.id===e)||null)},placeholder:"職業を選択してください",disabled:n,label:"職業選択"}),a&&(0,r.jsxs)("div",{className:"mt-3 p-3 glass-card-secondary rounded-lg animate-fadeIn",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"使用可能武器:"}),u(a)&&(0,r.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-rpg-accent/20 text-rpg-accent border border-rpg-accent/30",children:ed[u(a)]})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:a.availableWeapons.map(e=>(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-rpg-accent/20 text-rpg-accent border border-rpg-accent/30 rounded",children:ex(e)},e))})]})]})},ex=e=>({sword:"剣",greatsword:"大剣",dagger:"短剣",axe:"斧",spear:"槍",bow:"弓",staff:"杖",mace:"メイス",katana:"刀",fist:"拳"})[e]||e,eh=e=>{let{value:t,onChange:a,min:l,max:n,step:i=1,label:o,disabled:c=!1,className:d="",showStepper:u=!0,error:m,placeholder:x}=e,[h,p]=(0,s.useState)(t.toString()),g=(0,s.useRef)(null);(0,s.useEffect)(()=>{p(t.toString())},[t]);let b=()=>{if(c)return;let e=t+i;(void 0===n||e<=n)&&a(e)},f=()=>{if(c)return;let e=t-i;(void 0===l||e>=l)&&a(e)},v=c||void 0!==l&&t<=l,y=c||void 0!==n&&t>=n;return(0,r.jsxs)("div",{className:"".concat(d),children:[o&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center ".concat(m?"ring-2 ring-red-500":""," rounded-md"),children:[u&&(0,r.jsx)("button",{type:"button",onClick:f,disabled:v,className:"\n                px-3 py-2 text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700\n                rounded-l-md border border-r-0 border-gray-300 dark:border-gray-600\n                hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2\n                focus:ring-blue-500 focus:ring-inset transition-colors\n                ".concat(v?"opacity-50 cursor-not-allowed":"cursor-pointer","\n              "),"aria-label":"Decrease value",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),(0,r.jsx)("input",{ref:g,type:"text",value:h,onChange:e=>{let t=e.target.value;if(p(t),""===t||"-"===t)return;let r=Number(t);if(!isNaN(r)){let e=r;void 0!==l&&r<l&&(e=l),void 0!==n&&r>n&&(e=n),a(e)}},onBlur:()=>{if(""===h||"-"===h)p(t.toString());else{let e=Number(h);if(isNaN(e))p(t.toString());else{let r=e;void 0!==l&&e<l&&(r=l),void 0!==n&&e>n&&(r=n),p(r.toString()),r!==t&&a(r)}}},onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),b()):"ArrowDown"===e.key&&(e.preventDefault(),f())},disabled:c,placeholder:x,className:"\n              flex-1 px-3 py-2 text-center bg-white dark:bg-gray-800\n              border-y border-gray-300 dark:border-gray-600\n              ".concat(u?"":"border-x rounded-md","\n              text-gray-900 dark:text-gray-100\n              focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset\n              disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:opacity-50\n              transition-colors\n            "),"aria-label":o||"Number input","aria-invalid":!!m,"aria-describedby":m?"number-input-error":void 0}),u&&(0,r.jsx)("button",{type:"button",onClick:b,disabled:y,className:"\n                px-3 py-2 text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700\n                rounded-r-md border border-l-0 border-gray-300 dark:border-gray-600\n                hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2\n                focus:ring-blue-500 focus:ring-inset transition-colors\n                ".concat(y?"opacity-50 cursor-not-allowed":"cursor-pointer","\n              "),"aria-label":"Increase value",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),m&&(0,r.jsx)("p",{id:"number-input-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m})]})]})},ep=e=>{let{level:t,onChange:a,maxLevel:s=100,minLevel:l=1,disabled:n=!1,className:i=""}=e;return(0,r.jsxs)("div",{className:"".concat(i),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"レベル"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(最小: ",l,", 最大: ",s,")"]})]}),(0,r.jsx)(eh,{value:t,onChange:e=>{e<l?a(l):e>s?a(s):a(e)},min:l,max:s,step:1,disabled:n,showStepper:!0,error:t<l?"レベルは".concat(l,"以上である必要があります"):t>s?"レベルは".concat(s,"以下である必要があります"):void 0,placeholder:"レベルを入力"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>a(1),disabled:n,className:"\n              px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300\n              rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\n              ".concat(n?"opacity-50 cursor-not-allowed":"cursor-pointer","\n            "),children:"Lv.1"}),(0,r.jsx)("button",{type:"button",onClick:()=>a(50),disabled:n||s<50,className:"\n              px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300\n              rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\n              ".concat(n||s<50?"opacity-50 cursor-not-allowed":"cursor-pointer","\n            "),children:"Lv.50"}),(0,r.jsxs)("button",{type:"button",onClick:()=>a(s),disabled:n,className:"\n              px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300\n              rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\n              ".concat(n?"opacity-50 cursor-not-allowed":"cursor-pointer","\n            "),children:["Lv.",s]})]}),(0,r.jsxs)("div",{className:"relative pt-1",children:[(0,r.jsx)("div",{className:"flex mb-1 items-center justify-between",children:(0,r.jsxs)("div",{className:"text-xs font-semibold inline-block text-blue-600 dark:text-blue-400",children:[Math.round(t/s*100),"%"]})}),(0,r.jsx)("div",{className:"overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200 dark:bg-gray-700",children:(0,r.jsx)("div",{style:{width:"".concat(t/s*100,"%")},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 transition-all duration-300"})})]})]})]})},eg=e=>{let{spValues:t,maxSP:a,maxSPByBranch:l,onChange:n,disabled:i=!1,className:o="",unlockedSkills:c,reachedTier:d,nextSkillInfo:u,branchBonus:m,jobSPData:x}=e,[h,p]=(0,s.useState)(t),[g,b]=(0,s.useState)(null),[f,v]=(0,s.useState)("A");(0,s.useEffect)(()=>{p(t)},[t]);let y=(0,s.useMemo)(()=>{if(!x)return{A:[],B:[],C:[]};let e={A:[],B:[],C:[]};for(let t of x){let a=t.解法段階.match(/^([A-C])-(\d+)$/);if(a){let r=a[1],s=parseInt(a[2]),l="string"==typeof t.必要SP?parseFloat(t.必要SP)||0:t.必要SP||0,n=e=>void 0===e||""===e?0:"number"==typeof e?e:parseFloat(e)||0;e[r].push({tier:s,branch:r,requiredSP:l,skillName:t.解法スキル名,stats:{力:n(t.力),体力:n(t.体力),魔力:n(t.魔力),精神:n(t.精神),素早さ:n(t.素早さ),器用さ:n(t.器用さ),撃力:n(t.撃力),守備力:n(t.守備力)},resistances:{物理耐性:n(t.物理耐性),魔耐性:n(t.魔耐性),炎耐性:n(t.炎耐性),水耐性:n(t.水耐性),雷耐性:n(t.雷耐性),風耐性:n(t.風耐性),無耐性:n(t.無耐性),闇耐性:n(t.闇耐性),光耐性:n(t.光耐性)}})}}return e.A.sort((e,t)=>e.tier-t.tier),e.B.sort((e,t)=>e.tier-t.tier),e.C.sort((e,t)=>e.tier-t.tier),e},[x]),j=Math.max(y.A.length,y.B.length,y.C.length),N=h.A+h.B+h.C>a,k=(e,t)=>{if(i)return;let r={...h};r[e]=Math.max(0,Math.min(l[e],t));let s=["A","B","C"].filter(t=>t!==e),o=s.reduce((e,t)=>e+r[t],0);if(r[e]+o>a){let t=(r[e]+o-a)/s.length;s.forEach(e=>{r[e]=Math.max(0,r[e]-Math.ceil(t))});let l=r.A+r.B+r.C;l>a&&(r[e]-=l-a)}p(r),n(r)},w=(e,t)=>{let a=parseInt(t,10);isNaN(a)||k(e,a)};return(0,r.jsx)("div",{className:"".concat(o),children:(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"SP割り振り"})}),N&&(0,r.jsx)("div",{className:"p-2 mb-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 rounded-md",children:(0,r.jsxs)("p",{className:"text-sm text-red-700 dark:text-red-300 flex items-center",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"SP合計が最大値を超えています！"]})}),(0,r.jsx)("div",{className:"space-y-4",children:["A","B","C"].map(e=>{let t=l[e]>0?h[e]/l[e]*100:0,a="A"===e?"上":"B"===e?"中":"下";return(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-800 ".concat(N&&h[e]>0?"ring-2 ring-red-400":""),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[a," ",h[e],"/",l[e]]}),(0,r.jsx)("input",{type:"number",value:h[e],onChange:t=>w(e,t.target.value),disabled:i,min:0,max:l[e],className:"\n                      w-16 px-2 py-1 text-sm text-center rounded border\n                      ".concat(N?"border-red-400 dark:border-red-600":"border-gray-300 dark:border-gray-600","\n                      bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100\n                      focus:outline-none focus:ring-2 focus:ring-blue-500\n                      disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:opacity-50\n                    ")})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"range",min:0,max:l[e],value:h[e],onChange:t=>k(e,parseInt(t.target.value,10)),onMouseDown:()=>b(e),onMouseUp:()=>b(null),onTouchStart:()=>b(e),onTouchEnd:()=>b(null),disabled:i,className:"\n                      w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\n                      disabled:opacity-50 disabled:cursor-not-allowed\n                      slider-".concat(e.toLowerCase(),"\n                    "),style:{background:"linear-gradient(to right, ".concat(eb(e)," 0%, ").concat(eb(e)," ").concat(t,"%, #e5e7eb ").concat(t,"%, #e5e7eb 100%)")}}),g===e&&(0,r.jsx)("div",{className:"absolute -top-8 px-2 py-1 bg-gray-900 text-white text-xs rounded pointer-events-none",style:{left:"".concat(t,"%"),transform:"translateX(-50%)"},children:h[e]})]})]},e)})}),(0,r.jsx)("div",{className:"mt-4 flex gap-2",children:(0,r.jsx)("button",{type:"button",onClick:()=>{let e={A:0,B:0,C:0};p(e),n(e)},disabled:i,className:"\n              px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300\n              rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\n              ".concat(i?"opacity-50 cursor-not-allowed":"cursor-pointer","\n            "),children:"リセット"})}),x&&j>0&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:"SPツリー"})]}),(0,r.jsx)("div",{className:"md:hidden flex gap-1 mb-3",children:["A","B","C"].map(e=>{let t="A"===e?"上":"B"===e?"中":"下",a="A"===e?"bg-red-900/50 text-red-400 border-red-500/50":"B"===e?"bg-green-900/50 text-green-400 border-green-500/50":"bg-blue-900/50 text-blue-400 border-blue-500/50";return(0,r.jsx)("button",{type:"button",onClick:()=>v(e),className:"flex-1 py-2 text-sm font-semibold rounded border transition-all ".concat(f===e?a:"bg-gray-800/30 text-gray-400 border-gray-600/30"),children:t},e)})}),(0,r.jsxs)("div",{className:"hidden md:grid grid-cols-3 gap-2 mb-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold text-red-400 text-center py-1.5 bg-red-900/30 rounded",children:"上"}),(0,r.jsx)("div",{className:"text-xs font-semibold text-green-400 text-center py-1.5 bg-green-900/30 rounded",children:"中"}),(0,r.jsx)("div",{className:"text-xs font-semibold text-blue-400 text-center py-1.5 bg-blue-900/30 rounded",children:"下"})]}),(0,r.jsx)("div",{className:"space-y-1 max-h-[480px] overflow-y-auto custom-scrollbar",children:Array.from({length:j},(e,t)=>t+1).map(e=>{let t=y.A.find(t=>t.tier===e),a=y.B.find(t=>t.tier===e),s=y.C.find(t=>t.tier===e),l=t&&h.A>=t.requiredSP,n=a&&h.B>=a.requiredSP,i=s&&h.C>=s.requiredSP,o=(e,t)=>e?t?"bg-lime-900/40 text-white border border-lime-500/50":"bg-gray-800/40 text-gray-200 opacity-70 border border-transparent":"bg-gray-800/30 text-gray-500 border border-transparent",c=e=>{let t=[];return e.力&&e.力>0&&t.push("力+".concat(e.力)),e.体力&&e.体力>0&&t.push("体力+".concat(e.体力)),e.魔力&&e.魔力>0&&t.push("魔力+".concat(e.魔力)),e.精神&&e.精神>0&&t.push("精神+".concat(e.精神)),e.素早さ&&e.素早さ>0&&t.push("速+".concat(e.素早さ)),e.器用さ&&e.器用さ>0&&t.push("器用+".concat(e.器用さ)),e.撃力&&e.撃力>0&&t.push("撃+".concat(e.撃力)),e.守備力&&e.守備力>0&&t.push("守+".concat(e.守備力)),t.join(" ")},d=e=>{let t=[];return e.物理耐性&&0!==e.物理耐性&&t.push("物理".concat(e.物理耐性>0?"+":"").concat(e.物理耐性,"%")),e.魔耐性&&0!==e.魔耐性&&t.push("魔法".concat(e.魔耐性>0?"+":"").concat(e.魔耐性,"%")),e.炎耐性&&0!==e.炎耐性&&t.push("炎".concat(e.炎耐性>0?"+":"").concat(e.炎耐性,"%")),e.水耐性&&0!==e.水耐性&&t.push("水".concat(e.水耐性>0?"+":"").concat(e.水耐性,"%")),e.雷耐性&&0!==e.雷耐性&&t.push("雷".concat(e.雷耐性>0?"+":"").concat(e.雷耐性,"%")),e.風耐性&&0!==e.風耐性&&t.push("風".concat(e.風耐性>0?"+":"").concat(e.風耐性,"%")),e.無耐性&&0!==e.無耐性&&t.push("無".concat(e.無耐性>0?"+":"").concat(e.無耐性,"%")),e.闇耐性&&0!==e.闇耐性&&t.push("闇".concat(e.闇耐性>0?"+":"").concat(e.闇耐性,"%")),e.光耐性&&0!==e.光耐性&&t.push("光".concat(e.光耐性>0?"+":"").concat(e.光耐性,"%")),t.join(" ")},u=(e,t)=>{if(!e)return(0,r.jsx)("div",{className:"text-center py-2 text-gray-400",children:"-"});let a=c(e.stats),s=d(e.resistances),l=!!e.skillName,n=!!a,i=!!s;return(0,r.jsx)("div",{className:"py-1.5 px-2",children:(0,r.jsxs)("div",{className:"flex items-start gap-1",children:[t&&(0,r.jsx)("span",{className:"text-green-400 flex-shrink-0",children:"✓"}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("span",{className:"font-bold text-sm",children:e.requiredSP}),(0,r.jsx)("span",{className:"mx-1 opacity-70",children:":"}),l&&(0,r.jsx)("span",{className:"font-medium",children:e.skillName}),l&&(n||i)&&(0,r.jsx)("span",{className:"mx-1 opacity-50",children:"/"}),n&&(0,r.jsx)("span",{className:"text-[10px]",children:a}),n&&i&&(0,r.jsx)("span",{className:"mx-1 opacity-50",children:"/"}),i&&(0,r.jsx)("span",{className:"text-[10px] text-cyan-400",children:s}),!l&&!n&&!i&&(0,r.jsx)("span",{className:"font-medium",children:"-"})]})]})})},m="A"===f?t:"B"===f?a:s,x="A"===f?l:"B"===f?n:i,p=void 0!==m;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"hidden md:grid grid-cols-3 gap-2",children:[(0,r.jsx)("div",{className:"text-xs rounded transition-all ".concat(o(t,!!l)),children:u(t,!!l)}),(0,r.jsx)("div",{className:"text-xs rounded transition-all ".concat(o(a,!!n)),children:u(a,!!n)}),(0,r.jsx)("div",{className:"text-xs rounded transition-all ".concat(o(s,!!i)),children:u(s,!!i)})]}),p&&(0,r.jsx)("div",{className:"md:hidden",children:(0,r.jsx)("div",{className:"text-xs rounded transition-all ".concat(o(m,!!x)),children:u(m,!!x)})})]},e)})}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-3 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded bg-lime-900/40 border border-lime-500/50"}),(0,r.jsx)("span",{className:"text-gray-300",children:"解放済み"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded bg-gray-800/40 border border-transparent"}),(0,r.jsx)("span",{className:"text-gray-300",children:"未解放"})]})]})]}),!x&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,r.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"SPを割り振るとスキルが解放されます"})})]})})},eb=e=>({A:"#ef4444",B:"#22c55e",C:"#3b82f6"})[e],ef=e=>{let{label:t,checked:a,onChange:s,disabled:l=!1,size:n="medium",className:i=""}=e;return(0,r.jsxs)("label",{className:"flex items-center cursor-pointer ".concat(l?"cursor-not-allowed":""," ").concat(i),children:[(0,r.jsx)("button",{type:"button",role:"switch","aria-checked":a,disabled:l,onClick:()=>!l&&s(!a),className:"\n          ".concat({small:"w-8 h-4",medium:"w-11 h-6",large:"w-14 h-7"}[n],"\n          relative inline-flex shrink-0 rounded-full border-2 border-transparent\n          transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2\n          focus-visible:ring-blue-500 focus-visible:ring-offset-2\n          ").concat(a?"bg-blue-600 dark:bg-blue-500":"bg-gray-200 dark:bg-gray-700","\n          ").concat(l?"opacity-50":"","\n        "),children:(0,r.jsx)("span",{className:"\n            ".concat({small:"h-3 w-3",medium:"h-5 w-5",large:"h-6 w-6"}[n],"\n            ").concat({small:a?"translate-x-4":"translate-x-0",medium:a?"translate-x-5":"translate-x-0",large:a?"translate-x-7":"translate-x-0"}[n],"\n            pointer-events-none inline-block rounded-full bg-white shadow-lg\n            transform ring-0 transition duration-200 ease-in-out\n          ")})}),t&&(0,r.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300 ".concat(l?"opacity-50":""),children:t})]})},ev=e=>{let{content:t,children:a,position:l="top",delay:n=200,className:i="",disabled:o=!1}=e,[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)({x:0,y:0}),x=(0,s.useRef)(null),h=(0,s.useRef)(null),p=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{x.current&&clearTimeout(x.current)},[]);let g=()=>{if(!h.current||!p.current)return;let e=h.current.getBoundingClientRect(),t=p.current.getBoundingClientRect(),a=0,r=0;switch(l){case"top":a=e.left+e.width/2-t.width/2,r=e.top-t.height-8;break;case"bottom":a=e.left+e.width/2-t.width/2,r=e.bottom+8;break;case"left":a=e.left-t.width-8,r=e.top+e.height/2-t.height/2;break;case"right":a=e.right+8,r=e.top+e.height/2-t.height/2}let s=window.innerWidth,n=window.innerHeight;a<8&&(a=8),a+t.width>s-8&&(a=s-t.width-8),r<8&&(r=8),r+t.height>n-8&&(r=n-t.height-8),m({x:a,y:r})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:h,onMouseEnter:()=>{!o&&t&&(x.current=setTimeout(()=>{d(!0),setTimeout(g,0)},n))},onMouseLeave:()=>{x.current&&clearTimeout(x.current),d(!1)},onFocus:()=>{!o&&t&&(d(!0),setTimeout(g,0))},onBlur:()=>{d(!1)},className:"inline-block",children:a}),c&&t&&(0,r.jsxs)("div",{ref:p,style:{position:"fixed",left:"".concat(u.x,"px"),top:"".concat(u.y,"px"),zIndex:9999},className:"\n            px-3 py-2 text-sm text-white bg-gray-900 dark:bg-gray-700 rounded-lg shadow-xl\n            pointer-events-none transition-opacity duration-150 ".concat(i,"\n          "),role:"tooltip",children:[(0,r.jsx)("div",{className:(()=>{let e="absolute w-2 h-2 bg-gray-900 dark:bg-gray-700 transform rotate-45";switch(l){case"top":return"".concat(e," -bottom-1 left-1/2 -translate-x-1/2");case"bottom":return"".concat(e," -top-1 left-1/2 -translate-x-1/2");case"left":return"".concat(e," -right-1 top-1/2 -translate-y-1/2");case"right":return"".concat(e," -left-1 top-1/2 -translate-y-1/2");default:return e}})()}),(0,r.jsx)("div",{className:"relative z-10",children:t})]})]})},ey=["布","革","金属"],ej={布:{icon:"&#129525;",description:"魔法系向け・軽量"},革:{icon:"&#129422;",description:"バランス型"},金属:{icon:"&#128737;",description:"防御特化・重装"}},eN={ATK:"力",MATK:"魔力",HP:"体力",MDEF:"精神",AGI:"素早さ",DEX:"器用",HIT:"撃力",DEF:"守備力"},ek={Defence:1,Other:2},ew={Defence:2,Other:2},eD=["攻撃力","会心率","会心ダメージ"],eS=[{value:"power",label:"力",category:"Other"},{value:"magic",label:"魔力",category:"Other"},{value:"hp",label:"体力",category:"Other"},{value:"mind",label:"精神",category:"Other"},{value:"speed",label:"素早さ",category:"Speed_CritD"},{value:"dex",label:"器用",category:"CritR"},{value:"critDamage",label:"撃力",category:"Speed_CritD"}],eC={CritR:{SSS:.15,SS:.13,S:.11,A:.09,B:.09,C:.07,D:.07,E:.05,F:.05},Speed_CritD:{SSS:.6,SS:.5,S:.4,A:.3,B:.3,C:.2,D:.2,E:.1,F:.1},Other:{SSS:.7,SS:.6,S:.5,A:.4,B:.4,C:.3,D:.3,E:.2,F:.2}},eP=(e,t,a,r)=>{var s,l,n,i;let o=null==r?void 0:null===(s=r.Equipment_EX)||void 0===s?void 0:s.Rank;return Math.round(e*(({CritR:null!==(l=null==o?void 0:o.CritR)&&void 0!==l?l:eC.CritR,Speed_CritD:null!==(n=null==o?void 0:o.Speed_CritD)&&void 0!==n?n:eC.Speed_CritD,Other:null!==(i=null==o?void 0:o.Other)&&void 0!==i?i:eC.Other})[a][t]||0)+1)},eM=e=>{let t=eS.find(t=>t.value===e);return(null==t?void 0:t.category)||"Other"},eE=["SSS","SS","S","A","B","C","D","E","F"],eA=e=>{let t=eE.indexOf(e);return -1===t?eE.length-1:t},eR=e=>{var t,a,l,n;let{slot:i,equipment:o,availableEquipment:c,onEquipmentChange:d,enhancementLevel:u=0,onEnhancementChange:m,rank:x="SSS",onRankChange:h,smithingCount:p=0,onSmithingCountChange:g,smithingCounts:b={},onSmithingCountsChange:f,hasSmithing:v=!1,onSmithingChange:y,smithingDetails:j={},onSmithingDetailsChange:N,hasAlchemy:k=!1,onAlchemyChange:w,exStats:D={},onExStatsChange:S,eqConst:C,disabled:P=!1,className:M=""}=e,E=(0,s.useMemo)(()=>{var e,t,a,r,s,l;return{Defence:null!==(s=null==C?void 0:null===(t=C.Armor)||void 0===t?void 0:null===(e=t.Forge)||void 0===e?void 0:e.Defence)&&void 0!==s?s:ek.Defence,Other:null!==(l=null==C?void 0:null===(r=C.Armor)||void 0===r?void 0:null===(a=r.Forge)||void 0===a?void 0:a.Other)&&void 0!==l?l:ek.Other}},[C]),A=(0,s.useMemo)(()=>{var e,t,a,r,s,l;return{Defence:null!==(s=null==C?void 0:null===(t=C.Armor)||void 0===t?void 0:null===(e=t.Reinforcement)||void 0===e?void 0:e.Defence)&&void 0!==s?s:ew.Defence,Other:null!==(l=null==C?void 0:null===(r=C.Armor)||void 0===r?void 0:null===(a=r.Reinforcement)||void 0===a?void 0:a.Other)&&void 0!==l?l:ew.Other}},[C]),R=(0,s.useMemo)(()=>{var e,t,a;return null!==(a=null==C?void 0:null===(t=C.Weapon)||void 0===t?void 0:null===(e=t.Forge)||void 0===e?void 0:e.Other)&&void 0!==a?a:1},[C]),F=(0,s.useMemo)(()=>{var e,t,a;return null!==(a=null==C?void 0:null===(t=C.Armor)||void 0===t?void 0:null===(e=t.Forge)||void 0===e?void 0:e.MaxTotal)&&void 0!==a?a:12},[C]),[L,B]=(0,s.useState)(!1),[O,T]=(0,s.useState)(!0),[I,q]=(0,s.useState)(!1),[H,W]=(0,s.useState)(null),J=["head","body","leg"].includes(i),K=(0,s.useMemo)(()=>{var e;if("weapon"!==i||!o||!o.sourceData||"weapon"!==o.sourceData.type)return{canSmith:!0,isVerification:!1,minRank:null,maxRank:null};let t=o.sourceData.data,a=(null===(e=t.制作)||void 0===e?void 0:e.toString().toUpperCase())==="TRUE";return{canSmith:a,isVerification:t.アイテム名.includes("検証"),minRank:t.最低ランク||null,maxRank:t.最高ランク||null}},[i,o]),U=(0,s.useMemo)(()=>{if(!o||!o.sourceData)return{minRank:null,maxRank:null};let e=o.sourceData;return"armor"===e.type||"accessory"===e.type?{minRank:e.data.最低ランク||null,maxRank:e.data.最高ランク||null}:{minRank:null,maxRank:null}},[o]),V=(0,s.useMemo)(()=>{let e=null,t=null;if("weapon"===i?(e=K.minRank,t=K.maxRank):(e=U.minRank,t=U.maxRank),!e&&!t)return eE;let a=e?eA(e):eE.length-1,r=t?eA(t):0;return eE.filter((e,t)=>t>=r&&t<=a)},[i,K,U]),_=e=>{var t;if((null===(t=e.sourceData)||void 0===t?void 0:t.type)==="armor"){let t=e.sourceData.data.タイプを選択;if("布"===t||"革"===t||"金属"===t)return t}return null},z=(0,s.useMemo)(()=>{if(!J)return[];let e=new Set;return c.forEach(t=>{let a=_(t);a&&e.add(a)}),ey.filter(t=>e.has(t))},[c,J]),X=(0,s.useMemo)(()=>J&&H?c.filter(e=>_(e)===H):c,[c,H,J]);(0,s.useEffect)(()=>{J&&1===z.length&&!H&&W(z[0])},[J,z,H]),(0,s.useEffect)(()=>{if(J&&o){let e=_(o);e&&e!==H&&W(e)}},[o,J]);let G=e=>{W(e),o&&_(o)!==e&&d(null)},$=(0,s.useMemo)(()=>{if(!o||!o.baseStats)return[];let e=[];for(let t of o.baseStats){let a=eN[t.stat];a&&!e.includes(a)&&e.push(a)}return e},[o]),Y=(0,s.useMemo)(()=>Object.values(b).reduce((e,t)=>e+(t||0),0),[b]),Z=(e,t)=>{let a=F-Object.entries(b).filter(t=>{let[a]=t;return a!==e}).reduce((e,t)=>{let[,a]=t;return e+(a||0)},0),r={...b,[e]:Math.min(t,a)};null==f||f(r)},Q=(0,s.useMemo)(()=>F-Y,[Y]),ee=e=>"weapon"===i?({ATK:"攻撃力",CRI:"会心率",DEX:"会心ダメージ"})[e]||e:["head","body","leg"].includes(i)?({ATK:"力",MATK:"魔力",HP:"体力",MDEF:"精神",AGI:"素早さ",DEX:"器用",HIT:"撃力",DEF:"守備力"})[e]||e:["accessory1","accessory2"].includes(i)&&({ATK:"力",MATK:"魔力",HP:"体力",MDEF:"精神",AGI:"素早さ",DEX:"器用",HIT:"撃力"})[e]||e,et=()=>"weapon"===i?80:40,ea=e=>({SSS:8,SS:7,S:6,A:5,B:4,C:3,D:2,E:1,F:0})[e]||0,er=e=>({SSS:{attackP:31,critR:5,critD:5},SS:{attackP:29,critR:4,critD:4},S:{attackP:27,critR:3,critD:3},A:{attackP:25,critR:3,critD:3},B:{attackP:25,critR:2,critD:2},C:{attackP:21,critR:2,critD:2},D:{attackP:21,critR:1,critD:1},E:{attackP:0,critR:0,critD:0},F:{attackP:0,critR:0,critD:0}})[e]||{attackP:0,critR:0,critD:0},es=e=>({SSS:{attackP:118,critD:48,critR:11},SS:{attackP:117,critD:47,critR:10},S:{attackP:117,critD:47,critR:10},A:{attackP:116,critD:47,critR:9},B:{attackP:116,critD:47,critR:9},C:{attackP:114,critD:47,critR:8},D:{attackP:114,critD:47,critR:8},E:{attackP:113,critD:46,critR:7},F:{attackP:113,critD:46,critR:7}})[e]||{attackP:0,critD:0,critR:0},el=e=>{let t=eN[e];return t?(b[t]||0)*("守備力"===t?E.Defence:E.Other):0},en=e=>{let t=eN[e];return t&&b[t]||0},ei=V.map(e=>({value:e,label:e,description:e===V[0]?"最高ランク":e===V[V.length-1]?"最低ランク":void 0}));Array.from({length:F+1},(e,t)=>({value:t.toString(),label:"".concat(t,"回"),description:0===t?"未強化":t===F?"最大強化":void 0}));let ec=["head","body","leg"].includes(i),ed=["accessory1","accessory2"].includes(i);return(0,r.jsxs)("div",{className:"p-6 rounded-xl bg-glass-dark backdrop-blur-md border border-white/20 relative ".concat(I?"z-50 overflow-visible":"z-auto overflow-hidden"," ").concat(M),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white/90",children:{weapon:"武器",head:"頭装備",body:"胴装備",leg:"脚装備",accessory1:"ネックレス",accessory2:"ブレスレット"}[i]||i}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button",onClick:()=>T(!O),className:"px-3 py-1 text-sm rounded-lg bg-rpg-accent/20 text-rpg-accent hover:bg-rpg-accent/30 transition-all duration-200",children:O?"ステータス非表示":"ステータス表示"}),(0,r.jsx)(ev,{content:"装備を外す",children:(0,r.jsx)("button",{type:"button",onClick:()=>d(null),disabled:P,className:"p-2 text-gray-400 hover:text-red-500 transition-colors rounded-lg hover:bg-white/10",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})]}),(0,r.jsxs)("div",{className:"mb-6 space-y-3",children:[J&&z.length>1&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"防具タイプ"}),(0,r.jsx)("div",{className:"flex gap-2",children:z.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>G(e),disabled:P,className:"flex-1 px-3 py-2 rounded-lg border transition-all duration-200 ".concat(H===e?"bg-rpg-accent/30 border-rpg-accent text-white":"bg-glass-light border-white/20 text-gray-300 hover:bg-white/10 hover:border-white/40"),children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg font-bold",children:e}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:ej[e].description})]})},e))})]}),(0,r.jsxs)("div",{children:[J&&z.length>1&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:H?"".concat(H,"装備"):"装備"}),(0,r.jsx)(eo,{options:[{value:"",label:"装備なし",description:"装備を外す"},...(J?X:c).map(e=>{let t=J?_(e):null;return{value:e.id,label:e.name,description:e.baseStats&&e.baseStats.length>0?(t&&z.length<=1?"[".concat(t,"] "):"")+e.baseStats.map(e=>"".concat(e.stat,"+").concat(e.value).concat(e.isPercent?"%":"")).join(", "):t&&z.length<=1?"[".concat(t,"]"):void 0}})],value:(null==o?void 0:o.id)||"",onChange:e=>{""===e?d(null):d((J?X:c).find(t=>t.id===e)||null)},placeholder:J&&!H&&z.length>1?"まず防具タイプを選択してください":"装備を選択してください",disabled:P||J&&!H&&z.length>1,showIcon:!1,onOpenChange:e=>q(e)})]})]}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["装備ランク","weapon"===i&&K.isVerification&&(0,r.jsx)("span",{className:"ml-2 text-xs text-orange-400",children:"（検証武器: F固定）"})]}),(0,r.jsx)(eo,{options:ei,value:x,onChange:e=>null==h?void 0:h(e),placeholder:"ランクを選択",disabled:P||"weapon"===i&&K.isVerification,showIcon:!1,className:"w-full",onOpenChange:e=>q(e)})]}),ec&&$.length>0&&(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-br from-orange-900/30 to-amber-900/30 rounded-lg border border-orange-700/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-orange-300",children:"叩き回数（パラメータ別）"}),(0,r.jsxs)("div",{className:"text-xs text-orange-400 space-x-2",children:[(0,r.jsxs)("span",{children:["合計: ",Y,"回"]}),(0,r.jsxs)("span",{className:"text-gray-500",children:["/ 残り: ",Q,"回"]})]})]}),(0,r.jsx)("div",{className:"space-y-3",children:$.map(e=>{let t=b[e]||0,a=t*("守備力"===e?E.Defence:E.Other),s=t+Q;return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-16 text-sm text-gray-300",children:e}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"range",min:0,max:s,value:t,onChange:t=>Z(e,parseInt(t.target.value,10)),disabled:P,className:"w-full h-2 bg-glass-light rounded-lg appearance-none cursor-pointer smithing-slider"})}),(0,r.jsx)("div",{className:"w-12 text-center",children:(0,r.jsx)("input",{type:"number",value:t,onChange:t=>{let a=parseInt(t.target.value,10);!isNaN(a)&&a>=0&&a<=s&&Z(e,a)},min:0,max:s,disabled:P,className:"w-full px-1 py-0.5 text-center bg-gray-800 border border-gray-600 rounded text-white text-xs"})}),(0,r.jsx)("div",{className:"w-16 text-right text-xs",children:(0,r.jsxs)("span",{className:a>0?"text-green-400":"text-gray-500",children:["+",a]})})]},e)})}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-orange-700/30 text-xs text-gray-400",children:[(0,r.jsxs)("p",{children:["守備力: 1回につき+",E.Defence," / その他: 1回につき+",E.Other]}),(0,r.jsxs)("p",{className:"mt-1 text-orange-400",children:["※ 全パラメータ合計で最大",F,"回まで"]})]})]}),"weapon"===i&&["SSS","SS"].includes(x)&&K.canSmith&&!K.isVerification&&(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-br from-red-900/30 to-orange-900/30 rounded-lg border border-red-700/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-red-300",children:"叩き回数（パラメータ別）"}),(0,r.jsxs)("div",{className:"text-xs text-red-400 space-x-2",children:[(0,r.jsxs)("span",{children:["合計: ",eD.reduce((e,t)=>e+(b[t]||0),0),"回"]}),(0,r.jsxs)("span",{className:"text-gray-500",children:["/ 残り: ",Q,"回"]})]})]}),(0,r.jsx)("div",{className:"space-y-3",children:eD.map(e=>{let t=b[e]||0,a=t*R,s=t+Q;return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-24 text-sm text-gray-300",children:e}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"range",min:0,max:s,value:t,onChange:t=>{let a=parseInt(t.target.value,10),r=F-eD.filter(t=>t!==e).reduce((e,t)=>e+(b[t]||0),0),s={...b,[e]:Math.min(a,r)};null==f||f(s)},disabled:P,className:"w-full h-2 bg-glass-light rounded-lg appearance-none cursor-pointer smithing-slider"})}),(0,r.jsx)("div",{className:"w-12 text-center",children:(0,r.jsx)("input",{type:"number",value:t,onChange:t=>{let a=parseInt(t.target.value,10);if(!isNaN(a)&&a>=0){let t=F-eD.filter(t=>t!==e).reduce((e,t)=>e+(b[t]||0),0),r={...b,[e]:Math.min(a,t)};null==f||f(r)}},min:0,max:s,disabled:P,className:"w-full px-1 py-0.5 text-center bg-gray-800 border border-gray-600 rounded text-white text-xs"})}),(0,r.jsx)("div",{className:"w-12 text-right text-xs",children:(0,r.jsxs)("span",{className:a>0?"text-green-400":"text-gray-500",children:["+",a,"会心率"===e?"%":""]})})]},e)})}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-red-700/30 text-xs text-gray-400",children:[(0,r.jsxs)("p",{children:["全パラメータ: 1回につき+",R]}),(0,r.jsxs)("p",{className:"mt-1 text-red-400",children:["※ 全パラメータ合計で最大",F,"回まで"]})]})]}),"weapon"===i&&(!K.canSmith||K.isVerification)&&(0,r.jsx)("div",{className:"p-3 bg-gray-800/50 rounded-lg border border-gray-600/50",children:(0,r.jsx)("p",{className:"text-xs text-gray-400",children:K.isVerification?"※ 検証武器のため、錬金以外の強化は適用されません":"※ この武器は叩き（鍛造）ができません"})}),!ed&&!("weapon"===i&&K.isVerification)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"強化レベル（+値）"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("input",{type:"range",min:0,max:et(),value:u,onChange:e=>null==m?void 0:m(parseInt(e.target.value,10)),disabled:P,className:"flex-1 h-2 bg-glass-light rounded-lg appearance-none cursor-pointer slider"}),(0,r.jsx)("div",{className:"w-16 text-center",children:(0,r.jsx)("input",{type:"number",value:u,onChange:e=>{let t=parseInt(e.target.value,10);!isNaN(t)&&t>=0&&t<=et()&&(null==m||m(t))},min:0,max:et(),disabled:P,className:"w-full px-2 py-1 text-center bg-gray-800 border border-gray-600 rounded text-white text-sm"})})]}),(0,r.jsxs)("div",{className:"mt-1 text-xs text-gray-400",children:["最大: +",et()]})]}),"weapon"===i&&(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-br from-purple-900/30 to-violet-900/30 rounded-lg border border-purple-700/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(ef,{label:"錬金",checked:k,onChange:e=>null==w?void 0:w(e),disabled:P})}),k&&(0,r.jsxs)("div",{className:"text-xs text-purple-300",children:["ランク ",x," の錬金効果"]})]}),k&&(0,r.jsxs)("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"p-2 bg-purple-900/40 rounded text-center",children:[(0,r.jsx)("div",{className:"text-purple-400",children:"攻撃力"}),(0,r.jsxs)("div",{className:"text-purple-200 font-semibold",children:["+",es(x).attackP]})]}),(0,r.jsxs)("div",{className:"p-2 bg-purple-900/40 rounded text-center",children:[(0,r.jsx)("div",{className:"text-purple-400",children:"会心率"}),(0,r.jsxs)("div",{className:"text-purple-200 font-semibold",children:["+",es(x).critR]})]}),(0,r.jsxs)("div",{className:"p-2 bg-purple-900/40 rounded text-center",children:[(0,r.jsx)("div",{className:"text-purple-400",children:"会心ダメージ"}),(0,r.jsxs)("div",{className:"text-purple-200 font-semibold",children:["+",es(x).critD]})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10 space-y-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-300 mb-3",children:"拡張設定"}),ec&&o&&(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-br from-cyan-900/30 to-teal-900/30 rounded-lg border border-cyan-700/50",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-cyan-300 mb-3",children:"EXステータス（防具）"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"EX1"}),(0,r.jsx)(eo,{options:[{value:"",label:"未選択"},...eS.map(e=>({value:e.value,label:e.label}))],value:(null==D?void 0:D.ex1)||"",onChange:e=>null==S?void 0:S({...D,ex1:e||void 0}),placeholder:"EX1を選択",disabled:P,showIcon:!1,onOpenChange:e=>q(e)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"EX2"}),(0,r.jsx)(eo,{options:[{value:"",label:"未選択"},...eS.map(e=>({value:e.value,label:e.label}))],value:(null==D?void 0:D.ex2)||"",onChange:e=>null==S?void 0:S({...D,ex2:e||void 0}),placeholder:"EX2を選択",disabled:P,showIcon:!1,onOpenChange:e=>q(e)})]})]}),((null==D?void 0:D.ex1)||(null==D?void 0:D.ex2))&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-cyan-700/30 flex flex-wrap gap-3 text-xs",children:[(null==D?void 0:D.ex1)&&(0,r.jsxs)("div",{className:"px-2 py-1 bg-cyan-900/40 rounded",children:[(0,r.jsxs)("span",{className:"text-cyan-400",children:["EX1 ",null===(t=eS.find(e=>e.value===D.ex1))||void 0===t?void 0:t.label,": "]}),(0,r.jsxs)("span",{className:"text-cyan-200 font-semibold",children:["+",eP(o.requiredLevel||1,x,eM(D.ex1),C)]})]}),(null==D?void 0:D.ex2)&&(0,r.jsxs)("div",{className:"px-2 py-1 bg-cyan-900/40 rounded",children:[(0,r.jsxs)("span",{className:"text-cyan-400",children:["EX2 ",null===(a=eS.find(e=>e.value===D.ex2))||void 0===a?void 0:a.label,": "]}),(0,r.jsxs)("span",{className:"text-cyan-200 font-semibold",children:["+",eP(o.requiredLevel||1,x,eM(D.ex2),C)]})]})]}),(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"EX値 = ROUND(使用可能Lv x ランク係数 + 1)"})]}),ed&&o&&(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-br from-cyan-900/30 to-teal-900/30 rounded-lg border border-cyan-700/50",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-cyan-300 mb-3",children:"EXステータス（アクセサリー）"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"EX1"}),(0,r.jsx)(eo,{options:[{value:"",label:"未選択"},...eS.filter(e=>"defense"!==e.value).map(e=>({value:e.value,label:e.label}))],value:(null==D?void 0:D.ex1)||"",onChange:e=>null==S?void 0:S({...D,ex1:e||void 0}),placeholder:"EX1を選択",disabled:P,showIcon:!1,onOpenChange:e=>q(e)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"EX2"}),(0,r.jsx)(eo,{options:[{value:"",label:"未選択"},...eS.filter(e=>"defense"!==e.value).map(e=>({value:e.value,label:e.label}))],value:(null==D?void 0:D.ex2)||"",onChange:e=>null==S?void 0:S({...D,ex2:e||void 0}),placeholder:"EX2を選択",disabled:P,showIcon:!1,onOpenChange:e=>q(e)})]})]}),((null==D?void 0:D.ex1)||(null==D?void 0:D.ex2))&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-cyan-700/30 flex flex-wrap gap-3 text-xs",children:[(null==D?void 0:D.ex1)&&(0,r.jsxs)("div",{className:"px-2 py-1 bg-cyan-900/40 rounded",children:[(0,r.jsxs)("span",{className:"text-cyan-400",children:["EX1 ",null===(l=eS.find(e=>e.value===D.ex1))||void 0===l?void 0:l.label,": "]}),(0,r.jsxs)("span",{className:"text-cyan-200 font-semibold",children:["+",eP(o.requiredLevel||1,x,eM(D.ex1),C)]})]}),(null==D?void 0:D.ex2)&&(0,r.jsxs)("div",{className:"px-2 py-1 bg-cyan-900/40 rounded",children:[(0,r.jsxs)("span",{className:"text-cyan-400",children:["EX2 ",null===(n=eS.find(e=>e.value===D.ex2))||void 0===n?void 0:n.label,": "]}),(0,r.jsxs)("span",{className:"text-cyan-200 font-semibold",children:["+",eP(o.requiredLevel||1,x,eM(D.ex2),C)]})]})]}),(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"EX値 = ROUND(使用可能Lv x ランク係数 + 1)"})]})]}),O&&o.baseStats&&o.baseStats.length>0&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-glass-light rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-300 mb-3",children:"装備ステータス"}),(0,r.jsx)("div",{className:"space-y-2",children:(()=>{if(!o||!o.baseStats)return[];let e=ea(x),t=er(x),a=es(x),r=K.minRank&&"F"!==K.minRank?er(K.minRank):{attackP:0,critR:0,critD:0};return o.baseStats.map(s=>{let l=s.value,n=l,c=0,d=0,m=0,h=0,p=0;if("weapon"===i){let e=K.isVerification,n=l;K.minRank&&"F"!==K.minRank&&("ATK"===s.stat?n=Math.floor(l-r.attackP):"CRI"===s.stat?n=l-r.critR:"DEX"===s.stat&&(n=l-r.critD));let i=o.requiredLevel||100;"ATK"===s.stat?(c=Math.ceil(t.attackP/320*i),e||(d=2*u,m=(h=K.canSmith&&b["攻撃力"]||0)*R),k&&(p=a.attackP),l=n):"CRI"===s.stat?(c=t.critR,e||(d=Math.floor(u/2),m=(h=K.canSmith&&b["会心率"]||0)*R),k&&(p=a.critR),l=n):"DEX"===s.stat&&(c=t.critD,e||(d=1*u,m=(h=K.canSmith&&b["会心ダメージ"]||0)*R),k&&(p=a.critD),l=n)}else if(["head","body","leg"].includes(i)){let t="DEF"===s.stat;h=en(s.stat),m=el(s.stat),d=u*(t?A.Defence:A.Other);let a=o.requiredLevel||1,r=l+m;c=Math.round(r*(1+e/a*Math.pow(r,.2)))-r}else{let e=o.requiredLevel||1,t={SSS:55,SS:50,S:45,A:44,B:44,C:35,D:35,E:0,F:0}[x]||0;c=t>0?Math.ceil(e*t/550):0}return n=l+c+d+m+p,{stat:s.stat,baseValue:l,rankBonus:c,enhanceBonus:d,smithingBonus:m,smithingCount:h,alchemyBonus:p,finalValue:n,isPercent:s.isPercent}})})().map((e,t)=>(0,r.jsxs)("div",{className:"p-2 bg-glass-dark/50 rounded",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:ee(e.stat)}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-gray-500 text-xs",children:[e.baseValue,e.isPercent?"%":""]}),(0,r.jsxs)("span",{className:"font-medium ".concat(e.finalValue>e.baseValue?"text-green-400":"text-white"),children:[String.fromCharCode(8594)," ",e.finalValue,e.isPercent?"%":""]})]})]}),(e.rankBonus>0||e.enhanceBonus>0||e.smithingCount>0||e.alchemyBonus>0)&&(0,r.jsxs)("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:[e.rankBonus>0&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-yellow-900/50 text-yellow-300 rounded",children:["ランク +",e.rankBonus]}),e.enhanceBonus>0&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-blue-900/50 text-blue-300 rounded",children:["強化 +",e.enhanceBonus]}),e.smithingCount>0&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-orange-900/50 text-orange-300 rounded",children:["叩き +",e.smithingCount,"回"]}),e.alchemyBonus>0&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-purple-900/50 text-purple-300 rounded",children:["錬金 +",e.alchemyBonus]})]})]},t))}),(0,r.jsx)("div",{className:"mt-3 pt-3 border-t border-white/10",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs",children:[(0,r.jsxs)("span",{className:"px-2 py-1 rounded ".concat({SSS:"text-purple-600 dark:text-purple-400 font-bold",SS:"text-purple-500 dark:text-purple-400",S:"text-yellow-600 dark:text-yellow-400",A:"text-red-600 dark:text-red-400",B:"text-orange-600 dark:text-orange-400",C:"text-green-600 dark:text-green-400",D:"text-blue-600 dark:text-blue-400",E:"text-gray-600 dark:text-gray-400",F:"text-gray-500 dark:text-gray-500"}[x]||""," bg-glass-dark/30"),children:["ランク: ",x]}),u>0&&(0,r.jsxs)("span",{className:"px-2 py-1 rounded text-blue-400 bg-blue-900/30",children:["+",u]}),Y>0&&ec&&(0,r.jsxs)("span",{className:"px-2 py-1 rounded text-orange-400 bg-orange-900/30",children:["叩き ",Y,"回"]}),p>0&&"weapon"===i&&(0,r.jsxs)("span",{className:"px-2 py-1 rounded text-orange-400 bg-orange-900/30",children:["叩き ",p,"回"]}),"weapon"===i&&k&&(0,r.jsx)("span",{className:"px-2 py-1 rounded text-purple-400 bg-purple-900/30",children:"錬金済"})]})})]})]})]})};if("undefined"!=typeof document&&!document.getElementById("equipment-slot-styles")){let e=document.createElement("style");e.id="equipment-slot-styles",e.textContent="\n    .slider::-webkit-slider-thumb {\n      appearance: none;\n      width: 20px;\n      height: 20px;\n      background: linear-gradient(135deg, #60a5fa, #3b82f6);\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .slider::-webkit-slider-thumb:hover {\n      transform: scale(1.1);\n      box-shadow: 0 0 12px rgba(96, 165, 250, 0.5);\n    }\n\n    .slider::-moz-range-thumb {\n      width: 20px;\n      height: 20px;\n      background: linear-gradient(135deg, #60a5fa, #3b82f6);\n      border: none;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .slider::-moz-range-thumb:hover {\n      transform: scale(1.1);\n      box-shadow: 0 0 12px rgba(96, 165, 250, 0.5);\n    }\n\n    .slider {\n      background: linear-gradient(to right,\n        rgba(96, 165, 250, 0.3) 0%,\n        rgba(96, 165, 250, 0.1) 100%);\n    }\n\n    .smithing-slider::-webkit-slider-thumb {\n      appearance: none;\n      width: 16px;\n      height: 16px;\n      background: linear-gradient(135deg, #fb923c, #f97316);\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .smithing-slider::-webkit-slider-thumb:hover {\n      transform: scale(1.1);\n      box-shadow: 0 0 10px rgba(251, 146, 60, 0.5);\n    }\n\n    .smithing-slider::-moz-range-thumb {\n      width: 16px;\n      height: 16px;\n      background: linear-gradient(135deg, #fb923c, #f97316);\n      border: none;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .smithing-slider::-moz-range-thumb:hover {\n      transform: scale(1.1);\n      box-shadow: 0 0 10px rgba(251, 146, 60, 0.5);\n    }\n\n    .smithing-slider {\n      background: linear-gradient(to right,\n        rgba(251, 146, 60, 0.3) 0%,\n        rgba(251, 146, 60, 0.1) 100%);\n    }\n  ",document.head.appendChild(e)}let eF=e=>{let t=[];return e["力（%不要）"]&&t.push("力+".concat(e["力（%不要）"],"%")),e["魔力（%不要）"]&&t.push("魔力+".concat(e["魔力（%不要）"],"%")),e["体力（%不要）"]&&t.push("体力+".concat(e["体力（%不要）"],"%")),e["精神（%不要）"]&&t.push("精神+".concat(e["精神（%不要）"],"%")),e["素早さ（%不要）"]&&t.push("素早さ+".concat(e["素早さ（%不要）"],"%")),e["器用（%不要）"]&&t.push("器用+".concat(e["器用（%不要）"],"%")),e["撃力（%不要）"]&&t.push("撃力+".concat(e["撃力（%不要）"],"%")),e["守備力（%不要）"]&&t.push("守備力+".concat(e["守備力（%不要）"],"%")),t.join(", ")||"ステータス効果なし"},eL=e=>{let t=[];return e["力（%不要）"]&&t.push({name:"力",value:e["力（%不要）"]}),e["魔力（%不要）"]&&t.push({name:"魔力",value:e["魔力（%不要）"]}),e["体力（%不要）"]&&t.push({name:"体力",value:e["体力（%不要）"]}),e["精神（%不要）"]&&t.push({name:"精神",value:e["精神（%不要）"]}),e["素早さ（%不要）"]&&t.push({name:"素早さ",value:e["素早さ（%不要）"]}),e["器用（%不要）"]&&t.push({name:"器用",value:e["器用（%不要）"]}),e["撃力（%不要）"]&&t.push({name:"撃力",value:e["撃力（%不要）"]}),e["守備力（%不要）"]&&t.push({name:"守備力",value:e["守備力（%不要）"]}),t},eB=e=>{let{emblem:t,availableEmblems:a,onEmblemChange:l,disabled:n=!1,characterLevel:i=999}=e,[o,c]=(0,s.useState)(!1),d=(0,s.useMemo)(()=>a.filter(e=>e.使用可能Lv<=i),[a,i]),u=(0,s.useMemo)(()=>{let e=[{value:"",label:"紋章なし",description:"紋章を外す"}];return d.forEach(t=>{e.push({value:t.アイテム名,label:t.アイテム名,description:eF(t),icon:"\uD83C\uDFC5"})}),e},[d]),m=t?eL(t):[];return(0,r.jsxs)("div",{className:"p-6 rounded-xl bg-gradient-to-br from-amber-900/20 to-yellow-900/20 border border-amber-500/30 ".concat(o?"z-50 overflow-visible":"z-auto overflow-hidden"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold text-white/90 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-amber-400",children:"\uD83C\uDFC5"}),"紋章"]}),t&&(0,r.jsx)("button",{type:"button",onClick:()=>l(null),disabled:n,className:"p-2 text-gray-400 hover:text-red-500 transition-colors rounded-lg hover:bg-white/10",title:"紋章を外す",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)(eo,{options:u,value:(null==t?void 0:t.アイテム名)||"",onChange:e=>{""===e?l(null):l(a.find(t=>t.アイテム名===e)||null)},placeholder:"紋章を選択してください",disabled:n,showIcon:!0,onOpenChange:c})}),t&&m.length>0&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-glass-light rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-amber-300 mb-3",children:"ステータス効果（%補正）"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:m.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-glass-dark/50 rounded",children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:e.name}),(0,r.jsxs)("span",{className:"font-medium ".concat(e.value>=0?"text-green-400":"text-red-400"),children:[e.value>=0?"+":"",e.value,"%"]})]},t))}),t.使用可能Lv>0&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10 text-xs text-gray-400",children:["必要レベル: Lv.",t.使用可能Lv]})]}),!t&&(0,r.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:(0,r.jsx)("p",{children:"紋章を装備すると%ステータス補正を得られます"})})]})},eO={ノーマル:{label:"ノーマル",color:"text-gray-300",bgColor:"bg-gray-700/30",borderColor:"border-gray-500/30",icon:"◇"},グレート:{label:"グレート",color:"text-green-300",bgColor:"bg-green-700/30",borderColor:"border-green-500/30",icon:"◆"},バスター:{label:"バスター",color:"text-blue-300",bgColor:"bg-blue-700/30",borderColor:"border-blue-500/30",icon:"★"},レプリカ:{label:"レプリカ",color:"text-purple-300",bgColor:"bg-purple-700/30",borderColor:"border-purple-500/30",icon:"✦"}},eT=["ノーマル","グレート","バスター","レプリカ"],eI=e=>e.name||e["アイテム名（・<グレード>）は不要"]||"不明",eq=e=>{let t=[];return e.力&&t.push("力+".concat(e.力)),e.魔力&&t.push("魔力+".concat(e.魔力)),e.体力&&t.push("体力+".concat(e.体力)),e.精神&&t.push("精神+".concat(e.精神)),e.素早さ&&t.push("素早さ+".concat(e.素早さ)),e.器用&&t.push("器用+".concat(e.器用)),e.撃力&&t.push("撃力+".concat(e.撃力)),e.守備力&&t.push("守備力+".concat(e.守備力)),t.join(", ")||"ステータス効果なし"},eH=e=>{let t=[];return e.力&&t.push({name:"力",value:e.力}),e.魔力&&t.push({name:"魔力",value:e.魔力}),e.体力&&t.push({name:"体力",value:e.体力}),e.精神&&t.push({name:"精神",value:e.精神}),e.素早さ&&t.push({name:"素早さ",value:e.素早さ}),e.器用&&t.push({name:"器用",value:e.器用}),e.撃力&&t.push({name:"撃力",value:e.撃力}),e.守備力&&t.push({name:"守備力",value:e.守備力}),t},eW=e=>{let t=[];return e.耐性1&&t.push(e.耐性1),e.耐性2&&t.push(e.耐性2),e.耐性3&&t.push(e.耐性3),e.耐性4&&t.push(e.耐性4),e.耐性5&&t.push(e.耐性5),e.耐性6&&t.push(e.耐性6),t},eJ=e=>({炎:"text-red-400",水:"text-blue-400",風:"text-green-400",雷:"text-yellow-400",闇:"text-purple-400",光:"text-amber-300",物理:"text-orange-400",魔力:"text-indigo-400"})[e]||"text-gray-400",eK=e=>{let{selectedRunes:t,availableRunes:a,onRunesChange:l,disabled:n=!1}=e,[i,o]=(0,s.useState)(null),c=(0,s.useMemo)(()=>{let e={ノーマル:[],グレート:[],バスター:[],レプリカ:[]};return a.forEach(t=>{t.グレード&&e[t.グレード]&&e[t.グレード].push(t)}),e},[a]),d=(0,s.useMemo)(()=>{let e={ノーマル:null,グレート:null,バスター:null,レプリカ:null};return t.forEach(t=>{t.グレード&&(e[t.グレード]=t)}),e},[t]),u=(e,r)=>{let s=t.filter(t=>t.グレード!==e);if(""!==r){let t=a.find(t=>t.グレード===e&&eI(t)===r);t&&s.push(t)}l(s)},m=e=>{let t=[{value:"",label:"未選択",description:"ルーンストーンを外す"}];return c[e].forEach(a=>{let r=eq(a),s=eW(a),l=s.length>0?" / 耐性: ".concat(s.map(e=>"".concat(e.type).concat(e.value>=0?"+":"").concat(e.value,"%")).join(", ")):"";t.push({value:eI(a),label:eI(a),description:r+l,icon:eO[e].icon})}),t},x=(0,s.useMemo)(()=>{let e={};return t.forEach(t=>{eH(t).forEach(t=>{e[t.name]=(e[t.name]||0)+t.value})}),Object.entries(e).map(e=>{let[t,a]=e;return{name:t,value:a}})},[t]),h=(0,s.useMemo)(()=>{let e={};return t.forEach(t=>{eW(t).forEach(t=>{e[t.type]=(e[t.type]||0)+t.value})}),Object.entries(e).map(e=>{let[t,a]=e;return{type:t,value:a}})},[t]);return(0,r.jsxs)("div",{className:"p-6 rounded-xl bg-gradient-to-br from-purple-900/20 to-indigo-900/20 border border-purple-500/30",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold text-white/90 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-purple-400",children:"\uD83D\uDC8E"}),"ルーンストーン"]}),(0,r.jsxs)("span",{className:"text-xs text-gray-400",children:["選択中: ",t.length,"/4"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"各グレードから1つずつ選択可能"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:eT.map(e=>{let t=eO[e],a=d[e],s=m(e);return(0,r.jsxs)("div",{className:"p-4 rounded-lg ".concat(t.bgColor," border ").concat(t.borderColor),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("span",{className:"font-semibold ".concat(t.color," flex items-center gap-1"),children:[(0,r.jsx)("span",{children:t.icon}),t.label]}),a&&(0,r.jsx)("button",{type:"button",onClick:()=>u(e,""),disabled:n,className:"p-1 text-gray-400 hover:text-red-500 transition-colors rounded hover:bg-white/10",title:"ルーンストーンを外す",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)(eo,{options:s,value:a?eI(a):"",onChange:t=>u(e,t),placeholder:"選択してください",disabled:n||0===c[e].length,showIcon:!0,onOpenChange:t=>o(t?e:null)}),a&&(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[eH(a).length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:eH(a).map((e,t)=>(0,r.jsxs)("span",{className:"px-2 py-0.5 text-xs rounded ".concat(e.value>=0?"bg-green-900/50 text-green-300":"bg-red-900/50 text-red-300"),children:[e.name,e.value>=0?"+":"",e.value]},t))}),eW(a).length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:eW(a).map((e,t)=>(0,r.jsxs)("span",{className:"px-2 py-0.5 text-xs rounded bg-gray-800/50 ".concat(eJ(e.type)),children:[e.type,e.value>=0?"+":"",e.value,"%"]},t))})]}),0===c[e].length&&(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"このグレードのルーンストーンはありません"})]},e)})}),t.length>0&&(x.length>0||h.length>0)&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-glass-light rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-purple-300 mb-3",children:"合計ステータス効果"}),x.length>0&&(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-3",children:x.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-glass-dark/50 rounded",children:[(0,r.jsx)("span",{className:"text-gray-400 text-xs",children:e.name}),(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(e.value>=0?"text-green-400":"text-red-400"),children:[e.value>=0?"+":"",e.value]})]},t))}),h.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h5",{className:"text-xs font-medium text-gray-400 mb-2",children:"耐性効果"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:h.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-glass-dark/50 rounded",children:[(0,r.jsx)("span",{className:"text-xs ".concat(eJ(e.type)),children:e.type}),(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(e.value>=0?"text-green-400":"text-red-400"),children:[e.value>=0?"+":"",e.value,"%"]})]},t))})]})]}),0===t.length&&(0,r.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:(0,r.jsx)("p",{children:"ルーンストーンを装備するとステータスと耐性を得られます"})})]})},eU=e=>{let{statName:t,statKey:a,value:l,breakdown:n,icon:i,color:o="blue",showBreakdown:c=!1}=e,[d,u]=(0,s.useState)(!1),m=()=>{let e={red:"text-red-600 dark:text-red-400",blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",purple:"text-purple-600 dark:text-purple-400",yellow:"text-yellow-600 dark:text-yellow-400",gray:"text-gray-600 dark:text-gray-400",cyan:"text-cyan-600 dark:text-cyan-400",emerald:"text-emerald-600 dark:text-emerald-400",white:"text-gray-800 dark:text-white"};return e[o]||e.blue},x=(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"font-semibold mb-2",children:[t,"の内訳"]}),n.base>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"基本値:"}),(0,r.jsxs)("span",{className:"ml-4",children:["+",n.base]})]}),0!==n.equipment&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"装備:"}),(0,r.jsxs)("span",{className:"ml-4",children:[n.equipment>0?"+":"",n.equipment]})]}),0!==n.skills&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP割り当て:"}),(0,r.jsxs)("span",{className:"ml-4",children:[n.skills>0?"+":"",n.skills]})]}),0!==n.percent&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"%補正:"}),(0,r.jsxs)("span",{className:"ml-4",children:[n.percent>0?"+":"",n.percent]})]}),0!==n.buffs&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"バフ:"}),(0,r.jsxs)("span",{className:"ml-4",children:[n.buffs>0?"+":"",n.buffs]})]}),(0,r.jsx)("div",{className:"border-t pt-1 mt-2 font-semibold",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"合計:"}),(0,r.jsx)("span",{className:"ml-4",children:l})]})})]});return(0,r.jsx)(ev,{content:c?x:null,position:"top",children:(0,r.jsxs)("div",{className:"\n          relative p-4 rounded-lg border-2 cursor-pointer transition-all\n          hover:shadow-lg hover:scale-105 ".concat((()=>{let e={red:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",blue:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",green:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",purple:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800",yellow:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",gray:"bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800",cyan:"bg-cyan-50 dark:bg-cyan-900/20 border-cyan-200 dark:border-cyan-800",emerald:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800",white:"bg-white dark:bg-gray-700/30 border-gray-300 dark:border-gray-500"};return e[o]||e.blue})(),"\n          min-h-[110px] flex flex-col justify-between\n        "),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[(0,r.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,r.jsxs)("div",{className:"flex items-center",children:[i&&(0,r.jsx)("div",{className:"mr-2 ".concat(m()),children:i}),(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t})]})}),(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(m()),children:l.toLocaleString()}),(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-400 min-h-[16px]",children:0!==n.equipment||0!==n.skills||0!==n.buffs||0!==n.percent?(0,r.jsxs)(r.Fragment,{children:[n.base>0&&"基本: ".concat(n.base),n.equipment+n.skills+n.buffs+n.percent!==0&&(0,r.jsxs)("span",{className:"ml-1 ".concat(n.equipment+n.skills+n.buffs+n.percent>0?"text-green-600":"text-red-600"),children:[n.equipment+n.skills+n.buffs+n.percent>0?"+":"",n.equipment+n.skills+n.buffs+n.percent]})]}):(0,r.jsx)("span",{children:"\xa0"})})]})})},eV=e=>{let{stats:t,resistance:a,className:s="",showBreakdown:l=!1}=e,n=2*(t.total.MDEF||0),i=[{key:"HP",name:"体力",color:"green",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})},{key:"MP",name:"MP",color:"blue",customValue:n,icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z",clipRule:"evenodd"})})},{key:"ATK",name:"力",color:"red",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})},{key:"MATK",name:"魔力",color:"purple",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"})})},{key:"DEF",name:"守備力",color:"gray",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},{key:"MDEF",name:"精神",color:"emerald",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z",clipRule:"evenodd"})})},{key:"AGI",name:"素早さ",color:"cyan",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})},{key:"DEX",name:"器用さ",color:"yellow",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},{key:"HIT",name:"撃力",color:"green",icon:(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})},{key:"CRI",name:"会心率",color:"white",icon:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})}];return(0,r.jsxs)("div",{className:"".concat(s),children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4",children:"最終ステータス"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:i.map(e=>{var a;let s="customValue"in e&&void 0!==e.customValue?e.customValue:t.total[e.key]||0;return(0,r.jsx)(eU,{statName:e.name,statKey:e.key,value:s,breakdown:{base:t.base[e.key]||0,equipment:t.fromEquipment[e.key]||0,skills:t.fromSkills[e.key]||0,buffs:t.fromBuffs[e.key]||0,percent:(null===(a=t.fromPercent)||void 0===a?void 0:a[e.key])||0},icon:e.icon,color:e.color,showBreakdown:l},e.key)})}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"耐性"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"攻撃"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"物理耐性の内訳"}),0!==a.physical.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.physical.fromSP,"%"]})]}),0!==a.physical.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.physical.fromRunestone,"%"]})]}),0!==a.physical.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.physical.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"物理"}),(0,r.jsxs)("span",{className:"font-semibold ".concat(((null==a?void 0:a.physical.total)||0)>0?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.physical.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"魔法耐性の内訳"}),0!==a.magic.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.magic.fromSP,"%"]})]}),0!==a.magic.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.magic.fromRunestone,"%"]})]}),0!==a.magic.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.magic.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"魔法"}),(0,r.jsxs)("span",{className:"font-semibold ".concat(((null==a?void 0:a.magic.total)||0)>0?"text-purple-600 dark:text-purple-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.magic.total)||0,"%"]})]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"属性"}),(0,r.jsxs)("div",{className:"grid grid-cols-4 sm:grid-cols-7 gap-2",children:[(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"炎耐性の内訳"}),0!==a.fire.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.fire.fromSP,"%"]})]}),0!==a.fire.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.fire.fromRunestone,"%"]})]}),0!==a.fire.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.fire.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-red-500 dark:text-red-400 text-sm",children:"炎"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.fire.total)||0)>0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.fire.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"水耐性の内訳"}),0!==a.water.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.water.fromSP,"%"]})]}),0!==a.water.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.water.fromRunestone,"%"]})]}),0!==a.water.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.water.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-blue-500 dark:text-blue-400 text-sm",children:"水"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.water.total)||0)>0?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.water.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"雷耐性の内訳"}),0!==a.thunder.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.thunder.fromSP,"%"]})]}),0!==a.thunder.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.thunder.fromRunestone,"%"]})]}),0!==a.thunder.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.thunder.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-yellow-500 dark:text-yellow-400 text-sm",children:"雷"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.thunder.total)||0)>0?"text-yellow-600 dark:text-yellow-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.thunder.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"風耐性の内訳"}),0!==a.wind.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.wind.fromSP,"%"]})]}),0!==a.wind.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.wind.fromRunestone,"%"]})]}),0!==a.wind.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.wind.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-green-500 dark:text-green-400 text-sm",children:"風"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.wind.total)||0)>0?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.wind.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"無耐性の内訳"}),0!==a.none.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.none.fromSP,"%"]})]}),0!==a.none.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.none.fromRunestone,"%"]})]}),0!==a.none.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.none.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"無"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.none.total)||0)>0?"text-gray-600 dark:text-gray-300":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.none.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"闇耐性の内訳"}),0!==a.dark.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.dark.fromSP,"%"]})]}),0!==a.dark.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.dark.fromRunestone,"%"]})]}),0!==a.dark.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.dark.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-purple-700 dark:text-purple-400 text-sm",children:"闇"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.dark.total)||0)>0?"text-purple-700 dark:text-purple-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.dark.total)||0,"%"]})]})}),(0,r.jsx)(ev,{content:a?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"光耐性の内訳"}),0!==a.light.fromSP&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"SP:"}),(0,r.jsxs)("span",{children:[a.light.fromSP,"%"]})]}),0!==a.light.fromRunestone&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"ルーンストーン:"}),(0,r.jsxs)("span",{children:[a.light.fromRunestone,"%"]})]}),0!==a.light.fromFood&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"食べ物:"}),(0,r.jsxs)("span",{children:[a.light.fromFood,"%"]})]})]}):null,position:"top",children:(0,r.jsxs)("div",{className:"flex flex-col items-center p-2 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[(0,r.jsx)("span",{className:"text-amber-500 dark:text-amber-400 text-sm",children:"光"}),(0,r.jsxs)("span",{className:"text-sm font-semibold ".concat(((null==a?void 0:a.light.total)||0)>0?"text-amber-600 dark:text-amber-400":"text-gray-500 dark:text-gray-400"),children:[(null==a?void 0:a.light.total)||0,"%"]})]})})]})]})]})]})]})},e_={sword:"Sword",greatsword:"GreatSword",dagger:"Dagger",axe:"Axe",spear:"Spear",bow:"Bow",staff:"Wand",mace:"Frypan",katana:"Sword",fist:"Sword"};function ez(e){let t=e.toLowerCase();return e_[e]?e_[e]:e_[t]?e_[t]:e.charAt(0)===e.charAt(0).toUpperCase()?e:"Sword"}function eX(e,t,a,r){var s;let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,i=ez(e),o=null===(s=r.BasedDamage)||void 0===s?void 0:s[i];if(!o)return console.warn("No damage formula found for weapon type: ".concat(e)),0;let c={WeaponAttackPower:t.attackPower||0,WeaponMagicPower:t.magicPower||0,WeaponCritRate:t.critRate||0,WeaponCritDamage:t.critDamage||0,UserPower:a.ATK||0,UserMagic:a.MATK||0,UserDefense:a.DEF||0,UserMind:a.MDEF||0,UserHP:a.HP||0,UserMP:a.MP||0,UserAgility:a.AGI||0,UserDex:a.DEX||0,UserLuck:a.LUK||0,UserCritDamage:a.HIT||0,UserHit:a.HIT||0,UserFlee:a.FLEE||0,DamageCorrection:l,ComboCorrection:n};try{let e=d(o,c);return Math.max(0,Math.floor(e))}catch(t){return console.error("Failed to calculate base damage for ".concat(e,":"),t),0}}function eG(e,t,a,r,s,l){var n;let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=null===(n=l.JobCorrection)||void 0===n?void 0:n[t];if(!o)return e;let c=o[ez(a)];if(!c){if(o.Bonus){let a=o.Bonus,r={UserPower:s.ATK||1,UserMagic:s.MATK||1,UserDefense:s.DEF||0,UserMind:s.MDEF||0,UserHP:s.HP||0,UserAgility:s.AGI||0,UserDex:s.DEX||0,UserCritDamage:s.HIT||0};try{let t=d(a,r);return Math.floor(e*t)}catch(e){console.error("Failed to apply ".concat(t," bonus:"),e)}}return e}let u={WeaponAttackPower:r.attackPower||0,WeaponMagicPower:r.magicPower||0,WeaponCritRate:r.critRate||0,WeaponCritDamage:r.critDamage||0,UserPower:s.ATK||0,UserMagic:s.MATK||0,UserDefense:s.DEF||0,UserMind:s.MDEF||0,UserHP:s.HP||0,UserMP:s.MP||0,UserAgility:s.AGI||0,UserDex:s.DEX||0,UserLuck:s.LUK||0,UserCritDamage:s.HIT||0,UserHit:s.HIT||0,UserFlee:s.FLEE||0,DamageCorrection:i};try{let e=d(c,u);return Math.max(0,Math.floor(e))}catch(a){return console.error("Failed to apply job correction for ".concat(t,":"),a),e}}function e$(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.round(e*a)/a}function eY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.ceil(e*a)/a}function eZ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.pow(10,t);return Math.floor(e*a)/a}function eQ(e,t){if(!e||"string"!=typeof e)return 0;try{let a=e.trim();for(let e of(a=a.replace(/<Level>/g,String(t.Level||1)),Object.keys(t).sort((e,t)=>t.length-e.length))){let r=t[e];if(void 0!==r){let t=e.replace(/\./g,"\\."),s=RegExp(t,"g");a=a.replace(s,String(r))}}a=(a=function e(t){let a=t;for(let{pattern:t,fn:r}of[{pattern:/ROUND\s*\(/gi,fn:e$},{pattern:/ROUNDUP\s*\(/gi,fn:eY},{pattern:/ROUNDDOWN\s*\(/gi,fn:eZ}]){let s;for(t.lastIndex=0;null!==(s=t.exec(a));){let l;let n=s.index,i=s.index+s[0].length,o=1,c=i;for(let e=i;e<a.length&&o>0;e++)if("("===a[e]&&o++,")"===a[e]&&o--,0===o){c=e;break}let d=a.substring(i,c),u=[],m="",x=0;for(let e of d)"("===e&&x++,")"===e&&x--,","===e&&0===x?(u.push(m.trim()),m=""):m+=e;u.push(m.trim());try{let t=e(u[0]);l=Function("return ".concat(t))()}catch(e){t.lastIndex=c+1;continue}let h=0;if(u.length>1)try{h=Function("return ".concat(u[1]))()}catch(e){h=0}let p=r(l,h);a=a.substring(0,n)+String(p)+a.substring(c+1),t.lastIndex=0}}return a}(a)).replace(/round\(/gi,"Math.round(").replace(/floor\(/gi,"Math.floor(").replace(/ceil\(/gi,"Math.ceil(").replace(/max\(/gi,"Math.max(").replace(/min\(/gi,"Math.min(").replace(/abs\(/gi,"Math.abs(").replace(/sqrt\(/gi,"Math.sqrt(").replace(/pow\(/gi,"Math.pow(").replace(/ln\(/gi,"Math.log("),/^[\d\s+\-*/().Math,roundfloorceimaxinabsqrtpowlog]+$/.test(a)||(console.warn("Unsafe formula pattern detected:",a),a=a.replace(/[^0-9\s+\-*/().]/g,""));let r=Function("return ".concat(a))();if("number"==typeof r&&!isNaN(r)&&isFinite(r))return r;return console.warn("Formula evaluation returned invalid result:",r,"for formula:",e),0}catch(t){return console.error("Formula evaluation error:",t,"Formula:",e),0}}function e0(e){let{embedded:t=!1}=e,{currentBuild:a,calculatedStats:l,weaponStats:n,gameData:i,enemyStats:o,selectedSkillId:c,skillLevel:d,customHits:u,setSelectedSkillId:m,setSkillLevel:x,setCustomHits:h}=E(),[p,g]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),[v,y]=(0,s.useState)(!0),[j,N]=(0,s.useState)(null),[k,D]=(0,s.useState)(null),S=(0,s.useMemo)(()=>{if(!a.job||!(null==i?void 0:i.jobSPData))return[];let e=i.jobSPData.get(a.job.name);if(!e)return[];let t=a.spAllocation||{A:0,B:0,C:0},r=[];for(let a of e){let e=a.解法段階,s=a.解法スキル名,l=Number(a.必要SP)||0;s&&e.match(/^[ABC]-\d+$/)&&(t[e.charAt(0)]||0)>=l&&r.push(s)}return r},[a.job,a.spAllocation,null==i?void 0:i.jobSPData]);(0,s.useEffect)(()=>{let e=!0;return(async()=>{y(!0);try{let t=await _(),a=await J();e&&(g(t),f(a),Object.keys(t.skillBook).length>0||Object.keys(t.specialJob).length>0||Object.keys(t.firstJob).length>0||Object.keys(t.secondJob).length>0||Object.keys(t.thirdJob).length>0||console.warn("No skill data loaded - skill calculation may be limited"))}catch(t){console.error("Failed to load skill calc data:",t),e&&(g({skillBook:{},specialJob:{},firstJob:{},secondJob:{},thirdJob:{}}),f(null))}finally{e&&y(!1)}})(),()=>{e=!1}},[]);let C=(0,s.useMemo)(()=>{var e;let t=a.equipment.weapon;if(!t)return"";let r="";return(null===(e=t.sourceData)||void 0===e?void 0:e.type)==="weapon"&&(r=t.sourceData.data.武器種||""),r||(r=t.weaponType||"sword"),function(e){let t={sword:"Sword",greatsword:"GreatSword",dagger:"Dagger",axe:"Axe",spear:"Spear",bow:"Bow",staff:"Wand",wand:"Wand",frypan:"Frypan",mace:"Sword",katana:"Sword",fist:"Sword",剣:"Sword",大剣:"GreatSword",短剣:"Dagger",斧:"Axe",槍:"Spear",弓:"Bow",杖:"Wand"};return t[e.toLowerCase()]||t[e]||"Sword"}(r)},[a.equipment.weapon]),P=(0,s.useMemo)(()=>a.job&&w(a.job.id)||"",[a.job]),M=(0,s.useMemo)(()=>{var e;if(!a.job||!(null==i?void 0:null===(e=i.jobConst)||void 0===e?void 0:e.JobDefinition))return"";let t=i.jobConst.JobDefinition[P];return(null==t?void 0:t.Grade)||""},[a.job,P,null==i?void 0:i.jobConst]),A=(0,s.useMemo)(()=>p&&C&&P?function(e,t,a,r,s){let l=[];l.push(...function(e,t){let a=[],r=e[t];if(!r)return a;for(let[e,s]of Object.entries(r))a.push({id:"book_".concat(t,"_").concat(e),name:e,source:"book",weaponTypes:s.BaseDamageType||[t],definition:s,type:z(s)});return a}(e.skillBook,t));let n={};switch(r){case"Special":n=e.specialJob;break;case"First":n=e.firstJob;break;case"Second":n=e.secondJob;break;case"Third":n=e.thirdJob}return l.push(...function(e,t,a){let r=[],s=e[t];if(!s)return r;for(let[e,l]of Object.entries(s))a.includes(e)&&r.push({id:"job_".concat(t,"_").concat(e),name:e,source:"job",jobName:t,weaponTypes:l.BaseDamageType||[],definition:l,type:z(l)});return r}(n,a,s)),l}(p,C,P,M,S):[],[p,C,P,M,S]);(0,s.useEffect)(()=>{c&&A.length>0?N(A.find(e=>e.id===c)||null):N(null)},[c,A]);let R=(0,s.useMemo)(()=>n?{attackPower:n.attackPower||0,magicPower:n.attackPower||0,critRate:n.critRate||0,critDamage:n.critDamage||0}:{attackPower:0,magicPower:0,critRate:0,critDamage:0},[n]),F=(0,s.useMemo)(()=>{let e=l.total;return{HP:e.HP||0,ATK:e.ATK||0,MATK:e.MATK||0,DEF:e.DEF||0,MDEF:e.MDEF||0,AGI:e.AGI||0,DEX:e.DEX||0,CRI:e.CRI||0,HIT:e.HIT||0,FLEE:e.FLEE||0}},[l.total]),L=(0,s.useMemo)(()=>{if(!b||!a.equipment.weapon)return{};let e={};for(let t of["Sword","Wand","Bow","Axe","GreatSword","Dagger","Spear","Frypan"])try{let a=eX(t,R,F,b,1,1);P&&(a=eG(a,P,t,R,F,b,1)),e[t]=a}catch(a){e[t]=0}return e},[b,a.equipment.weapon,R,F,P]),B=(0,s.useCallback)(()=>{if(!j||!b){D(null);return}D(function(e,t,a,r,s){var l,n,i;let o,c,d,u;let m=e.definition,{enabled:x,penalty:h}=function(e){if(!(null==e?void 0:e.AdditionalAttacks))return{enabled:!1,penalty:1};let t=e.AdditionalAttacks.WeaponMismatch;return t&&t.Enabled?{enabled:!0,penalty:t.Penalty||.2}:{enabled:!1,penalty:1}}(r),p=!(l=m.BaseDamageType)||0===l.length||l.includes(a),g=x&&!p&&"job"===e.source,b=g?h:1,f=function(e,t){if(null==e)return{hits:1,isVariable:!1};if("number"==typeof e)return{hits:e,isVariable:!1};if(Array.isArray(e)){let[t,a]=e;return{hits:Math.floor((t+a)/2),isVariable:!1,minHits:t,maxHits:a}}return"variable"===e?{hits:1,isVariable:!0}:"string"==typeof e?{hits:Math.floor(eQ(e,t)),isVariable:!1}:{hits:1,isVariable:!1}}(m.Hits,t),v=void 0!==s?s:f.hits,y=null==(n=m.MP)?0:"number"==typeof n?n:"string"==typeof n?Math.floor(eQ(n,t)):0,j=null==(i=m.CT)?0:"number"==typeof i?i:"string"==typeof i?eQ(i,t):0,N=0;m.Damage&&(N=Math.floor((N=eQ(m.Damage,t))*b));let k=0;if(m.Heal&&(k=eQ(m.Heal,t)),m.Buff)for(let[e,a]of(o={},Object.entries(m.Buff)))o[e]=eQ(a,t);if(m.Debuff)for(let[e,a]of(c={},Object.entries(m.Debuff)))c[e]=eQ(a,t);if(m.Dot){let e={...t,Hits:v,Damage:N},a=eQ(m.Dot.Count,e),r=eQ(m.Dot.Damage,e);d={count:Math.floor(a),damagePerTick:Math.floor(r),totalDotDamage:Math.floor(a*r)}}if(m.Extra)for(let[e,a]of(u={},Object.entries(m.Extra)))u[e]=eQ(a,t);let w="heal"===e.type?k:N;return{skillName:e.name,type:e.type,damagePerHit:Math.floor(w),hits:v,totalDamage:Math.floor(w*v),mpCost:y,coolTime:j,buffEffects:o,debuffEffects:c,dotEffect:d,extraEffects:u,weaponMismatchApplied:g,weaponMismatchPenalty:b,isVariableHits:f.isVariable&&void 0===s}}(j,function(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return{"BaseDamage.Sword":e.Sword||0,"BaseDamage.Wand":e.Wand||0,"BaseDamage.Bow":e.Bow||0,"BaseDamage.Axe":e.Axe||0,"BaseDamage.GreatSword":e.GreatSword||0,"BaseDamage.Dagger":e.Dagger||0,"BaseDamage.Spear":e.Spear||0,"BaseDamage.Frypan":e.Frypan||0,UserPower:t.ATK||0,UserMagic:t.MATK||0,UserHP:t.HP||0,UserMind:t.MDEF||0,UserSpeed:t.AGI||0,UserAgility:t.AGI||0,UserDex:t.DEX||0,UserDefense:t.DEF||0,UserCritDamage:t.HIT||0,UserMP:100,WeaponAttackPower:a.attackPower||0,WeaponCritRate:a.critRate||0,WeaponCritDamage:a.critDamage||0,DamageCorrection:1,ComboCorrection:1,Level:r,SkillLevel:r,TargetDefense:s}}(L,F,R,d,0),C,b,u))},[j,b,L,F,R,d,C,u]);(0,s.useEffect)(()=>{B()},[B]);let O=e=>{N(e),m((null==e?void 0:e.id)||null),h(void 0),(null==e?void 0:e.source)==="book"&&x(1)},T=e=>{switch(e){case"damage":return"⚔️";case"heal":return"\uD83D\uDC9A";case"buff":return"⬆️";case"debuff":return"⬇️";case"utility":return"\uD83D\uDD27";default:return"✨"}},I=(0,s.useMemo)(()=>A.map(e=>{let t=T(e.type),a="book"===e.source?"\uD83D\uDCD6 スキル本":"\uD83D\uDC64 ".concat(e.jobName||""),r=e.weaponTypes.length>0?"[".concat(e.weaponTypes.join(", "),"]"):"";return{value:e.id,label:e.name,icon:t,description:"".concat(a," ").concat(r).trim()}}),[A]),q=(0,s.useCallback)(e=>{O(A.find(t=>t.id===e)||null)},[A]);return v?t?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-gray-400",children:"スキルデータを読み込み中..."})}):(0,r.jsxs)("div",{className:"glass-card p-6 mt-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"✨"}),"スキル計算"]}),(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-gray-400",children:"スキルデータを読み込み中..."})})]}):a.job&&a.equipment.weapon?(0,r.jsxs)("div",{className:t?"":"glass-card p-6 mt-6",children:[!t&&(0,r.jsxs)("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"✨"}),"スキル計算"]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"スキル選択"}),0===A.length?(0,r.jsx)("div",{className:"px-4 py-3 bg-gray-800/50 rounded-lg border border-gray-700 text-gray-500 text-center",children:"使用可能なスキルがありません"}):(0,r.jsx)(eo,{options:I,value:(null==j?void 0:j.id)||"",onChange:q,placeholder:"スキルを選択してください",showIcon:!0}),(0,r.jsxs)("p",{className:"mt-2 text-xs text-gray-500",children:[A.length,"個のスキルが使用可能"]})]}),(null==j?void 0:j.source)==="book"&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-3",children:"スキルレベル"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,r.jsxs)("button",{onClick:()=>x(e),className:"\n                  relative min-w-[48px] h-10 px-3 rounded-lg font-medium\n                  transition-all duration-200 ease-out\n                  ".concat(d===e?"bg-gradient-to-br from-rpg-accent to-purple-600 text-white shadow-lg shadow-rpg-accent/30 scale-105":"bg-gray-700/80 text-gray-300 hover:bg-gray-600 hover:text-white hover:scale-102","\n                  border ").concat(d===e?"border-rpg-accent/50":"border-gray-600/50","\n                "),children:[(0,r.jsxs)("span",{className:"relative z-10",children:["Lv.",e]}),d===e&&(0,r.jsx)("div",{className:"absolute inset-0 bg-white/10 rounded-lg animate-pulse"})]},e))}),(0,r.jsx)("div",{className:"mt-3 px-3 py-2 bg-gray-800/50 rounded-lg border border-gray-700/50",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"現在:"}),(0,r.jsxs)("span",{className:"text-rpg-accent font-semibold",children:["Lv.",d]}),(0,r.jsx)("span",{className:"text-gray-600",children:"|"}),(0,r.jsx)("span",{className:"text-gray-500",children:"最大:"}),(0,r.jsx)("span",{className:"text-gray-400",children:"Lv.10"})]})})]}),(null==k?void 0:k.isVariableHits)&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"ヒット数（敵サイズ依存）"}),(0,r.jsx)("input",{type:"number",min:1,max:100,value:u||"",onChange:e=>h(Number(e.target.value)||void 0),placeholder:"ヒット数を入力",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"})]}),k&&j&&(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-white border-b border-gray-700 pb-2",children:["計算結果: ",k.skillName]}),k.weaponMismatchApplied&&(0,r.jsx)("div",{className:"p-3 bg-yellow-900/30 border border-yellow-500/50 rounded-lg",children:(0,r.jsxs)("p",{className:"text-yellow-400 text-sm flex items-center gap-2",children:[(0,r.jsx)("span",{children:"⚠️"}),"武器不一致ペナルティ適用中（",Math.round(100*k.weaponMismatchPenalty),"%）"]})}),("damage"===k.type||"heal"===k.type)&&(()=>{let e=l.total.CRI||0,t=(null==n?void 0:n.damageCorrection)||80,a=(t+100)/2/100,s=Math.round(k.totalDamage*a),i=Math.round(1*k.totalDamage),c=Math.round(k.damagePerHit*a),d=Math.round(1*k.damagePerHit),u=(null==o?void 0:o.defense)||0,m=(null==o?void 0:o.attackResistance)||0,x=(null==o?void 0:o.elementResistance)||0,h=e=>Math.max(0,Math.floor(Math.max(0,e-u/2)*(1-m/100)*(1-x/100))),p=h(d),g=h(c),b=p*k.hits,f=g*k.hits;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-1",children:"heal"===k.type?"1回復量":"1hit最大"}),(0,r.jsx)("p",{className:"text-xl font-bold ".concat("heal"===k.type?"text-emerald-400":"text-red-400"),children:"damage"===k.type?d.toLocaleString():k.damagePerHit.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-1",children:"ヒット数"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-white",children:[k.hits,k.isVariableHits&&(0,r.jsx)("span",{className:"text-xs text-amber-400 ml-1",children:"(要入力)"})]})]}),k.hits>1?(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-1",children:"heal"===k.type?"合計回復量":"全段(".concat(k.hits,"hit)最大")}),(0,r.jsx)("p",{className:"text-xl font-bold ".concat("heal"===k.type?"text-emerald-400":"text-red-400"),children:"damage"===k.type?i.toLocaleString():k.totalDamage.toLocaleString()})]}):(0,r.jsxs)("div",{className:"p-3 bg-slate-800/40 rounded-lg border border-slate-700/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"合計"}),(0,r.jsx)("p",{className:"text-xl font-bold text-slate-500",children:"-"})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-1",children:"MP / CT"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-sky-400",children:[k.mpCost," / ",k.coolTime.toFixed(1),"s"]})]})]}),"damage"===k.type&&(0,r.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsxs)("p",{className:"text-xs text-slate-400 mb-1",children:["1hit期待値",(0,r.jsxs)("span",{className:"text-slate-500 ml-1",children:["(ダメ補正",t,"〜",100,"% / 会心",Math.round(Math.min(e,100)/100*100),"%)"]})]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-400",children:c.toLocaleString()})]}),k.hits>1?(0,r.jsxs)("div",{className:"p-3 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsxs)("p",{className:"text-xs text-slate-400 mb-1",children:["全段(",k.hits,"hit)期待値"]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-400",children:s.toLocaleString()})]}):(0,r.jsxs)("div",{className:"p-3 bg-slate-800/40 rounded-lg border border-slate-700/40",children:[(0,r.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"合計期待値"}),(0,r.jsx)("p",{className:"text-xl font-bold text-slate-500",children:"-"})]})]}),"damage"===k.type&&(u>0||0!==m||0!==x)&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-slate-800/80 border border-cyan-600/40 rounded-lg",children:[(0,r.jsxs)("h5",{className:"text-sm font-semibold text-cyan-400 mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83C\uDFAF"}),"最終ダメージ（敵ステータス考慮）"]}),(0,r.jsxs)("p",{className:"text-xs text-slate-400 mb-3",children:["守備力: ",u," / 攻撃耐性: ",m,"% / 属性耐性: ",x,"%"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-cyan-400 mb-1",children:"1hit期待値"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:g.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-cyan-400 mb-1",children:"1hit最大"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:p.toLocaleString()})]}),k.hits>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-xs text-cyan-400 mb-1",children:["全段(",k.hits,"hit)期待値"]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:f.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-xs text-cyan-400 mb-1",children:["全段(",k.hits,"hit)最大"]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:b.toLocaleString()})]})]})]})]})]})})(),k.buffEffects&&Object.keys(k.buffEffects).length>0&&(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 border border-sky-600/40 rounded-lg",children:[(0,r.jsx)("h5",{className:"text-sm font-semibold text-sky-400 mb-2",children:"バフ効果"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(k.buffEffects).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-slate-400",children:[t,":"]}),(0,r.jsxs)("span",{className:"text-sky-300",children:["+",Math.floor(a).toLocaleString()]})]},t)})}),j.definition.Duration&&(0,r.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:["持続時間: ",j.definition.Duration,"秒"]})]}),k.debuffEffects&&Object.keys(k.debuffEffects).length>0&&(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 border border-violet-600/40 rounded-lg",children:[(0,r.jsx)("h5",{className:"text-sm font-semibold text-violet-400 mb-2",children:"デバフ効果"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(k.debuffEffects).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-slate-400",children:[t,":"]}),(0,r.jsxs)("span",{className:"text-violet-300",children:["-",Math.floor(a).toLocaleString()]})]},t)})})]}),k.dotEffect&&(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 border border-rose-600/40 rounded-lg",children:[(0,r.jsx)("h5",{className:"text-sm font-semibold text-rose-400 mb-2",children:"継続ダメージ (DoT)"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-slate-400",children:"回数:"}),(0,r.jsx)("span",{className:"ml-2 text-rose-300",children:k.dotEffect.count})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-slate-400",children:"1回:"}),(0,r.jsx)("span",{className:"ml-2 text-rose-300",children:k.dotEffect.damagePerTick.toLocaleString()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-slate-400",children:"合計:"}),(0,r.jsx)("span",{className:"ml-2 text-rose-300",children:k.dotEffect.totalDotDamage.toLocaleString()})]})]})]}),k.extraEffects&&Object.keys(k.extraEffects).length>0&&(()=>{let e=j.definition.Extra||{};return(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 border border-amber-600/40 rounded-lg",children:[(0,r.jsxs)("h5",{className:"text-sm font-semibold text-amber-400 mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{children:"⚡"}),"追加効果"]}),(0,r.jsx)("div",{className:"space-y-3",children:Object.entries(k.extraEffects).map(t=>{let[a,s]=t,l=Math.floor(s);if(!(e[a]||"").includes("BaseDamage"))return(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-2",children:a}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-xl font-bold text-amber-300",children:l.toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"（会心/ダメージ補正なし）"})]})]},a);let i=(null==n?void 0:n.damageCorrection)||80,o=(i+100)/2/100;return(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-slate-400 mb-2",children:a}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-xs text-red-400 mb-1",children:"1hit最大"}),(0,r.jsx)("p",{className:"text-xl font-bold text-red-400",children:Math.floor(1*l).toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-slate-500",children:"補正100%"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-xs text-orange-400 mb-1",children:"1hit期待値"}),(0,r.jsx)("p",{className:"text-xl font-bold text-orange-400",children:Math.floor(l*o).toLocaleString()}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:["補正",i,"%-100%"]})]})]})]},a)})})]})})(),"utility"===k.type&&(0,r.jsxs)("div",{className:"p-4 bg-gray-700/50 rounded-lg text-center",children:[(0,r.jsx)("p",{className:"text-gray-400",children:"このスキルはダメージ・回復・バフ/デバフを持たないユーティリティスキルです"}),k.mpCost>0&&(0,r.jsxs)("p",{className:"text-sm text-blue-400 mt-2",children:["MP消費: ",k.mpCost]})]})]})]}):t?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("p",{children:"職業と武器を選択してください"})]}):(0,r.jsxs)("div",{className:"glass-card p-6 mt-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"✨"}),"スキル計算"]}),(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("p",{children:"職業と武器を選択してください"})]})]})}function e1(){var e;let[t,a]=(0,s.useState)("normal"),{currentBuild:l,calculatedStats:n,weaponStats:i,enemyStats:o}=E(),c=l.job?w(l.job.id):null,[d,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[h,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{x(!0),p(null);let t=await J();e&&u(t)}catch(t){e&&(console.error("WeaponCalcの読み込みに失敗しました:",t),p("計算式データの読み込みに失敗しました"))}finally{e&&x(!1)}})(),()=>{e=!1}},[]);let g=(0,s.useCallback)(()=>{if(i)return{attackPower:i.attackPower||0,magicPower:i.attackPower||0,critRate:i.critRate||0,critDamage:i.critDamage||0};let e=l.equipment.weapon;if(!e)return{attackPower:0,magicPower:0,critRate:0,critDamage:0};let t=0,a=0,r=0,s=0;for(let l of e.baseStats)switch(l.stat){case"ATK":t=l.value;break;case"MATK":a=l.value;break;case"CRI":r=l.value;break;case"DEX":s=l.value}return{attackPower:t,magicPower:a,critRate:r,critDamage:s}},[i,l.equipment.weapon]),b=(0,s.useCallback)(()=>{let e=n.total;return{HP:e.HP||0,ATK:e.ATK||0,MATK:e.MATK||0,DEF:e.DEF||0,MDEF:e.MDEF||0,AGI:e.AGI||0,DEX:e.DEX||0,CRI:e.CRI||0,HIT:e.HIT||0,FLEE:e.FLEE||0}},[n.total]),f=(0,s.useMemo)(()=>{if(!d||!l.equipment.weapon)return null;try{let e={sword:"Sword",greatsword:"GreatSword",dagger:"Dagger",axe:"Axe",spear:"Spear",bow:"Bow",staff:"Wand",wand:"Wand",frypan:"Frypan",mace:"Sword",katana:"Sword",fist:"Sword"}[(l.equipment.weapon.weaponType||(null==i?void 0:i.weaponType)||"sword").toLowerCase()]||"Sword",t=g(),a=b(),r=((null==i?void 0:i.damageCorrection)||100)/100,s=(r+1)/2,n=Math.min(100,a.CRI||0),u=eX(e,t,a,d,1,1);c&&(u=eG(u,c,e,t,a,d,1));let m={Sword:.005,Wand:.0016,Bow:.0016,Axe:.001,GreatSword:.001,Dagger:.0015,Spear:.001/3,Frypan:.005}[e]||.005,x=1+(t.critDamage||0)/100+(a.HIT||0)*m,h=u/x,p=n/100,f=h*(1-p)+u*p,v=Math.floor(u),y=Math.floor(f*s),j=(null==o?void 0:o.defense)||0,N=(null==o?void 0:o.attackResistance)||0,k=(null==o?void 0:o.elementResistance)||0,w=Math.floor(j/2),D=(100-N)/100*((100-k)/100),S=Math.floor(Math.max(1,y-w)*D),C=(null==i?void 0:i.coolTime)||0;return{baseMaxDamage:v,baseExpectedDamage:y,baseDps:C>0?Math.floor(y/C):0,maxDamage:Math.floor(Math.max(1,v-w)*D),expectedDamage:S,dps:C>0?Math.floor(S/C):0,coolTime:C,critRate:n,damageCorrectionRange:{min:Math.round(100*r),max:Math.round(100),avg:Math.round(100*s)},enemyDefense:j,enemyAttackResistance:N,enemyElementResistance:k,resistanceMultiplier:D,hasEnemyStats:j>0||0!==N||0!==k}}catch(e){return console.error("ダメージ計算エラー:",e),null}},[d,l.equipment.weapon,i,g,b,c,o]);return m?(0,r.jsxs)("section",{className:"p-6 rounded-xl bg-gradient-to-br from-red-900/20 to-orange-900/20 border border-red-500/30",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"火力計算"]}),(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-gray-400",children:"計算式データを読み込み中..."})})]}):h?(0,r.jsxs)("section",{className:"p-6 rounded-xl bg-gradient-to-br from-red-900/20 to-orange-900/20 border border-red-500/30",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"火力計算"]}),(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-red-400",children:h})})]}):(0,r.jsxs)("section",{className:"p-6 rounded-xl bg-gradient-to-br from-red-900/20 to-orange-900/20 border border-red-500/30",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-6 h-6 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"火力計算"]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,r.jsx)("button",{onClick:()=>a("normal"),className:"min-w-[120px] px-4 py-2 rounded-lg font-medium transition-all ".concat("normal"===t?"bg-blue-600 text-white":"bg-gray-700/50 text-gray-400 hover:bg-gray-600/50 hover:text-gray-300"),children:"⚔️ 通常攻撃"}),(0,r.jsx)("button",{onClick:()=>a("skill"),className:"min-w-[120px] px-4 py-2 rounded-lg font-medium transition-all ".concat("skill"===t?"bg-blue-600 text-white":"bg-gray-700/50 text-gray-400 hover:bg-gray-600/50 hover:text-gray-300"),children:"✨ スキル"})]}),(0,r.jsxs)("div",{className:"min-h-[140px]",children:["normal"===t&&(0,r.jsxs)(r.Fragment,{children:[(!l.job||!l.equipment.weapon)&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("p",{children:"職業と武器を選択してください"})]}),l.job&&l.equipment.weapon&&f&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("h3",{className:"text-sm text-slate-400 mb-1",children:"最大ダメージ"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-red-400",children:f.baseMaxDamage.toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"ダメ補正100% / 会心発生時"})]}),(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("h3",{className:"text-sm text-slate-400 mb-1",children:"期待値"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-400",children:f.baseExpectedDamage.toLocaleString()}),(0,r.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:["ダメ補正",f.damageCorrectionRange.avg,"% / 会心率",f.critRate,"%考慮"]})]}),(0,r.jsxs)("div",{className:"p-4 bg-slate-800/60 rounded-lg border border-slate-600/40",children:[(0,r.jsx)("h3",{className:"text-sm text-slate-400 mb-1",children:"DPS"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-amber-400",children:f.baseDps>0?f.baseDps.toLocaleString():"-"}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:f.coolTime>0?"CT: ".concat(f.coolTime.toFixed(2),"秒"):"CT情報なし"})]})]}),f.hasEnemyStats&&(0,r.jsxs)("div",{className:"p-4 bg-slate-800/80 border border-cyan-600/40 rounded-lg",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-cyan-400 mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83C\uDFAF"}),"最終ダメージ（敵ステータス考慮）"]}),(0,r.jsxs)("p",{className:"text-xs text-slate-400 mb-3",children:["守備力: ",f.enemyDefense," / 攻撃耐性: ",f.enemyAttackResistance,"% / 属性耐性: ",f.enemyElementResistance,"%"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-cyan-400 mb-1",children:"最大ダメージ"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:f.maxDamage.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-cyan-400 mb-1",children:"期待値"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:f.expectedDamage.toLocaleString()})]}),(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-cyan-400 mb-1",children:"DPS"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-cyan-300",children:f.dps>0?f.dps.toLocaleString():"-"})]})]})]}),(0,r.jsx)("div",{className:"p-3 bg-glass-dark/50 rounded-lg",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs text-gray-400",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"武器種:"})," ",(0,r.jsx)("span",{className:"text-white",children:{sword:"剣",greatsword:"大剣",dagger:"短剣",axe:"斧",spear:"槍",bow:"弓",staff:"杖",wand:"杖",frypan:"フライパン",mace:"メイス",katana:"刀",fist:"拳"}[(e=l.equipment.weapon.weaponType||"").toLowerCase()]||e})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"ダメ補正範囲:"})," ",(0,r.jsxs)("span",{className:"text-white",children:[f.damageCorrectionRange.min,"%〜",f.damageCorrectionRange.max,"%"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"会心率:"})," ",(0,r.jsxs)("span",{className:"text-white",children:[f.critRate,"%"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"武器CT:"})," ",(0,r.jsx)("span",{className:"text-white",children:f.coolTime>0?"".concat((1e3*f.coolTime).toFixed(0),"ms"):"-"})]})]})})]}),l.job&&l.equipment.weapon&&!f&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("p",{className:"text-yellow-400",children:"ダメージ計算に必要なデータが不足しています"})]})]}),"skill"===t&&(0,r.jsx)(e0,{embedded:!0})]})]})}let e2=e=>{let{isOpen:t,title:a,message:l,confirmText:n="確認",cancelText:i="キャンセル",confirmVariant:o="primary",onConfirm:c,onCancel:d}=e,u=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&d()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,d]),(0,s.useEffect)(()=>{t&&u.current&&u.current.focus()},[t]),t)?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:d}),(0,r.jsxs)("div",{ref:u,className:"relative w-full max-w-md mx-4 bg-gray-800 border border-gray-700 rounded-xl shadow-2xl animate-fadeIn",tabIndex:-1,children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-700",children:(0,r.jsx)("h2",{id:"dialog-title",className:"text-lg font-semibold text-white",children:a})}),(0,r.jsx)("div",{className:"px-6 py-4",children:(0,r.jsx)("p",{className:"text-gray-300",children:l})}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 px-6 py-4 border-t border-gray-700",children:[(0,r.jsx)("button",{onClick:d,className:"px-4 py-2 text-gray-300 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500",children:i}),(0,r.jsx)("button",{onClick:c,className:"px-4 py-2 text-white rounded-lg transition-colors focus:outline-none focus:ring-2 ".concat({primary:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",danger:"bg-red-600 hover:bg-red-700 focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"}[o]),children:n})]})]})]}):null};function e4(){var e,t,a,l;let[n,i]=(0,s.useState)(!0),[o,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(0),[m,x]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[g,b]=(0,s.useState)(),[f,j]=(0,s.useState)({A:100,B:100,C:100}),[D,S]=(0,s.useState)([]),[C,P]=(0,s.useState)([]),[M,A]=(0,s.useState)(!1),[R,F]=(0,s.useState)(""),[L,B]=(0,s.useState)(null),[O,T]=(0,s.useState)(""),[I,q]=(0,s.useState)({isOpen:!1,title:"",message:"",confirmText:"確認",confirmVariant:"primary",onConfirm:()=>{}}),H=[{id:0,label:"職業",icon:"\uD83D\uDC64"},{id:1,label:"SP割り振り",icon:"\uD83D\uDCCA"},{id:2,label:"装備",icon:"⚔️"},{id:3,label:"紋章・ルーンストーン",icon:"\uD83D\uDC8E"},{id:4,label:"バフ設定",icon:"✨"},{id:5,label:"最終ステータス",icon:"\uD83D\uDCC8"},{id:6,label:"結果",icon:"\uD83C\uDFAF"}],{currentBuild:W,calculatedStats:J,availableJobs:K,availableEquipment:U,availableFoods:V,availableEmblems:_,availableRunestones:z,userOption:X,ringOption:G,selectedFood:$,foodEnabled:Y,weaponSkillEnabled:Z,selectedEmblem:Q,selectedRunestones:ee,gameData:et,enemyStats:ea,setJob:er,setLevel:es,setEquipment:el,setSPAllocation:ei,setUserOption:ec,setRingOption:ed,setFood:eu,toggleFood:ex,toggleWeaponSkill:eh,setEmblem:eb,setRunestones:ef,setEnemyStats:ev,setAvailableJobs:ey,setAvailableEquipment:ej,setAvailableFoods:eN,setAvailableEmblems:ek,setAvailableRunestones:ew,setGameData:eD,presets:eS,savePreset:eC,loadPreset:eP,deletePreset:eM,updatePreset:eE,loadPresetsFromStorage:eA}=E();(0,s.useEffect)(()=>{(async()=>{try{let e=await en();eD({eqConst:e.yaml.eqConst,jobConst:e.yaml.jobConst,jobSPData:e.csv.jobs,userStatusCalc:e.yaml.userStatusCalc,yaml:{weaponSkillCalc:e.yaml.weaponSkillCalc}});let t=Array.from(e.csv.jobs.entries()).map(t=>{var a,r;let[s,l]=t,n=l.find(e=>"初期値"===e.解法段階);l.find(e=>"職業補正(%)"===e.解法段階);let i={HP:Number(null==n?void 0:n.体力)||50,MP:Number(null==n?void 0:n.魔力)||30,ATK:Number(null==n?void 0:n.力)||10,DEF:Number(null==n?void 0:n.守備力)||10,MATK:Number(null==n?void 0:n.魔力)||10,MDEF:Number(null==n?void 0:n.精神)||10,AGI:Number(null==n?void 0:n.素早さ)||10,DEX:Number(null==n?void 0:n.器用さ)||10,LUK:0,CRI:Number(null==n?void 0:n.器用さ)||5,HIT:95,FLEE:Number(null==n?void 0:n.素早さ)||10},o={HP:0,MP:0,ATK:0,DEF:0,MATK:0,MDEF:0,AGI:0,DEX:0,LUK:0,CRI:0,HIT:0,FLEE:0},c=w(s),d=null===(r=e.yaml.jobConst)||void 0===r?void 0:null===(a=r.JobDefinition)||void 0===a?void 0:a[c],u=(null==d?void 0:d.AvailableWeapons)||["Sword"];l.forEach(e=>{e.解法段階.match(/^[ABC]-\d+$/)&&(o.HP+=Number(e.体力)||0,o.MP+=Number(e.魔力)||0,o.ATK+=Number(e.力)||0,o.DEF+=Number(e.守備力)||0,o.MATK+=Number(e.魔力)||0,o.MDEF+=Number(e.精神)||0,o.AGI+=Number(e.素早さ)||0,o.DEX+=Number(e.器用さ)||0,o.CRI+=Number(e.器用さ)||0,o.FLEE+=Number(e.素早さ)||0)});let m=(null==d?void 0:d.MaxLevel)||100;Object.keys(o).forEach(e=>{o[e]=Math.floor(o[e]/m*10)/10});let x={Sword:"sword",GreatSword:"greatsword",Dagger:"dagger",Axe:"axe",Spear:"spear",Bow:"bow",Wand:"staff",Staff:"staff",Grimoire:"staff",Shield:"sword",All:"sword"},h=u.map(e=>x[e]||"sword").filter((e,t,a)=>a.indexOf(e)===t),p=l.filter(e=>e.解法スキル名&&""!==e.解法スキル名).map(e=>({id:e.解法スキル名,name:e.解法スキル名,description:"".concat(e.解法段階,"で解放されるスキル"),spCost:Number(e.必要SP)||0,type:"active"}));return{id:s,name:s,baseStats:i,statGrowth:o,availableWeapons:h,skills:p,maxLevel:m}}),a=[...e.csv.weapons.map((t,a)=>{let r=[];t["攻撃力（初期値）"]>0&&r.push({stat:"ATK",value:t["攻撃力（初期値）"],isPercent:!1}),t["会心率（初期値）"]>0&&r.push({stat:"CRI",value:t["会心率（初期値）"],isPercent:!1}),t["会心ダメージ（初期値）"]>0&&r.push({stat:"DEX",value:t["会心ダメージ（初期値）"],isPercent:!1});let s=(()=>{var a;let r=[];if(null===(a=e.yaml.jobConst)||void 0===a?void 0:a.JobDefinition){let a=N[t.武器種]||[];Object.entries(e.yaml.jobConst.JobDefinition).forEach(e=>{let[t,s]=e,l=s.AvailableWeapons||[];(l.includes("All")||a.some(e=>l.includes(e)))&&r.push(t)})}return r.length>0?r:["All"]})();return{id:"weapon_".concat(a,"_").concat(t.アイテム名),name:t.アイテム名,slot:"weapon",weaponType:({剣:"sword",大剣:"greatsword",短剣:"dagger",斧:"axe",槍:"spear",弓:"bow",杖:"staff"})[t.武器種]||"sword",baseStats:r,requiredLevel:t.使用可能Lv||1,requiredJob:s,description:"".concat("TRUE"===t.制作?"制作可能":"ドロップ"," / 最低ランク: ").concat(t.最低ランク||"F"),sourceData:{type:"weapon",data:t}}}),...e.csv.armors.map((t,a)=>{let r=[];t["守備力（初期値）"]>0&&r.push({stat:"DEF",value:t["守備力（初期値）"],isPercent:!1}),t["体力（初期値）"]>0&&r.push({stat:"HP",value:t["体力（初期値）"],isPercent:!1}),t["力（初期値）"]>0&&r.push({stat:"ATK",value:t["力（初期値）"],isPercent:!1}),t["魔力（初期値）"]>0&&r.push({stat:"MATK",value:t["魔力（初期値）"],isPercent:!1}),t["精神（初期値）"]>0&&r.push({stat:"MDEF",value:t["精神（初期値）"],isPercent:!1}),t["素早さ（初期値）"]>0&&r.push({stat:"AGI",value:t["素早さ（初期値）"],isPercent:!1}),t["器用（初期値）"]>0&&r.push({stat:"DEX",value:t["器用（初期値）"],isPercent:!1}),t["撃力（初期値）"]>0&&r.push({stat:"HIT",value:t["撃力（初期値）"],isPercent:!1});let s=(()=>{var a;let r=[];if(null===(a=e.yaml.jobConst)||void 0===a?void 0:a.JobDefinition){let a=k[t.タイプを選択]||"Cloth";Object.entries(e.yaml.jobConst.JobDefinition).forEach(e=>{let[t,s]=e;(s.AvailableArmors||[]).includes(a)&&r.push(t)})}return r.length>0?r:["All"]})();return{id:"armor_".concat(a,"_").concat(t.アイテム名),name:t.アイテム名,slot:({頭:"head",胴:"body",脚:"leg"})[t.部位を選択]||"body",armorType:({頭:"head",胴:"body",脚:"leg"})[t.部位を選択]||"body",baseStats:r,requiredLevel:t.使用可能Lv||1,requiredJob:s,description:"".concat(t.タイプを選択,"装備 / 最低ランク: ").concat(t.最低ランク||"F"),sourceData:{type:"armor",data:t}}}),...e.csv.accessories.map((e,t)=>{let a=[];e["体力（初期値）"]>0&&a.push({stat:"HP",value:e["体力（初期値）"],isPercent:!1}),e["力（初期値）"]>0&&a.push({stat:"ATK",value:e["力（初期値）"],isPercent:!1}),e["魔力（初期値）"]>0&&a.push({stat:"MATK",value:e["魔力（初期値）"],isPercent:!1}),e["精神（初期値）"]>0&&a.push({stat:"MDEF",value:e["精神（初期値）"],isPercent:!1}),e["撃力（初期値）"]>0&&a.push({stat:"HIT",value:e["撃力（初期値）"],isPercent:!1}),e["素早さ（初期値）"]>0&&a.push({stat:"AGI",value:e["素早さ（初期値）"],isPercent:!1});let r="ネックレス"===e.タイプを選択;return{id:"accessory_".concat(t,"_").concat(e.アイテム名),name:e.アイテム名,slot:r?"accessory1":"accessory2",armorType:"accessory",baseStats:a,requiredLevel:e.使用可能Lv||1,requiredJob:[],description:"".concat(e.タイプを選択," / 最低ランク: ").concat(e.最低ランク||"F"),sourceData:{type:"accessory",data:e}}})],r=e.csv.foods.map((e,t)=>{let a=[];return e.力&&0!==e.力&&a.push({stat:"ATK",value:e.力,isPercent:!1}),e.魔力&&0!==e.魔力&&a.push({stat:"MATK",value:e.魔力,isPercent:!1}),e.体力&&0!==e.体力&&a.push({stat:"HP",value:e.体力,isPercent:!1}),e.精神&&0!==e.精神&&a.push({stat:"MDEF",value:e.精神,isPercent:!1}),e.素早さ&&0!==e.素早さ&&a.push({stat:"AGI",value:e.素早さ,isPercent:!1}),e.器用&&0!==e.器用&&a.push({stat:"DEX",value:e.器用,isPercent:!1}),e.撃力&&0!==e.撃力&&a.push({stat:"HIT",value:e.撃力,isPercent:!1}),e.守備力&&0!==e.守備力&&a.push({stat:"DEF",value:e.守備力,isPercent:!1}),{id:"food_".concat(t,"_").concat(e.アイテム名),name:e.アイテム名,effects:a,duration:30}});ey(t),ej(a),eN(r),S(e.csv.foods),ek(e.csv.emblems),ew(e.csv.runestones),eA(),i(!1)}catch(e){console.error("Failed to load game data:",e),i(!1)}})()},[ey,ej,eN,ek,ew,eD]),(0,s.useEffect)(()=>{if(W.job&&W.spAllocation&&(null==et?void 0:et.jobSPData)){let e=W.job.name,t=et.jobSPData.get(e);if(t){let e;let a={A:W.spAllocation.A||0,B:W.spAllocation.B||0,C:W.spAllocation.C||0};x(function(e,t,a){let r=[];return["A","B","C"].forEach(e=>{let s=t[e]||0;for(let t=1;t<=50;t++){let l="".concat(e,"-").concat(t),n=a.find(e=>e.解法段階===l);if(!n)break;let i="string"==typeof n.必要SP?parseFloat(n.必要SP)||0:n.必要SP||0;if(i<=s){let a=n.解法スキル名;a&&r.push({skillName:a,branch:e,tier:t,requiredSP:i})}else break}}),r}(0,a,t)),p((e=null,["A","B","C"].forEach(r=>{let s=a[r]||0;for(let a=1;a<=50;a++){let l="".concat(r,"-").concat(a),n=t.find(e=>e.解法段階===l);if(!n)break;let i="string"==typeof n.必要SP?parseFloat(n.必要SP)||0:n.必要SP||0;if(i>s){let t=n.解法スキル名;if(t){let a=i-s;(!e||a<e.needMoreSP)&&(e={branch:r,skillName:t,requiredSP:i,currentSP:s,needMoreSP:a})}break}}}),e)),b(y(a,t)),j(function(e){let t={A:100,B:100,C:100};return["A","B","C"].forEach(a=>{let r=100;for(let t=1;t<=50;t++){let s="".concat(a,"-").concat(t),l=e.find(e=>e.解法段階===s);if(!l)break;let n="string"==typeof l.必要SP?parseFloat(l.必要SP)||0:l.必要SP||0;n>0&&(r=n)}t[a]=r}),t}(t))}}else x([]),p(null),b(void 0),j({A:100,B:100,C:100})},[W.job,W.spAllocation,et]),(0,s.useEffect)(()=>{let e=[];if(W.job||e.push({type:"error",message:"職業を選択してください。職業は必須です。"}),W.job&&W.spAllocation){let t=(W.spAllocation.A||0)+(W.spAllocation.B||0)+(W.spAllocation.C||0),a=2*W.level;t>a&&e.push({type:"error",message:"SPが上限を超えています（現在: ".concat(t," / 上限: ").concat(a,"）")})}if(W.job&&W.equipment.weapon){let t=W.equipment.weapon,a=t.requiredJob||[],r=w(W.job.id);!(a.length>0)||a.includes("All")||a.includes(r)||e.push({type:"error",message:"".concat(t.name,"は ").concat(W.job.name," では使用できません")})}["head","body","leg"].forEach(t=>{let a=W.equipment[t];if(a&&W.job){let t=a.requiredJob||[],r=w(W.job.id);!(t.length>0)||t.includes("All")||t.includes(r)||e.push({type:"error",message:"".concat(a.name,"は ").concat(W.job.name," では装備できません")})}}),Object.values(W.equipment).forEach(t=>{t&&t.requiredLevel&&W.level<t.requiredLevel&&e.push({type:"warning",message:"".concat(t.name,"の必要レベル（Lv.").concat(t.requiredLevel,"）に達していません")})}),P(e)},[W.job,W.level,W.equipment,W.spAllocation]);let eF=(0,s.useMemo)(()=>{let e=()=>({fromSP:0,fromRunestone:0,fromFood:0,total:0}),t={physical:e(),magic:e(),fire:e(),water:e(),thunder:e(),wind:e(),none:e(),dark:e(),light:e()},a={物理耐性:"physical",魔耐性:"magic",炎耐性:"fire",水耐性:"water",雷耐性:"thunder",風耐性:"wind",無耐性:"none",闇耐性:"dark",光耐性:"light",物理:"physical",魔法:"magic",炎:"fire",水:"water",雷:"thunder",風:"wind",無:"none",闇:"dark",光:"light"};if(W.job&&W.spAllocation&&g){var r;let e=null==et?void 0:null===(r=et.jobSPData)||void 0===r?void 0:r.get(W.job.name);if(e){let r={A:W.spAllocation.A||0,B:W.spAllocation.B||0,C:W.spAllocation.C||0};["A","B","C"].forEach(s=>{let l=r[s];e.filter(e=>e.解法段階.startsWith("".concat(s,"-"))).forEach(e=>{("string"==typeof e.必要SP?parseInt(e.必要SP):e.必要SP)<=l&&Object.entries(a).forEach(a=>{let[r,s]=a,l=e[r];if(void 0!==l&&""!==l&&0!==l){let e="string"==typeof l?parseFloat(l):l;isNaN(e)||(t[s].fromSP+=e)}})})})}}if(ee&&ee.length>0&&ee.forEach(e=>{for(let r=1;r<=6;r++){let s=e["耐性".concat(r)];if(s&&s.type&&s.value){let e=a[s.type];e&&(t[e].fromRunestone+=s.value)}}}),Y&&$){let e=V.find(e=>e.id===$.id);if(e){let r=D.find(t=>t.アイテム名===e.name);if(r)for(let e=1;e<=8;e++){let s=r["耐性".concat(e)];if(s&&s.type&&s.value){let e=a[s.type];e&&(t[e].fromFood+=s.value)}}}}return Object.keys(t).forEach(e=>{t[e].total=t[e].fromSP+t[e].fromRunestone+t[e].fromFood}),t},[W.job,W.spAllocation,g,et,ee,Y,$,V,D]);if(n)return(0,r.jsx)("main",{className:"p-8",children:(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"データを読み込み中..."})})});let eL=e=>U.filter(t=>{if(t.slot!==e||t.requiredLevel&&W.level<t.requiredLevel)return!1;if(W.job&&t.requiredJob&&t.requiredJob.length>0){let e=w(W.job.id);return t.requiredJob.includes("All")||t.requiredJob.includes(e)}return!0}),eO=e=>{let t=e.toLowerCase();return t.includes("肉")||t.includes("ステーキ")?"\uD83C\uDF56":t.includes("魚")?"\uD83D\uDC1F":t.includes("パン")||t.includes("bread")?"\uD83C\uDF5E":t.includes("野菜")||t.includes("サラダ")?"\uD83E\uDD57":t.includes("スープ")?"\uD83C\uDF72":t.includes("酒")||t.includes("ワイン")?"\uD83C\uDF77":t.includes("ポーション")?"\uD83E\uDDEA":t.includes("果物")||t.includes("フルーツ")?"\uD83C\uDF4E":t.includes("甘")||t.includes("デザート")?"\uD83C\uDF70":"\uD83C\uDF7D️"};return(0,r.jsxs)("main",{className:"container mx-auto px-4 max-w-7xl py-8 md:py-12",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-thin text-gradient from-white to-gray-300",children:"DA Build Calculator"}),(0,r.jsxs)("button",{onClick:()=>A(!M),className:"flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm sm:text-base w-full sm:w-auto",children:[(0,r.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),(0,r.jsxs)("span",{children:["プリセット ",eS.length>0&&"(".concat(eS.length,")")]})]})]}),(0,r.jsx)("p",{className:"text-base sm:text-lg text-gray-400 line-clamp-2",children:"職業・装備・SPを設定して、最強のキャラクターを構築しよう"})]}),M&&(0,r.jsxs)("div",{className:"mb-8 bg-gray-800 border border-gray-700 rounded-xl p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ビルドプリセット"}),(0,r.jsx)("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-white",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[(0,r.jsx)("input",{type:"text",value:R,onChange:e=>F(e.target.value),placeholder:"プリセット名を入力...",className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsxs)("button",{onClick:()=>{R.trim()&&(eC(R.trim()),F(""))},disabled:!R.trim(),className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2 w-full sm:w-auto",children:[(0,r.jsx)("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),(0,r.jsx)("span",{children:"保存"})]})]}),0===eS.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),(0,r.jsx)("p",{children:"保存されたプリセットはありません"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"現在のビルドを保存してみましょう"})]}):(0,r.jsx)("div",{className:"space-y-3 max-h-80 overflow-y-auto custom-scrollbar",children:eS.map(e=>{var t;return(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 bg-gray-700 rounded-lg hover:bg-gray-650 transition-colors gap-3",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:L===e.id?(0,r.jsx)("input",{type:"text",value:O,onChange:e=>T(e.target.value),onKeyDown:t=>{"Enter"===t.key?(eE(e.id,O),B(null)):"Escape"===t.key&&B(null)},className:"w-full px-2 py-1 bg-gray-600 border border-gray-500 rounded text-white focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{className:"font-medium text-white truncate",children:e.name}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-400",children:[(null===(t=e.build.job)||void 0===t?void 0:t.name)||"未設定"," Lv.",e.build.level,(0,r.jsx)("span",{className:"hidden sm:inline",children:" - "}),(0,r.jsx)("span",{className:"block sm:inline",children:new Date(e.updatedAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})}),(0,r.jsx)("div",{className:"flex items-center justify-end gap-1 sm:gap-2 flex-shrink-0",children:L===e.id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{eE(e.id,O),B(null)},className:"p-2 text-green-400 hover:text-green-300 hover:bg-gray-600 rounded",title:"保存",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("button",{onClick:()=>B(null),className:"p-2 text-gray-400 hover:text-gray-300 hover:bg-gray-600 rounded",title:"キャンセル",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{q({isOpen:!0,title:"プリセットの読み込み",message:"プリセット「".concat(e.name,"」を読み込みます。現在のビルドは上書きされます。よろしいですか？"),confirmText:"読み込む",confirmVariant:"primary",onConfirm:()=>{eP(e.id),A(!1),q(e=>({...e,isOpen:!1}))}})},className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-gray-600 rounded",title:"読み込み",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),(0,r.jsx)("button",{onClick:()=>{q({isOpen:!0,title:"プリセットの上書き",message:"プリセット「".concat(e.name,"」を現在のビルドで上書きします。よろしいですか？"),confirmText:"上書き",confirmVariant:"warning",onConfirm:()=>{eE(e.id),q(e=>({...e,isOpen:!1}))}})},className:"p-2 text-yellow-400 hover:text-yellow-300 hover:bg-gray-600 rounded",title:"現在のビルドで上書き",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,r.jsx)("button",{onClick:()=>{B(e.id),T(e.name)},className:"p-2 text-gray-400 hover:text-gray-300 hover:bg-gray-600 rounded",title:"名前変更",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,r.jsx)("button",{onClick:()=>{q({isOpen:!0,title:"プリセットの削除",message:"プリセット「".concat(e.name,"」を削除します。この操作は元に戻せません。よろしいですか？"),confirmText:"削除",confirmVariant:"danger",onConfirm:()=>{eM(e.id),q(e=>({...e,isOpen:!1}))}})},className:"p-2 text-red-400 hover:text-red-300 hover:bg-gray-600 rounded",title:"削除",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id)})})]}),(0,r.jsx)("div",{className:"mb-6 border-b border-gray-200 dark:border-gray-700",children:(0,r.jsx)("nav",{className:"flex space-x-2 overflow-x-auto","aria-label":"Tabs",children:H.map(e=>(0,r.jsxs)("button",{onClick:()=>u(e.id),className:"\n                flex items-center gap-2 px-4 py-3 text-sm font-medium whitespace-nowrap\n                border-b-2 transition-colors\n                ".concat(d===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600","\n              "),"aria-current":d===e.id?"page":void 0,children:[(0,r.jsx)("span",{className:"text-lg",children:e.icon}),(0,r.jsx)("span",{children:e.label})]},e.id))})}),C.length>0&&(0,r.jsxs)("div",{className:"mb-6 space-y-3",children:[C.filter(e=>"error"===e.type).length>0&&(0,r.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 rounded-r-lg p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("svg",{className:"w-6 h-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-red-800 dark:text-red-200 font-semibold mb-2",children:"入力エラー"}),(0,r.jsx)("ul",{className:"space-y-1.5",children:C.filter(e=>"error"===e.type).map((e,t)=>(0,r.jsxs)("li",{className:"text-red-700 dark:text-red-300 text-sm flex items-start gap-2",children:[(0,r.jsx)("span",{className:"flex-shrink-0 mt-0.5",children:"•"}),(0,r.jsx)("span",{children:e.message})]},t))})]})]})}),C.filter(e=>"warning"===e.type).length>0&&(0,r.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 rounded-r-lg p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("svg",{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-yellow-800 dark:text-yellow-200 font-semibold mb-2",children:"警告"}),(0,r.jsx)("ul",{className:"space-y-1.5",children:C.filter(e=>"warning"===e.type).map((e,t)=>(0,r.jsxs)("li",{className:"text-yellow-700 dark:text-yellow-300 text-sm flex items-start gap-2",children:[(0,r.jsx)("span",{className:"flex-shrink-0 mt-0.5",children:"•"}),(0,r.jsx)("span",{children:e.message})]},t))})]})]})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[0===d&&(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:"\uD83D\uDC64"}),(0,r.jsx)("span",{className:"truncate",children:"職業・レベル"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(em,{jobs:K,selectedJob:W.job,onChange:er,jobConst:null==et?void 0:et.jobConst}),W.job&&(0,r.jsx)(ep,{level:W.level,onChange:e=>{var t,a,r;if(!W.job)return;let s=w(W.job.id);es(Math.max(1,Math.min((null==et?void 0:null===(r=et.jobConst)||void 0===r?void 0:null===(a=r.JobDefinition)||void 0===a?void 0:null===(t=a[s])||void 0===t?void 0:t.MaxLevel)||100,e)))},maxLevel:(()=>{var e,t,a;if(!W.job)return 100;let r=w(W.job.id);return(null==et?void 0:null===(a=et.jobConst)||void 0===a?void 0:null===(t=a.JobDefinition)||void 0===t?void 0:null===(e=t[r])||void 0===e?void 0:e.MaxLevel)||100})()})]})]}),1===d&&W.job&&(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCCA"}),(0,r.jsx)("span",{className:"truncate",children:"SP割り振り"})]}),(0,r.jsx)(eg,{spValues:{A:(null===(e=W.spAllocation)||void 0===e?void 0:e.A)||0,B:(null===(t=W.spAllocation)||void 0===t?void 0:t.B)||0,C:(null===(a=W.spAllocation)||void 0===a?void 0:a.C)||0},maxSP:2*W.level,maxSPByBranch:f,onChange:e=>ei(e),unlockedSkills:m,nextSkillInfo:h,branchBonus:g,jobSPData:null==et?void 0:null===(l=et.jobSPData)||void 0===l?void 0:l.get(W.job.name),reachedTier:(()=>{var e,t,a;if(!W.job||!(null==et?void 0:et.jobSPData))return;let r=et.jobSPData.get(W.job.name);if(!r)return;let s=[{branch:"A",tier:v("A",(null===(e=W.spAllocation)||void 0===e?void 0:e.A)||0,r)},{branch:"B",tier:v("B",(null===(t=W.spAllocation)||void 0===t?void 0:t.B)||0,r)},{branch:"C",tier:v("C",(null===(a=W.spAllocation)||void 0===a?void 0:a.C)||0,r)}].filter(e=>!e.tier.endsWith("-0"));if(0!==s.length)return s.map(e=>e.tier).join(", ")})()})]}),2===d&&(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:"⚔️"}),(0,r.jsx)("span",{className:"truncate",children:"装備"})]}),(0,r.jsx)("div",{className:"space-y-3",children:[{slot:"weapon",name:"武器"},{slot:"head",name:"頭"},{slot:"body",name:"胴"},{slot:"leg",name:"脚"},{slot:"accessory1",name:"ネックレス"},{slot:"accessory2",name:"ブレスレット"}].map(e=>{let{slot:t,name:a}=e,s=W.equipment[t];return(0,r.jsx)(eR,{slot:t,equipment:s||null,availableEquipment:eL(t),onEquipmentChange:e=>{if(e){var a,r,s,l;let n="SSS",i=0;"weapon"===t?(null===(a=e.sourceData)||void 0===a?void 0:a.type)==="weapon"&&(null===(s=e.sourceData.data)||void 0===s?void 0:null===(r=s.アイテム名)||void 0===r?void 0:r.includes("検証"))?(n="F",i=0):(n="SSS",i=80):["head","body","leg"].includes(t)&&(i=40),el(t,{...e,rank:e.rank||n,enhancementLevel:null!==(l=e.enhancementLevel)&&void 0!==l?l:i})}else el(t,e)},rank:(null==s?void 0:s.rank)||"SSS",onRankChange:e=>{s&&el(t,{...s,rank:e})},enhancementLevel:(null==s?void 0:s.enhancementLevel)||0,onEnhancementChange:e=>{s&&el(t,{...s,enhancementLevel:e})},smithingCount:(null==s?void 0:s.smithingCount)||0,onSmithingCountChange:e=>{s&&el(t,{...s,smithingCount:e})},smithingCounts:(null==s?void 0:s.smithingCounts)||{},onSmithingCountsChange:e=>{s&&el(t,{...s,smithingCounts:e})},hasAlchemy:"weapon"===t&&((null==s?void 0:s.alchemyEnabled)||!1),onAlchemyChange:e=>{s&&"weapon"===t&&el(t,{...s,alchemyEnabled:e})},exStats:(null==s?void 0:s.exStats)||{},onExStatsChange:e=>{s&&el(t,{...s,exStats:e})},eqConst:null==et?void 0:et.eqConst,disabled:!W.job},t)})})]}),3===d&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(eB,{emblem:Q,availableEmblems:_,onEmblemChange:eb,disabled:!W.job,characterLevel:W.level}),(0,r.jsx)(eK,{selectedRunes:ee,availableRunes:z,onRunesChange:ef,disabled:!W.job})]}),4===d&&(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:"✨"}),(0,r.jsx)("span",{className:"truncate",children:"バフ設定"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:Z,onChange:e=>eh(e.target.checked),className:"checkbox-primary mr-3",disabled:!W.equipment.weapon}),(0,r.jsx)("span",{className:"font-medium ".concat(W.equipment.weapon?"text-gray-700 dark:text-gray-300":"text-gray-400 dark:text-gray-500"),children:"武器スキルバフ"})]}),!W.equipment.weapon&&(0,r.jsx)("p",{className:"mt-2 ml-6 text-xs text-gray-500",children:"武器を装備すると有効化できます"}),Z&&(()=>{var e,t,a,s,l;let n=(null==et?void 0:null===(t=et.yaml)||void 0===t?void 0:null===(e=t.weaponSkillCalc)||void 0===e?void 0:e.WeaponSkills)||{},i=(null==et?void 0:null===(s=et.yaml)||void 0===s?void 0:null===(a=s.weaponSkillCalc)||void 0===a?void 0:a.JobSkills)||{},o=(null===(l=W.equipment.weapon)||void 0===l?void 0:l.name)||"",c=m.map(e=>e.skillName),d={Power:"力",Magic:"魔力",HP:"HP",Mind:"精神",Agility:"素早さ",Dex:"器用",CritDamage:"会心ダメージ",Defense:"守備力",Speed:"速度"},u=Object.entries(n).filter(e=>{let[t,a]=e;return!!a.WeaponNames&&0!==a.WeaponNames.length&&a.WeaponNames.some(e=>o.includes(e))}).map(e=>{let[t,a]=e;return{name:a.Name,buffs:Object.entries(a.Buffs).map(e=>{let[t,a]=e;return{stat:d[t]||t,formula:a}}),maxLevel:a.MaxLevel}}),x=Object.entries(i).filter(e=>{let[t,a]=e;return!!a.RequiredSkills&&0!==a.RequiredSkills.length&&a.RequiredSkills.some(e=>c.includes(e))}).map(e=>{let[t,a]=e;return{name:a.Name,jobName:a.JobName,buffs:Object.entries(a.Buffs).map(e=>{let[t,a]=e;return{stat:d[t]||t,formula:a}}),maxLevel:a.MaxLevel}});return u.length>0||x.length>0?(0,r.jsxs)("div",{className:"mt-3 ml-6 p-4 glass-card-secondary rounded-lg animate-fadeIn",children:[u.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:[(0,r.jsx)("span",{className:"text-amber-400",children:"⚔️ 武器効果"}),(0,r.jsxs)("span",{className:"text-gray-500 ml-2",children:["(",o,")"]})]}),(0,r.jsx)("div",{className:"space-y-2 mb-4",children:u.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg border border-amber-600/30",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium text-amber-400",children:e.name}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["最大Lv.",e.maxLevel]})]}),(0,r.jsx)("div",{className:"mt-2 space-y-1",children:e.buffs.map((e,t)=>(0,r.jsxs)("p",{className:"text-xs text-cyan-400",children:[e.stat,": ",(0,r.jsx)("span",{className:"text-gray-400",children:e.formula})]},t))})]},"weapon-".concat(t)))})]}),x.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:(0,r.jsx)("span",{className:"text-emerald-400",children:"\uD83D\uDCCA SP解放スキル効果"})}),(0,r.jsx)("div",{className:"space-y-2",children:x.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg border border-emerald-600/30",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium text-emerald-400",children:e.name}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["最大Lv.",e.maxLevel]})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["職業: ",e.jobName]}),(0,r.jsx)("div",{className:"mt-2 space-y-1",children:e.buffs.map((e,t)=>(0,r.jsxs)("p",{className:"text-xs text-cyan-400",children:[e.stat,": ",(0,r.jsx)("span",{className:"text-gray-400",children:e.formula})]},t))})]},"job-".concat(t)))})]})]}):(0,r.jsx)("div",{className:"mt-3 ml-6 p-4 glass-card-secondary rounded-lg animate-fadeIn",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"現在の装備・SP振り分けで有効な武器スキルバフはありません"})})})()]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:G.enabled,onChange:e=>ed({...G,enabled:e.target.checked}),className:"checkbox-primary mr-3"}),(0,r.jsx)("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:"リングバフ"})]}),G.enabled&&(0,r.jsxs)("div",{className:"mt-3 ml-6 p-4 glass-card-secondary rounded-lg animate-fadeIn space-y-4",children:[(0,r.jsx)(eo,{options:[{value:"none",label:"なし",icon:"-",description:"リングバフ無効"},{value:"power",label:"力リング",icon:"\uD83D\uDCAA",description:"力に収束バフ"},{value:"magic",label:"魔力リング",icon:"✨",description:"魔力に収束バフ"},{value:"speed",label:"素早さリング",icon:"\uD83D\uDCA8",description:"素早さに収束バフ"}],value:G.ringType||"none",onChange:e=>{ed({...G,ringType:e})},placeholder:"リング種類を選択",label:"リング種類"}),G.ringType&&"none"!==G.ringType&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-blue-500/10 rounded text-sm text-blue-400",children:["power"===G.ringType&&"力: 40 + 装備力\xd71.1 を収束","magic"===G.ringType&&"魔力: 40 + 装備魔力\xd71.1 を収束","speed"===G.ringType&&"素早さ: 40 + 装備素早さ\xd71.1 を収束"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>ex(e.target.checked),className:"checkbox-primary mr-3"}),(0,r.jsx)("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:"食べ物バフ"})]}),Y&&(0,r.jsxs)("div",{className:"mt-3 ml-6 p-4 glass-card-secondary rounded-lg animate-fadeIn",children:[(0,r.jsx)(eo,{options:[{value:"",label:"選択してください",icon:"\uD83C\uDF7D️"},...V.map(e=>({value:e.id,label:e.name,icon:eO(e.name),description:e.effects.map(e=>"".concat(e.stat," +").concat(e.value).concat(e.isPercent?"%":"")).join(", ")}))],value:(null==$?void 0:$.id)||"",onChange:e=>{eu(V.find(t=>t.id===e)||null)},placeholder:"食べ物を選択",label:"食べ物選択"}),$&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:["持続時間: ",$.duration,"分"]})]})]})]}),5===d&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCC8"}),(0,r.jsx)("span",{className:"truncate",children:"最終ステータス"})]}),(0,r.jsx)(eV,{stats:J,resistance:eF,showBreakdown:!0})]}),(0,r.jsxs)("div",{className:"glass-card p-8",children:[(0,r.jsxs)("button",{onClick:()=>c(!o),className:"flex items-center justify-between w-full text-left mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"⚙️"}),(0,r.jsx)("span",{className:"truncate",children:"高度な設定"})]}),(0,r.jsx)("span",{className:"text-gray-400 text-2xl transition-transform duration-200",style:{transform:o?"rotate(90deg)":"rotate(0deg)"},children:"▶"})]}),o&&(0,r.jsxs)("div",{className:"space-y-6 animate-fadeIn",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"手動追加ステータス（固定値）"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{key:"HP",label:"体力"},{key:"ATK",label:"力"},{key:"MATK",label:"魔力"},{key:"DEF",label:"守備力"},{key:"MDEF",label:"精神"},{key:"AGI",label:"素早さ"},{key:"DEX",label:"器用さ"},{key:"HIT",label:"撃力"}].map(e=>(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("label",{className:"text-sm text-gray-600 dark:text-gray-400 w-16 truncate",children:[e.label,":"]}),(0,r.jsx)("input",{type:"number",className:"input-secondary w-20",value:X.manualStats[e.key]||0,onChange:t=>{let a=parseInt(t.target.value)||0;ec({...X,manualStats:{...X.manualStats,[e.key]:a}})}})]},e.key))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"%ボーナス（職業・紋章補正とは別）"}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{key:"HP",label:"体力"},{key:"ATK",label:"力"},{key:"MATK",label:"魔力"},{key:"DEF",label:"守備力"},{key:"MDEF",label:"精神"},{key:"AGI",label:"素早さ"},{key:"DEX",label:"器用さ"},{key:"HIT",label:"撃力"}].map(e=>{var t;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("label",{className:"text-sm text-gray-600 dark:text-gray-400 w-16 truncate",children:[e.label,":"]}),(0,r.jsx)("input",{type:"number",className:"input-secondary w-16",value:(null===(t=X.percentBonus)||void 0===t?void 0:t[e.key])||0,onChange:t=>{let a=parseInt(t.target.value)||0;ec({...X,percentBonus:{...X.percentBonus,[e.key]:a}})}}),(0,r.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"%"})]},e.key)})})]})]})]})]}),6===d&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"glass-card p-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDC79"}),(0,r.jsx)("span",{children:"敵パラメータ"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"守備力"}),(0,r.jsx)("input",{type:"number",value:ea.defense,onChange:e=>ev({...ea,defense:Math.max(0,parseInt(e.target.value)||0)}),className:"input-primary w-full",min:0,placeholder:"0"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"守備力/2をダメージから減算"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"攻撃耐性（物/魔） (%)"}),(0,r.jsx)("input",{type:"number",value:ea.attackResistance,onChange:e=>ev({...ea,attackResistance:Math.max(-100,Math.min(100,parseInt(e.target.value)||0))}),className:"input-primary w-full",min:-100,max:100,placeholder:"0"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"正: 軽減 / 負: 弱点"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"属性耐性 (%)"}),(0,r.jsx)("input",{type:"number",value:ea.elementResistance,onChange:e=>ev({...ea,elementResistance:Math.max(-100,Math.min(100,parseInt(e.target.value)||0))}),className:"input-primary w-full",min:-100,max:100,placeholder:"0"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"正: 軽減 / 負: 弱点"})]})]})]}),(0,r.jsx)(e1,{})]})]}),(0,r.jsxs)("div",{className:"flex justify-between mt-6 mb-8",children:[(0,r.jsx)("button",{onClick:()=>u(Math.max(0,d-1)),disabled:0===d,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"← 前へ"}),(0,r.jsx)("button",{onClick:()=>u(Math.min(H.length-1,d+1)),disabled:d===H.length-1,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"次へ →"})]}),(0,r.jsx)(e2,{isOpen:I.isOpen,title:I.title,message:I.message,confirmText:I.confirmText,confirmVariant:I.confirmVariant,onConfirm:I.onConfirm,onCancel:()=>q(e=>({...e,isOpen:!1}))})]})}}},function(e){e.O(0,[69,971,117,744],function(){return e(e.s=1579)}),_N_E=e.O()}]);